<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Livret Musculation CAP</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            min-height: 100vh;
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #0f172a 100%);
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }
        .card { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(10px);
            border-radius: 1.5rem; 
            padding: 2rem; 
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            margin-bottom: 1.5rem;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            font-size: 1rem;
        }
        .btn:hover { transform: scale(1.05); }
        .btn-primary { 
            background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
            color: white;
        }
        .btn-success { 
            background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%);
            color: white;
        }
        .btn-secondary { 
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        .btn-danger { 
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }
        .btn-link {
            background: transparent;
            color: #67e8f9;
            text-decoration: underline;
            padding: 0.5rem;
            font-size: 0.875rem;
        }
        .input {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }
        .input::placeholder { color: rgba(255, 255, 255, 0.5); }
        .input:focus { outline: none; border-color: #06b6d4; }
        select.input { 
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
            padding-right: 2.5rem;
        }
        .text-white { color: white; }
        .text-cyan { color: #67e8f9; }
        .text-center { text-align: center; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-4 { margin-bottom: 2rem; }
        .mt-2 { margin-top: 1rem; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 1rem; }
        .grid { display: grid; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-cols-5 { grid-template-columns: repeat(5, 1fr); }
        .hidden { display: none; }
        .muscle-btn {
            padding: 0.75rem;
            border-radius: 0.75rem;
            border: none;
            font-weight: 500;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.2s;
        }
        .muscle-btn.active {
            background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
            color: white;
            transform: scale(1.05);
        }
        .session-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
        }
        .session-card:hover { background: rgba(255, 255, 255, 0.15); }
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .badge-force { background: linear-gradient(135deg, #f97316 0%, #fb923c 100%); color: white; }
        .badge-endurance { background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%); color: white; }
        .badge-equilibre { background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%); color: white; }
        .lock-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }
        .tab-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
        }
        .tab-btn.active {
            background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
            color: white;
        }
        .rm-result {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(20, 184, 166, 0.2) 100%);
            border: 2px solid rgba(16, 185, 129, 0.5);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            margin: 1.5rem 0;
        }
        .rm-value {
            font-size: 3rem;
            font-weight: bold;
            color: #10b981;
            margin: 0.5rem 0;
        }
        .percentage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .percentage-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.75rem;
            padding: 1rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .muscle-group-card {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .muscle-group-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .muscle-group-icon {
            width: 3rem;
            height: 3rem;
            background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        .exercise-row {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        @media (max-width: 768px) {
            .grid-cols-5 { grid-template-columns: repeat(2, 1fr); }
            .card { padding: 1rem; }
            .tab-btn { padding: 0.5rem 1rem; font-size: 0.875rem; }
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script><script>
        const storage = {
            get(key, shared = false) {
                const storageKey = shared ? `shared_${key}` : key;
                const value = localStorage.getItem(storageKey);
                return value ? { key, value, shared } : null;
            },
            set(key, value, shared = false) {
                const storageKey = shared ? `shared_${key}` : key;
                localStorage.setItem(storageKey, value);
                return { key, value, shared };
            },
            delete(key, shared = false) {
                const storageKey = shared ? `shared_${key}` : key;
                localStorage.removeItem(storageKey);
                return { key, deleted: true, shared };
            }
        };

        const securityQuestions = [
            "Quel est le nom de votre animal de compagnie ?",
            "Quel est votre plat pr√©f√©r√© ?",
            "Dans quelle ville √™tes-vous n√©(e) ?",
            "Quel est le pr√©nom de votre meilleur(e) ami(e) ?",
            "Quel est votre sport pr√©f√©r√© ?"
        ];

        const muscleGroups = {
            'Pectoraux': ['d√©velopp√© couch√©', 'd√©velopp√© inclin√©', 'd√©velopp√© d√©clin√©', '√©cart√©', 'dips', 'pompes', 'pec deck', 'butterfly'],
            'Dorsaux': ['tractions', 'tirage', 'rowing', 'pull over', 'soulev√© de terre'],
            '√âpaules': ['d√©velopp√© militaire', '√©l√©vation lat√©rale', 'oiseau', '√©l√©vation frontale', 'd√©velopp√© arnold'],
            'Biceps': ['curl', 'biceps', 'traction supination'],
            'Triceps': ['dips', 'extension', 'triceps', 'barre au front'],
            'Quadriceps': ['squat', 'presse', 'leg extension', 'fente', 'hack squat'],
            'Ischio-jambiers': ['leg curl', 'soulev√© de terre jambes tendues', 'good morning'],
            'Mollets': ['mollet', 'calf'],
            'Abdominaux': ['crunch', 'abdos', 'planche', 'gainage', 'relev√© de jambes'],
            'Fessiers': ['hip thrust', 'fessier', 'abduction', 'kickback']
        };

        function getMuscleGroup(exerciceName) {
            const name = exerciceName.toLowerCase();
            for (const [group, keywords] of Object.entries(muscleGroups)) {
                if (keywords.some(keyword => name.includes(keyword))) {
                    return group;
                }
            }
            return 'Autre';
        }

        function calculate1RM(weight, reps) {
            if (reps === 1) return weight;
            return Math.round(weight / (1.0278 - 0.0278 * reps));
        }

        class LivretApp {
            constructor() {
                this.isLoggedIn = false;
                this.currentUser = null;
                this.loginMode = 'login';
                this.resetMode = false;
                this.currentTab = 'sessions';
                this.sessions = [];
                this.currentSession = null;
                this.expandedSession = null;
                this.rmHistory = [];
                this.currentRM = null;
                this.musclesList = ['Pectoraux', 'Dorsaux', '√âpaules', 'Biceps', 'Triceps', 'Quadriceps', 'Ischio-jambiers', 'Mollets', 'Abdominaux', 'Fessiers'];
                this.objectifs = [
                    { value: 'force', label: 'Mobile 1 : D√©velopper sa force maximale', badge: 'badge-force' },
                    { value: 'endurance', label: 'Mobile 2 : D√©velopper son endurance musculaire', badge: 'badge-endurance' },
                    { value: 'equilibre', label: 'Mobile 3 : D√©velopper un physique √©quilibr√©', badge: 'badge-equilibre' }
                ];
                this.init();
            }

            init() {
                this.checkLogin();
                this.render();
            }

            checkLogin() {
                const userResult = storage.get('current-user');
                if (userResult) {
                    this.currentUser = JSON.parse(userResult.value);
                    this.isLoggedIn = true;
                    this.loadUserData();
                }
            }

            loadUserData() {
                const sessionsKey = `sessions-${this.currentUser.username}`;
                const sessionsResult = storage.get(sessionsKey);
                if (sessionsResult) {
                    this.sessions = JSON.parse(sessionsResult.value);
                }
                
                const rmKey = `rm-history-${this.currentUser.username}`;
                const rmResult = storage.get(rmKey);
                if (rmResult) {
                    this.rmHistory = JSON.parse(rmResult.value);
                }
            }

            saveUserData() {
                const sessionsKey = `sessions-${this.currentUser.username}`;
                storage.set(sessionsKey, JSON.stringify(this.sessions));
                alert('Donn√©es sauvegard√©es');
            }

            saveRMHistory() {
                const rmKey = `rm-history-${this.currentUser.username}`;
                storage.set(rmKey, JSON.stringify(this.rmHistory));
            }

            getBestRMByMuscleGroup() {
                const grouped = {};
                
                this.rmHistory.forEach(rm => {
                    const group = getMuscleGroup(rm.exercice);
                    
                    if (!grouped[group]) {
                        grouped[group] = [];
                    }
                    
                    grouped[group].push(rm);
                });

                const best = {};
                Object.keys(grouped).forEach(group => {
                    const exercises = {};
                    grouped[group].forEach(rm => {
                        if (!exercises[rm.exercice] || exercises[rm.exercice].rm1 < rm.rm1) {
                            exercises[rm.exercice] = rm;
                        }
                    });
                    best[group] = Object.values(exercises).sort((a, b) => b.rm1 - a.rm1);
                });

                return best;
            }

            calculateRM(e) {
                e.preventDefault();
                const exercice = document.getElementById('rm-exercice').value;
                const weight = parseFloat(document.getElementById('rm-weight').value);
                const reps = parseInt(document.getElementById('rm-reps').value);

                if (!exercice || !weight || !reps || reps < 1 || reps > 12) {
                    alert('Veuillez remplir tous les champs correctement (1-12 r√©p√©titions)');
                    return;
                }

                const rm1 = calculate1RM(weight, reps);
                
                this.currentRM = {
                    id: Date.now(),
                    exercice: exercice,
                    weight: weight,
                    reps: reps,
                    rm1: rm1,
                    date: new Date().toISOString()
                };

                this.rmHistory.unshift(this.currentRM);
                if (this.rmHistory.length > 50) {
                    this.rmHistory = this.rmHistory.slice(0, 50);
                }
                
                this.saveRMHistory();
                this.render();
            }

            deleteRM(id) {
                if (confirm('Supprimer ce calcul ?')) {
                    this.rmHistory = this.rmHistory.filter(rm => rm.id !== id);
                    this.saveRMHistory();
                    this.render();
                }
            }

            handleLogin(e) {
                e.preventDefault();
                const username = document.getElementById('login-username').value;
                const password = document.getElementById('login-password').value;
                
                const userKey = `user-${username}`;
                const userResult = storage.get(userKey, true);
                
                if (!userResult) {
                    alert('Nom utilisateur incorrect');
                    return;
                }
                
                const userData = JSON.parse(userResult.value);
                if (userData.password !== password) {
                    alert('Mot de passe incorrect');
                    return;
                }
                
                storage.set('current-user', JSON.stringify(userData));
                this.currentUser = userData;
                this.isLoggedIn = true;
                this.loadUserData();
                this.render();
            }

            handleSignup(e) {
                e.preventDefault();
                const fullName = document.getElementById('signup-fullname').value;
                const username = document.getElementById('signup-username').value.toLowerCase().replace(/\s+/g, '');
                const password = document.getElementById('signup-password').value;
                const confirmPassword = document.getElementById('signup-confirm').value;
                const securityQuestion = document.getElementById('signup-question').value;
                const securityAnswer = document.getElementById('signup-answer').value.toLowerCase().trim();
                
                if (password !== confirmPassword) {
                    alert('Les mots de passe ne correspondent pas');
                    return;
                }
                
                if (password.length < 4) {
                    alert('Le mot de passe doit contenir au moins 4 caract√®res');
                    return;
                }

                if (!securityAnswer) {
                    alert('Veuillez r√©pondre √† la question de s√©curit√©');
                    return;
                }

                const userKey = `user-${username}`;
                const existingUser = storage.get(userKey, true);
                
                if (existingUser) {
                    alert('Ce nom utilisateur existe d√©j√†');
                    return;
                }
                
                const newUser = {
                    username: username,
                    password: password,
                    fullName: fullName,
                    securityQuestion: securityQuestion,
                    securityAnswer: securityAnswer,
                    createdAt: new Date().toISOString()
                };
                
                storage.set(userKey, JSON.stringify(newUser), true);
                storage.set('current-user', JSON.stringify(newUser));
                
                this.currentUser = newUser;
                this.isLoggedIn = true;
                alert('Compte cr√©√© avec succ√®s');
                this.render();
            }

            handlePasswordReset(e) {
                e.preventDefault();
                const username = document.getElementById('reset-username').value;
                const answer = document.getElementById('reset-answer').value.toLowerCase().trim();
                const newPassword = document.getElementById('reset-newpassword').value;
                const confirmPassword = document.getElementById('reset-confirm').value;

                const userKey = `user-${username}`;
                const userResult = storage.get(userKey, true);
                
                if (!userResult) {
                    alert('Nom utilisateur incorrect');
                    return;
                }

                const userData = JSON.parse(userResult.value);

                if (userData.securityAnswer !== answer) {
                    alert('R√©ponse incorrecte');
                    return;
                }

                if (newPassword !== confirmPassword) {
                    alert('Les mots de passe ne correspondent pas');
                    return;
                }

                if (newPassword.length < 4) {
                    alert('Le mot de passe doit contenir au moins 4 caract√®res');
                    return;
                }

                userData.password = newPassword;
                storage.set(userKey, JSON.stringify(userData), true);
                
                alert('Mot de passe r√©initialis√©');
                this.resetMode = false;
                this.render();
            }

            handleLogout() {
                if (confirm('Vous d√©connecter ?')) {
                    storage.delete('current-user');
                    this.isLoggedIn = false;
                    this.currentUser = null;
                    this.sessions = [];
                    this.currentSession = null;
                    this.currentTab = 'sessions';
                    this.render();
                }
            }

            createNewSession() {
                this.currentSession = {
                    id: Date.now(),
                    date: new Date().toISOString().split('T')[0],
                    objectif: 'force',
                    echauffement: { cardio: '', mobilisation: '', activation: '' },
                    exercices: [],
                    muscles: [],
                    ressenti: '',
                    progression: ''
                };
                this.currentTab = 'sessions';
                this.render();
            }

            saveSession() {
                const date = document.getElementById('session-date').value;
                const objectif = document.getElementById('session-objectif').value;
                const cardio = document.getElementById('echauf-cardio').value;
                const mobilisation = document.getElementById('echauf-mobilisation').value;
                const activation = document.getElementById('echauf-activation').value;
                const ressenti = document.getElementById('session-ressenti').value;
                const progression = document.getElementById('session-progression').value;
                
                this.currentSession.date = date;
                this.currentSession.objectif = objectif;
                this.currentSession.echauffement = { cardio, mobilisation, activation };
                this.currentSession.ressenti = ressenti;
                this.currentSession.progression = progression;
                
                const existingIndex = this.sessions.findIndex(s => s.id === this.currentSession.id);
                
                if (existingIndex >= 0) {
                    this.sessions[existingIndex] = this.currentSession;
                } else {
                    this.sessions.push(this.currentSession);
                }
                
                const sessionsKey = `sessions-${this.currentUser.username}`;
                storage.set(sessionsKey, JSON.stringify(this.sessions));
                
                this.currentSession = null;
                this.render();
            }

            deleteSession(id) {
                if (confirm('Supprimer cette s√©ance ?')) {
                    this.sessions = this.sessions.filter(s => s.id !== id);
                    const sessionsKey = `sessions-${this.currentUser.username}`;
                    storage.set(sessionsKey, JSON.stringify(this.sessions));
                    this.render();
                }
            }

            addExercice() {
                this.currentSession.exercices.push({ nom: '', series: '', repetitions: '', charge: '', repos: '' });
                this.renderExercices();
            }

            removeExercice(index) {
                this.currentSession.exercices.splice(index, 1);
                this.renderExercices();
            }

            toggleMuscle(muscle) {
                const index = this.currentSession.muscles.indexOf(muscle);
                if (index > -1) {
                    this.currentSession.muscles.splice(index, 1);
                } else {
                    this.currentSession.muscles.push(muscle);
                }
                this.renderMuscles();
            }render() {
                const app = document.getElementById('app');
                
                if (!this.isLoggedIn) {
                    if (this.resetMode) {
                        app.innerHTML = this.renderPasswordReset();
                        this.attachResetEvents();
                    } else {
                        app.innerHTML = this.renderLogin();
                        this.attachLoginEvents();
                    }
                } else if (this.currentSession) {
                    app.innerHTML = this.renderSessionForm();
                    this.attachSessionFormEvents();
                } else {
                    app.innerHTML = this.renderDashboard();
                    this.attachDashboardEvents();
                }
            }

            renderPasswordReset() {
                return `
                    <div class="container" style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
                        <div class="card" style="max-width: 500px; width: 100%;">
                            <div style="text-align: center; margin-bottom: 2rem;">
                                <div class="lock-icon" style="margin: 0 auto 1rem;">üîë</div>
                                <h1 class="text-white" style="font-size: 2rem; margin-bottom: 0.5rem;">R√©initialiser mot de passe</h1>
                                <p class="text-cyan">R√©pondez √† votre question de s√©curit√©</p>
                            </div>
                            
                            <form id="reset-form" style="display: flex; flex-direction: column; gap: 1rem;">
                                <div>
                                    <label class="text-cyan mb-1" style="display: block; font-size: 0.875rem; font-weight: 500;">Nom utilisateur</label>
                                    <input type="text" id="reset-username" class="input" placeholder="votre-nom" required>
                                </div>
                                <div id="question-container" style="display: none;">
                                    <label class="text-cyan mb-1" style="display: block; font-size: 0.875rem; font-weight: 500;" id="question-label">Question de s√©curit√©</label>
                                    <input type="text" id="reset-answer" class="input" placeholder="Votre r√©ponse">
                                </div>
                                <div id="password-container" style="display: none;">
                                    <div style="margin-bottom: 1rem;">
                                        <label class="text-cyan mb-1" style="display: block; font-size: 0.875rem; font-weight: 500;">Nouveau mot de passe</label>
                                        <input type="password" id="reset-newpassword" class="input" placeholder="nouveau mot de passe">
                                    </div>
                                    <div>
                                        <label class="text-cyan mb-1" style="display: block; font-size: 0.875rem; font-weight: 500;">Confirmer</label>
                                        <input type="password" id="reset-confirm" class="input" placeholder="confirmer">
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-success" style="width: 100%; padding: 1rem;">R√©initialiser</button>
                                <button type="button" class="btn btn-link" onclick="app.resetMode=false; app.render()" style="width: 100%;">Retour √† la connexion</button>
                            </form>
                        </div>
                    </div>
                `;
            }

            renderLogin() {
                return `
                    <div class="container" style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
                        <div class="card" style="max-width: 500px; width: 100%;">
                            <div style="text-align: center; margin-bottom: 2rem;">
                                <div class="lock-icon" style="margin: 0 auto 1rem;">üîí</div>
                                <h1 class="text-white" style="font-size: 2rem; margin-bottom: 0.5rem;">Livret de Musculation</h1>
                                <p class="text-cyan">Formation CAP</p>
                            </div>
                            
                            <div class="flex gap-2 mb-4">
                                <button class="btn btn-${this.loginMode === 'login' ? 'primary' : 'secondary'}" style="flex: 1;" onclick="app.loginMode='login'; app.render()">Connexion</button>
                                <button class="btn btn-${this.loginMode === 'signup' ? 'primary' : 'secondary'}" style="flex: 1;" onclick="app.loginMode='signup'; app.render()">Inscription</button>
                            </div>

                            ${this.loginMode === 'login' ? this.renderLoginForm() : this.renderSignupForm()}
                            
                            <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(6, 182, 212, 0.2); border-radius: 0.75rem; border: 1px solid rgba(6, 182, 212, 0.3);">
                                <p class="text-center" style="color: #67e8f9; font-size: 0.875rem;">Chaque √©l√®ve cr√©e son propre compte</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderLoginForm() {
                return `
                    <form id="login-form" style="display: flex; flex-direction: column; gap: 1rem;">
                        <div>
                            <label class="text-cyan mb-1" style="display: block; font-size: 0.875rem; font-weight: 500;">Nom utilisateur</label>
                            <input type="text" id="login-username" class="input" placeholder="votre-nom" required>
                        </div>
                        <div>
                            <label class="text-cyan mb-1" style="display: block; font-size: 0.875rem; font-weight: 500;">Mot de passe</label>
                            <input type="password" id="login-password" class="input" placeholder="mot de passe" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem;">Se connecter</button>
                        <button type="button" class="btn btn-link" onclick="app.resetMode=true; app.render()" style="width: 100%;">Mot de passe oubli√© ?</button>
                    </form>
                `;
            }

            renderSignupForm() {
                return `
                    <form id="signup-form" style="display: flex; flex-direction: column; gap: 1rem;">
                        <div>
                            <label class="text-cyan mb-1" style="display: block; font-size: 0.875rem; font-weight: 500;">Nom complet</label>
                            <input type="text" id="signup-fullname" class="input" placeholder="Pr√©nom Nom" required>
                        </div>
                        <div>
                            <label class="text-cyan mb-1" style="display: block; font-size: 0.875rem; font-weight: 500;">Nom utilisateur</label>
                            <input type="text" id="signup-username" class="input" placeholder="votre-nom" required>
                            <p style="color: #67e8f9; font-size: 0.75rem; margin-top: 0.25rem;">Sans espaces ni caract√®res sp√©ciaux</p>
                        </div>
                        <div>
                            <label class="text-cyan mb-1" style="display: block; font-size: 0.875rem; font-weight: 500;">Mot de passe</label>
                            <input type="password" id="signup-password" class="input" placeholder="mot de passe" required>
                        </div>
                        <div>
                            <label class="text-cyan mb-1" style="display: block; font-size: 0.875rem; font-weight: 500;">Confirmer</label>
                            <input type="password" id="signup-confirm" class="input" placeholder="confirmer" required>
                        </div>
                        <div style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 1rem; margin-top: 0.5rem;">
                            <p class="text-white mb-2" style="font-size: 0.875rem; font-weight: 600;">Question de s√©curit√©</p>
                            <label class="text-cyan mb-1" style="display: block; font-size: 0.875rem; font-weight: 500;">Choisissez une question</label>
                            <select id="signup-question" class="input" required>
                                ${securityQuestions.map((q, i) => `<option value="${i}">${q}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="text-cyan mb-1" style="display: block; font-size: 0.875rem; font-weight: 500;">Votre r√©ponse</label>
                            <input type="text" id="signup-answer" class="input" placeholder="Votre r√©ponse" required>
                            <p style="color: #67e8f9; font-size: 0.75rem; margin-top: 0.25rem;">M√©morisez bien votre r√©ponse</p>
                        </div>
                        <button type="submit" class="btn btn-success" style="width: 100%; padding: 1rem;">Cr√©er mon compte</button>
                    </form>
                `;
            }

            renderDashboard() {
                return `
                    <div class="container">
                        <div class="card">
                            <div class="flex justify-between items-center" style="flex-wrap: wrap; gap: 1rem;">
                                <div class="flex items-center gap-3">
                                    <div style="width: 3rem; height: 3rem; background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%); border-radius: 0.75rem; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üë§</div>
                                    <div>
                                        <h1 class="text-white" style="font-size: 1.5rem; font-weight: bold;">Bienvenue ${this.currentUser.fullName}</h1>
                                        <p class="text-cyan">@${this.currentUser.username}</p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button class="btn btn-success" onclick="app.saveUserData()">üíæ Sauvegarder</button>
                                    <button class="btn btn-secondary" onclick="app.handleLogout()">üö™ D√©connexion</button>
                                </div>
                            </div>
                        </div>

                        <div class="flex gap-2 mb-4" style="overflow-x: auto;">
                            <button class="tab-btn ${this.currentTab === 'sessions' ? 'active' : ''}" onclick="app.currentTab='sessions'; app.render()">üìÖ S√©ances</button>
                            <button class="tab-btn ${this.currentTab === 'rm' ? 'active' : ''}" onclick="app.currentTab='rm'; app.render()">üí™ Calculateur RM</button>
                        </div>

                        ${this.currentTab === 'sessions' ? this.renderSessionsTab() : this.renderRMTab()}
                    </div>
                `;
            }

            renderSessionsTab() {
                return `
                    <button class="btn btn-primary" style="width: 100%; padding: 1.5rem; font-size: 1.25rem; margin-bottom: 1.5rem;" onclick="app.createNewSession()">‚ûï Cr√©er une nouvelle s√©ance</button>

                    <div class="card">
                        <h2 class="text-white mb-4" style="font-size: 1.5rem; font-weight: bold;">üìÖ Mes s√©ances (${this.sessions.length})</h2>
                        
                        ${this.sessions.length === 0 ? `
                            <div style="padding: 3rem; text-align: center; background: rgba(255, 255, 255, 0.05); border-radius: 1rem; border: 1px solid rgba(255, 255, 255, 0.1);">
                                <p class="text-cyan" style="font-size: 1.125rem;">Aucune s√©ance</p>
                            </div>
                        ` : this.sessions.sort((a, b) => new Date(b.date) - new Date(a.date)).map(session => this.renderSessionCard(session)).join('')}
                    </div>
                `;
            }

            renderRMTab() {
                const bestByGroup = this.getBestRMByMuscleGroup();
                const muscleGroupIcons = {
                    'Pectoraux': 'üí™',
                    'Dorsaux': 'üèãÔ∏è',
                    '√âpaules': 'ü§∏',
                    'Biceps': 'üí™',
                    'Triceps': 'üí™',
                    'Quadriceps': 'ü¶µ',
                    'Ischio-jambiers': 'ü¶µ',
                    'Mollets': 'ü¶∂',
                    'Abdominaux': 'üèÉ',
                    'Fessiers': 'üçë',
                    'Autre': 'üéØ'
                };

                return `
                    <div class="card">
                        <h2 class="text-white mb-4" style="font-size: 1.75rem; font-weight: bold;">üí™ Calculateur de RM</h2>
                        <p class="text-cyan mb-4">Calculez votre charge maximale th√©orique (1RM)</p>
                        
                        <form id="rm-form" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div>
                                <label class="text-cyan mb-1" style="display: block; font-weight: 500;">Exercice</label>
                                <input type="text" id="rm-exercice" class="input" placeholder="Ex: D√©velopp√© couch√©" required>
                            </div>
                            <div>
                                <label class="text-cyan mb-1" style="display: block; font-weight: 500;">Charge (kg)</label>
                                <input type="number" id="rm-weight" class="input" placeholder="Ex: 80" step="0.5" required>
                            </div>
                            <div>
                                <label class="text-cyan mb-1" style="display: block; font-weight: 500;">R√©p√©titions</label>
                                <input type="number" id="rm-reps" class="input" placeholder="Ex: 8" min="1" max="12" required>
                            </div>
                            <div style="display: flex; align-items: flex-end;">
                                <button type="submit" class="btn btn-primary" style="width: 100%;">Calculer</button>
                            </div>
                        </form>

                        ${this.currentRM ? `
                            <div class="rm-result">
                                <h3 class="text-white" style="font-size: 1.25rem; font-weight: 600;">${this.currentRM.exercice}</h3>
                                <p class="text-cyan" style="margin: 0.5rem 0;">${this.currentRM.weight}kg √ó ${this.currentRM.reps} r√©p√©titions</p>
                                <div class="rm-value">${this.currentRM.rm1} kg</div>
                                <p class="text-white" style="font-weight: 600;">1RM Th√©orique</p>
                                
                                <div class="percentage-grid">
                                    ${[95, 90, 85, 80, 75, 70, 65, 60].map(percent => `
                                        <div class="percentage-card">
                                            <div style="color: #06b6d4; font-size: 1.5rem; font-weight: bold;">${Math.round(this.currentRM.rm1 * percent / 100)}kg</div>
                                            <div style="color: rgba(255,255,255,0.7); font-size: 0.875rem; margin-top: 0.25rem;">${percent}%</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <h3 class="text-white mb-4" style="font-size: 1.5rem; font-weight: bold; margin-top: 2rem;">üìä Tableau R√©capitulatif par Groupe Musculaire</h3>
                        
                        ${Object.keys(bestByGroup).length === 0 ? `
                            <div style="padding: 2rem; text-align: center; background: rgba(255, 255, 255, 0.05); border-radius: 1rem;">
                                <p class="text-cyan">Aucun test effectu√© pour le moment</p>
                            </div>
                        ` : `
                            ${Object.entries(bestByGroup).sort(([a], [b]) => a.localeCompare(b)).map(([group, exercises]) => `
                                <div class="muscle-group-card">
                                    <div class="muscle-group-header">
                                        <div class="muscle-group-icon">${muscleGroupIcons[group] || 'üí™'}</div>
                                        <h4 class="text-white" style="font-size: 1.25rem; font-weight: bold;">${group}</h4>
                                    </div>
                                    ${exercises.map(rm => `
                                        <div class="exercise-row">
                                            <div>
                                                <div class="text-white" style="font-weight: 600;">${rm.exercice}</div>
                                                <div class="text-cyan" style="font-size: 0.875rem;">${rm.weight}kg √ó ${rm.reps} reps</div>
                                            </div>
                                            <div style="text-align: right;">
                                                <div style="color: #10b981; font-size: 1.5rem; font-weight: bold;">${rm.rm1}kg</div>
                                                <div style="color: rgba(255,255,255,0.5); font-size: 0.75rem;">1RM</div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            `).join('')}
                        `}

                        <h3 class="text-white mb-2" style="font-size: 1.25rem; font-weight: bold; margin-top: 2rem;">üìã Historique complet</h3>
                        
                        ${this.rmHistory.length === 0 ? `
                            <div style="padding: 2rem; text-align: center; background: rgba(255, 255, 255, 0.05); border-radius: 1rem;">
                                <p class="text-cyan">Aucun calcul enregistr√©</p>
                            </div>
                        ` : `
                            <div style="display: grid; gap: 1rem;">
                                ${this.rmHistory.map(rm => `
                                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 1rem; padding: 1rem; border: 1px solid rgba(255, 255, 255, 0.1);">
                                        <div class="flex justify-between items-center" style="flex-wrap: wrap; gap: 1rem;">
                                            <div style="flex: 1;">
                                                <h4 class="text-white" style="font-weight: 600; margin-bottom: 0.25rem;">${rm.exercice}</h4>
                                                <p class="text-cyan" style="font-size: 0.875rem;">${rm.weight}kg √ó ${rm.reps} reps ‚Üí <strong style="color: #10b981;">${rm.rm1}kg</strong></p>
                                                <p style="color: rgba(255,255,255,0.5); font-size: 0.75rem; margin-top: 0.25rem;">${new Date(rm.date).toLocaleDateString('fr-FR')}</p>
                                            </div>
                                            <button class="btn btn-danger" onclick="app.deleteRM(${rm.id})">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                `;
            }renderSessionCard(session) {
                const objectif = this.objectifs.find(o => o.value === session.objectif);
                const isExpanded = this.expandedSession === session.id;
                
                return `
                    <div class="session-card" onclick="app.expandedSession = app.expandedSession === ${session.id} ? null : ${session.id}; app.render()">
                        <div class="flex justify-between items-center" style="flex-wrap: wrap; gap: 1rem;">
                            <div style="flex: 1;">
                                <div class="flex items-center gap-3 mb-2" style="flex-wrap: wrap;">
                                    <span class="text-white" style="font-size: 1.125rem; font-weight: 600;">${new Date(session.date).toLocaleDateString('fr-FR')}</span>
                                    <span class="badge ${objectif.badge}">${objectif.label.split(':')[0]}</span>
                                </div>
                                <p class="text-cyan">${session.exercices.length} exercices - ${session.muscles.length} groupes</p>
                            </div>
                            <div class="flex gap-2">
                                <button class="btn" style="background: rgba(6, 182, 212, 0.2); color: #67e8f9;" onclick="event.stopPropagation(); app.currentSession = JSON.parse('${JSON.stringify(session).replace(/'/g, "\\'")}'); app.render()">Modifier</button>
                                <button class="btn btn-danger" onclick="event.stopPropagation(); app.deleteSession(${session.id})">üóëÔ∏è</button>
                            </div>
                        </div>
                        
                        ${isExpanded ? `
                            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.2);">
                                <div class="mb-2">
                                    <h4 class="text-white mb-1" style="font-weight: 600;">Muscles</h4>
                                    <div class="flex gap-2" style="flex-wrap: wrap;">
                                        ${session.muscles.map(m => `<span style="padding: 0.25rem 0.75rem; background: rgba(6, 182, 212, 0.3); color: #67e8f9; border-radius: 0.5rem; font-size: 0.875rem;">${m}</span>`).join('')}
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <h4 class="text-white mb-1" style="font-weight: 600;">Exercices</h4>
                                    ${session.exercices.map(ex => `
                                        <div style="background: rgba(255, 255, 255, 0.05); padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 0.5rem; color: rgba(255, 255, 255, 0.8);">
                                            ${ex.nom} - ${ex.series}x${ex.repetitions} @ ${ex.charge}kg
                                        </div>
                                    `).join('')}
                                </div>
                                ${session.ressenti ? `
                                    <div>
                                        <h4 class="text-white mb-1" style="font-weight: 600;">Ressenti</h4>
                                        <p style="color: rgba(255, 255, 255, 0.7);">${session.ressenti}</p>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            renderSessionForm() {
                const currentObjectif = this.objectifs.find(o => o.value === this.currentSession.objectif);
                
                return `
                    <div class="container">
                        <div class="card">
                            <div class="flex justify-between items-center mb-4" style="flex-wrap: wrap; gap: 1rem;">
                                <h2 class="text-white" style="font-size: 1.75rem; font-weight: bold;">Nouvelle S√©ance</h2>
                                <div class="flex gap-2">
                                    <button class="btn btn-secondary" onclick="app.currentSession = null; app.render()">Annuler</button>
                                    <button class="btn btn-success" onclick="app.saveSession()">üíæ Enregistrer</button>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div>
                                    <label class="text-cyan mb-1" style="display: block; font-weight: 500;">Date</label>
                                    <input type="date" id="session-date" class="input" value="${this.currentSession.date}">
                                </div>
                                <div>
                                    <label class="text-cyan mb-1" style="display: block; font-weight: 500;">Objectif</label>
                                    <select id="session-objectif" class="input">
                                        ${this.objectifs.map(obj => `<option value="${obj.value}" ${obj.value === this.currentSession.objectif ? 'selected' : ''}>${obj.label}</option>`).join('')}
                                    </select>
                                </div>
                            </div>

                            <div style="background: linear-gradient(135deg, rgba(251, 146, 60, 0.2) 0%, rgba(249, 115, 22, 0.2) 100%); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; border: 1px solid rgba(251, 146, 60, 0.3);">
                                <h3 class="text-white mb-2" style="font-size: 1.25rem; font-weight: bold;">üî• √âchauffement</h3>
                                <div style="display: flex; flex-direction: column; gap: 1rem;">
                                    <div>
                                        <label style="display: block; color: #fed7aa; margin-bottom: 0.5rem;">1. Cardio (5-10 min)</label>
                                        <input type="text" id="echauf-cardio" class="input" placeholder="Ex: V√©lo" value="${this.currentSession.echauffement.cardio}">
                                    </div>
                                    <div>
                                        <label style="display: block; color: #fed7aa; margin-bottom: 0.5rem;">2. Mobilisation articulaire</label>
                                        <input type="text" id="echauf-mobilisation" class="input" placeholder="Ex: Rotations" value="${this.currentSession.echauffement.mobilisation}">
                                    </div>
                                    <div>
                                        <label style="display: block; color: #fed7aa; margin-bottom: 0.5rem;">3. Activation musculaire</label>
                                        <input type="text" id="echauf-activation" class="input" placeholder="Ex: S√©ries l√©g√®res" value="${this.currentSession.echauffement.activation}">
                                    </div>
                                </div>
                            </div>

                            <div style="background: rgba(6, 182, 212, 0.2); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; border: 1px solid rgba(6, 182, 212, 0.3);">
                                <div class="flex justify-between items-center mb-2" style="flex-wrap: wrap; gap: 1rem;">
                                    <h3 class="text-white" style="font-size: 1.25rem; font-weight: bold;">üéØ Exercices - ${currentObjectif.label}</h3>
                                    <button class="btn btn-primary" onclick="app.addExercice()">‚ûï Ajouter</button>
                                </div>
                                
                                <div id="exercices-list"></div>
                            </div>

                            <div class="card mb-4">
                                <h3 class="text-white mb-2" style="font-size: 1.25rem; font-weight: bold;">üí™ Muscles travaill√©s</h3>
                                <div class="grid grid-cols-5 gap-2" id="muscles-list"></div>
                            </div>

                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="text-cyan mb-1" style="display: block; font-weight: 500;">Ressenti</label>
                                    <textarea id="session-ressenti" class="input" style="height: 6rem;" placeholder="Comment vous √™tes-vous senti">${this.currentSession.ressenti}</textarea>
                                </div>
                                <div>
                                    <label class="text-cyan mb-1" style="display: block; font-weight: 500;">Progression</label>
                                    <textarea id="session-progression" class="input" style="height: 6rem;" placeholder="Augmentation charges">${this.currentSession.progression}</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            attachLoginEvents() {
                const loginForm = document.getElementById('login-form');
                const signupForm = document.getElementById('signup-form');
                
                if (loginForm) {
                    loginForm.addEventListener('submit', (e) => this.handleLogin(e));
                }
                
                if (signupForm) {
                    signupForm.addEventListener('submit', (e) => this.handleSignup(e));
                }
            }

            attachResetEvents() {
                const resetForm = document.getElementById('reset-form');
                const usernameInput = document.getElementById('reset-username');
                
                if (usernameInput) {
                    usernameInput.addEventListener('blur', () => {
                        const username = usernameInput.value;
                        if (username) {
                            const userKey = `user-${username}`;
                            const userResult = storage.get(userKey, true);
                            
                            if (userResult) {
                                const userData = JSON.parse(userResult.value);
                                const questionContainer = document.getElementById('question-container');
                                const questionLabel = document.getElementById('question-label');
                                const passwordContainer = document.getElementById('password-container');
                                
                                questionLabel.textContent = securityQuestions[userData.securityQuestion];
                                questionContainer.style.display = 'block';
                                passwordContainer.style.display = 'block';
                            }
                        }
                    });
                }
                
                if (resetForm) {
                    resetForm.addEventListener('submit', (e) => this.handlePasswordReset(e));
                }
            }

            attachDashboardEvents() {
                const rmForm = document.getElementById('rm-form');
                if (rmForm) {
                    rmForm.addEventListener('submit', (e) => this.calculateRM(e));
                }
            }

            attachSessionFormEvents() {
                this.renderExercices();
                this.renderMuscles();
            }

            renderExercices() {
                const container = document.getElementById('exercices-list');
                if (!container) return;
                
                container.innerHTML = this.currentSession.exercices.map((ex, index) => `
                    <div style="background: rgba(255, 255, 255, 0.1); border-radius: 0.75rem; padding: 1rem; margin-bottom: 0.75rem; border: 1px solid rgba(255, 255, 255, 0.2);">
                        <div class="grid grid-cols-5 gap-2 mb-2">
                            <input type="text" class="input" placeholder="Exercice" value="${ex.nom}" style="grid-column: span 2;" data-index="${index}" data-field="nom">
                            <input type="text" class="input" placeholder="S√©ries" value="${ex.series}" data-index="${index}" data-field="series">
                            <input type="text" class="input" placeholder="Reps" value="${ex.repetitions}" data-index="${index}" data-field="repetitions">
                            <input type="text" class="input" placeholder="Charge" value="${ex.charge}" data-index="${index}" data-field="charge">
                        </div>
                        <div class="flex gap-2">
                            <input type="text" class="input" placeholder="Repos ex: 90s" value="${ex.repos}" style="flex: 1;" data-index="${index}" data-field="repos">
                            <button class="btn btn-danger" onclick="app.removeExercice(${index})">üóëÔ∏è</button>
                        </div>
                    </div>
                `).join('');

                container.querySelectorAll('input').forEach(input => {
                    input.addEventListener('input', (e) => {
                        const index = parseInt(e.target.dataset.index);
                        const field = e.target.dataset.field;
                        this.currentSession.exercices[index][field] = e.target.value;
                    });
                });
            }

            renderMuscles() {
                const container = document.getElementById('muscles-list');
                if (!container) return;
                
                container.innerHTML = this.musclesList.map(muscle => `
                    <button class="muscle-btn ${this.currentSession.muscles.includes(muscle) ? 'active' : ''}" onclick="app.toggleMuscle('${muscle}')">
                        ${muscle}
                    </button>
                `).join('');
            }
        }

        const app = new LivretApp();
    </script>
</body>
</html>