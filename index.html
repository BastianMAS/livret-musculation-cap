<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Livret de Musculation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #06b6d4;
            --primary-dark: #0891b2;
            --secondary-color: #10b981;
            --accent-color: #fb923c;
            --bg-dark: #0f172a;
            --bg-medium: #1e293b;
            --text-light: #e2e8f0;
            --text-cyan: #67e8f9;
        }

        body.theme-blue {
            --primary-color: #3b82f6;
            --primary-dark: #2563eb;
            --secondary-color: #06b6d4;
            --accent-color: #8b5cf6;
        }

        body.theme-green {
            --primary-color: #10b981;
            --primary-dark: #059669;
            --secondary-color: #14b8a6;
            --accent-color: #84cc16;
        }

        body.theme-purple {
            --primary-color: #a855f7;
            --primary-dark: #9333ea;
            --secondary-color: #ec4899;
            --accent-color: #f43f5e;
        }

        body.theme-orange {
            --primary-color: #f97316;
            --primary-dark: #ea580c;
            --secondary-color: #fb923c;
            --accent-color: #fbbf24;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 100%);
            min-height: 100vh;
            color: var(--text-light);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .card {
            background: rgba(30, 41, 59, 0.95);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .text-white { color: #f1f5f9; }
        .text-cyan { color: var(--text-cyan); }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }

        .input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 0.75rem;
            color: #f1f5f9;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(6, 182, 212, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn-warning:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(245, 158, 11, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(100, 116, 139, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(239, 68, 68, 0.4);
        }

        .fab-button {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .fab-button:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 15px 40px rgba(6, 182, 212, 0.6);
        }
        
        .fab-menu {
            position: fixed;
            bottom: 6rem;
            right: 2rem;
            background: rgba(30, 41, 59, 0.98);
            border-radius: 1rem;
            padding: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 999;
            min-width: 200px;
            backdrop-filter: blur(10px);
        }
        
        .fab-menu-item {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.5rem;
            color: white;
            text-decoration: none;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .fab-menu-item:last-child {
            margin-bottom: 0;
        }
        
        .fab-menu-item:hover {
            background: var(--primary-color);
            transform: translateX(-5px);
        }
        
        .search-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 2rem;
        }
        
        .search-modal {
            background: var(--bg-medium);
            border-radius: 1rem;
            padding: 2rem;
            width: 100%;
            max-width: 600px;
            margin-top: 5rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
        }
        
        .search-result {
            padding: 1rem;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .search-result:hover {
            background: var(--primary-color);
            transform: translateX(5px);
        }
        .btn-link {
            background: transparent;
            color: var(--text-cyan);
            padding: 0.5rem 1rem;
        }

        .btn-link:hover {
            background: rgba(6, 182, 212, 0.1);
        }

        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .items-center { align-items: center; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .grid { display: grid; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .text-center { text-align: center; }

        .user-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: 0 10px 25px -5px rgba(6, 182, 212, 0.4);
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.75rem;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            white-space: nowrap;
        }

        .tab-btn:hover {
            background: rgba(6, 182, 212, 0.1);
            color: var(--text-cyan);
            border-color: rgba(6, 182, 212, 0.3);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .sub-tab-btn {
            padding: 0.6rem 1rem;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.6rem;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .sub-tab-btn:hover {
            background: rgba(6, 182, 212, 0.1);
            color: var(--text-cyan);
            border-color: rgba(6, 182, 212, 0.3);
        }

        .sub-tab-btn.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .hidden { display: none; }

        .rm-history-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .rm-history-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(6, 182, 212, 0.2);
            border-color: rgba(6, 182, 212, 0.3);
        }

        .session-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .session-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(6, 182, 212, 0.2);
            border-color: rgba(6, 182, 212, 0.3);
        }

        .session-card.completed {
            border-color: rgba(16, 185, 129, 0.5);
            background: rgba(16, 185, 129, 0.05);
        }

        .session-completed-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .session-history-item {
            background: rgba(15, 23, 42, 0.4);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-force {
            background: rgba(249, 115, 22, 0.2);
            color: #fb923c;
            border: 1px solid rgba(249, 115, 22, 0.3);
        }

        .badge-endurance {
            background: rgba(6, 182, 212, 0.2);
            color: #67e8f9;
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .badge-équilibre {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .avatar-upload {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(15, 23, 42, 0.8);
            border: 3px dashed rgba(6, 182, 212, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin: 0 auto;
            transition: all 0.3s ease;
            font-size: 2.5rem;
        }

        .avatar-upload:hover {
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-color);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .default-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }

        .muscle-btn {
            padding: 1rem;
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.75rem;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-align: center;
        }

        .muscle-btn:hover {
            background: rgba(6, 182, 212, 0.1);
            color: var(--text-cyan);
            border-color: rgba(6, 182, 212, 0.3);
            transform: translateY(-2px);
        }

        .muscle-btn.selected {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .exercice-item {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .tip-box {
            background: rgba(6, 182, 212, 0.1);
            border-left: 4px solid var(--primary-color);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .content-section { margin-bottom: 2rem; }

        .exercise-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .exercise-card h4 {
            color: var(--text-cyan);
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }

        .exercise-card ul {
            list-style: none;
            padding-left: 0;
        }

        .exercise-card ul li {
            color: var(--text-light);
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .exercise-card ul li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
        }

        .mobile-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .mobile-table th {
            background: rgba(6, 182, 212, 0.2);
            color: var(--text-cyan);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(6, 182, 212, 0.3);
        }

        .mobile-table td {
            padding: 1rem;
            color: var(--text-light);
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .mobile-table tr:hover {
            background: rgba(6, 182, 212, 0.05);
        }

        .muscle-info-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .muscle-info-card h4 {
            color: var(--text-cyan);
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }

        .muscle-info-section {
            margin-bottom: 1rem;
        }

        .muscle-info-section h5 {
            color: #10b981;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .muscle-info-section p {
            color: var(--text-light);
            line-height: 1.7;
            margin-bottom: 0.5rem;
        }

        .muscle-info-section ul {
            list-style: none;
            padding-left: 0;
        }

        .muscle-info-section ul li {
            color: var(--text-light);
            padding: 0.4rem 0;
            padding-left: 1.5rem;
            position: relative;
            line-height: 1.6;
        }

        .muscle-info-section ul li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
        }

        .timer-container {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 2px solid rgba(6, 182, 212, 0.4);
            border-radius: 1.5rem;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .timer-display {
            font-size: 5rem;
            font-weight: bold;
            color: var(--text-cyan);
            margin: 2rem 0;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 20px rgba(6, 182, 212, 0.5);
        }

        .timer-display.running {
            color: #10b981;
            animation: pulse 1s infinite;
        }

        .timer-display.finished {
            color: #ef4444;
            animation: blink 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .timer-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin: 1.5rem 0;
        }

        .timer-preset {
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            color: var(--text-cyan);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .timer-preset:hover {
            background: rgba(6, 182, 212, 0.2);
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .timer-preset.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: transparent;
        }

        .timer-input-group {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            align-items: center;
            margin: 1rem 0;
        }

        .timer-input {
            width: 80px;
            padding: 0.5rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 0.5rem;
            color: #f1f5f9;
            font-size: 1rem;
            text-align: center;
        }

        .chrono-laps {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 1rem;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 0.75rem;
            padding: 1rem;
        }

        .lap-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
            color: var(--text-light);
        }

        .lap-item:last-child {
            border-bottom: none;
        }

        .session-notes-area {
            width: 100%;
            min-height: 100px;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 0.75rem;
            color: #f1f5f9;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
        }

        .session-notes-area:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        .session-completion-modal {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .charges-calculator {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.2) 0%, rgba(251, 146, 60, 0.2) 100%);
            border: 2px solid rgba(249, 115, 22, 0.4);
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .charges-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .charges-table th {
            background: rgba(249, 115, 22, 0.3);
            color: #fb923c;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(249, 115, 22, 0.3);
        }

        .charges-table td {
            padding: 1rem;
            color: var(--text-light);
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .charges-table tr:hover {
            background: rgba(249, 115, 22, 0.1);
        }

        .charge-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #fb923c;
        }

        .search-container {
            position: sticky;
            top: 0;
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem;
            border-radius: 1rem;
            margin-bottom: 1.5rem;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .search-input-wrapper {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            padding-left: 3rem;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 0.75rem;
            color: #f1f5f9;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        .filter-chips {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.75rem;
        }

        .filter-chip {
            padding: 0.5rem 1rem;
            background: rgba(6, 182, 212, 0.2);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 2rem;
            color: var(--text-cyan);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .filter-chip:hover {
            background: rgba(6, 182, 212, 0.3);
            transform: translateY(-2px);
        }

        .filter-chip.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: transparent;
        }

        .no-results {
            text-align: center;
            padding: 3rem 1rem;
            color: #94a3b8;
        }

        .no-results-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .offline-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        .online-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10b981;
            margin-right: 0.5rem;
            animation: pulse-indicator 2s infinite;
        }

        .offline-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ef4444;
            margin-right: 0.5rem;
        }

        @keyframes pulse-indicator {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chart-container {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .chart-container canvas {
            max-height: 400px;
        }

        .theme-selector {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .theme-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .theme-btn:hover {
            transform: scale(1.1);
        }

        .theme-btn.active {
            border-color: white;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .theme-btn.theme-cyan { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); }
        .theme-btn.theme-blue { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .theme-btn.theme-green { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .theme-btn.theme-purple { background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%); }
        .theme-btn.theme-orange { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); }



        .photo-item img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
        }


        .photo-placeholder:hover {
            border-color: var(--primary-color);
            transform: scale(1.02);
        }

        .badge-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .badge-item {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .badge-item.unlocked {
            border-color: var(--primary-color);
            background: rgba(6, 182, 212, 0.1);
        }

        .badge-item.locked {
            opacity: 0.4;
        }

        .badge-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .badge-item.unlocked .badge-icon {
            animation: bounce 1s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            .grid-cols-2, .grid-cols-3 { grid-template-columns: 1fr; }
            .container { padding: 0.5rem; }
            .card { padding: 1rem; border-radius: 1rem; }
            .flex { flex-direction: column; }
            .tab-btn, .sub-tab-btn { width: 100%; text-align: center; }
            .timer-display { font-size: 3rem; }
            .badge-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div id="offline-banner" class="hidden"></div>
    <div id="app"></div>
    <script>// PARTIE 2/4 - DONNÉES ET SÉCURITÉ
        
        // SYSTÈME DE STOCKAGE LOCAL
        const storage = {
            save: (key, value) => {
                try {
                    const fullKey = `user-${app.currentUser}-${key}`;
                    const jsonValue = typeof value === 'string' ? value : JSON.stringify(value);
                    localStorage.setItem(fullKey, jsonValue);
                    return true;
                } catch (e) {
                    console.error('Erreur de sauvegarde:', e);
                    return false;
                }
            },
            
            get: (key, isGlobal = false) => {
                try {
                    const fullKey = isGlobal ? key : `user-${app.currentUser}-${key}`;
                    const value = localStorage.getItem(fullKey);
                    return {
                        exists: value !== null,
                        value: value
                    };
                } catch (e) {
                    console.error('Erreur de lecture:', e);
                    return { exists: false, value: null };
                }
            }
        };

        // SYSTÈME DE SÉCURITÉ PAR CODE D'ACCÈS
        const securite = {
            classes: {
                "2_CAP_ECP_25_26": {
                    code: "2CAPECP25",
                    nom: "2 CAP ECP 25-26",
                    eleves: [
                        "AZOULAI EDEN",
                        "BORRALHO EMMA",
                        "CARRILHO RITO LEANA",
                        "DE MATOS AMBRE",
                        "FAUCHER CAMILLE",
                        "FAUSTIN NINA",
                        "HOUËT LORELINE",
                        "LANDON LOUANE",
                        "MARCHIONE LAURA",
                        "PAPUCHON MELODIE",
                        "SIMON DAPHNE",
                        "STANKOVIC NINA",
                        "TASSILLY LENA",
                        "TRAN ALICE",
                        "VU--NGUYEN LEA"
                    ]
                },
                "1_CAP_ECP_25_26": {
                    code: "1CAPECP25",
                    nom: "1 CAP ECP 25-26",
                    eleves: [
                        "ALVAREZ ELUNA",
                        "AOUSSAT SONIA",
                        "ARAPOVIC NINA",
                        "AZZOUZ NOORE",
                        "CEBOTARI IURIANA",
                        "DA SILVA LEVIEUX JOY",
                        "DENIS DUPART MAELYS",
                        "FERNANDES-LEITAO KESSY",
                        "GUILLAUME SANOU ALANA",
                        "OLIVEIRA THERY",
                        "OSI LINA",
                        "ROUSSEL KLARA",
                        "STANKOVIC ALEXANDRA",
                        "WESPISER IZAGONOLA ANIA"
                    ]
                },
                "PROFESSEUR_25_26": {
                    code: "PROFCAB25",
                    nom: "PROFESSEUR 25-26",
                    eleves: [
                        "MAS BASTIAN",
                        "PEREIRA CEDRIC",
                        "AMAND ANAIS",
                        "THENEZAY URSULA",
                        "HASSLER SOLENE",
                        "RORTAIS MORGAN",
                        "RAULT BENOIT"
                    ]
                },
                "GROUPE_PRO_GOLF_25_26": {
                    code: "GOLFPRO25",
                    nom: "GROUPE PRO GOLF 25-26",
                    eleves: [
                        "BOULET THEO",
                        "RECROSIO THOMAS",
                        "FRANQUET PAUL",
                        "GRIFFAUT MARINE"
                    ]
                },
                "GROUPE_GOLF_AMATEUR_25_26": {
                    code: "GOLFAM25",
                    nom: "GROUPE GOLF AMATEUR 25-26",
                    eleves: [
                        "LOPEZ JOSS",
                        "LOPEZ  NEIL",
                        "DOSSOU KOKO MATHIAS",
                        "GODIN ALEXANDRE"
                    ]
                }
            },

            codeActuel: null,
            
            verifierCode: function(code) {
                for (let classe in this.classes) {
                    if (this.classes[classe].code === code) {
                        this.codeActuel = classe;
                        return true;
                    }
                }
                return false;
            },
            
            verifierUtilisateur: function(nom) {
                if (!this.codeActuel) return false;
                const classe = this.classes[this.codeActuel];
                if (!classe) return false;
                
                const nomNormalise = nom.toLowerCase().trim();
                return classe.eleves.some(eleve => 
                    eleve.toLowerCase().trim().includes(nomNormalise) || 
                    nomNormalise.includes(eleve.toLowerCase().trim())
                );
            },
            
            getNomClasse: function() {
                if (!this.codeActuel) return "Classe";
                return this.classes[this.codeActuel].nom;
            },
            
            validerCode: function() {
                if (this.codeActuel) {
                    localStorage.setItem('code-valide', 'true');
                    localStorage.setItem('classe-active', this.codeActuel);
                }
            },
            
            estDejaConnecte: function() {
                const codeValide = localStorage.getItem('code-valide');
                const classeActive = localStorage.getItem('classe-active');
                if (codeValide === 'true' && classeActive) {
                    this.codeActuel = classeActive;
                    return true;
                }
                return false;
            },
            
            revoquerAcces: function() {
                localStorage.removeItem('code-valide');
                localStorage.removeItem('classe-active');
                this.codeActuel = null;
            }
        };

        // DONNÉES DES COURS (version condensée pour économiser l'espace)
        const coursData = {
            principes: [
                {
                    titre: "Principe de Surcharge Progressive",
                    contenu: "Pour progresser, il faut augmenter progressivement la charge, le volume ou l'intensité de l'entraînement.",
                    conseils: ["Augmenter la charge de 2-5%", "Ajouter répétitions/séries", "Varier les exercices", "Noter performances"]
                },
                {
                    titre: "Principe de Spécificité",
                    contenu: "Les adaptations sont spécifiques au type d'entraînement effectué.",
                    conseils: ["Adapter mobile à objectif", "Rester cohérent 8-12 semaines", "Varier mobiles sur l'année", "Privilégier poly-articulaires"]
                },
                {
                    titre: "Principe de Récupération",
                    contenu: "La progression se fait pendant la récupération. Un muscle a besoin de 48-72h pour récupérer.",
                    conseils: ["48h entre séances même muscle", "7-9h sommeil", "1.5-2L eau/jour", "Écouter son corps"]
                }
            ],

            mobiles: [
                {
                    nom: "FORCE MAXIMALE",
                    color: "#fb923c",
                    objectif: "Développer la force maximale et la puissance",
                    charge: "85-100% du 1RM",
                    repetitions: "1-5 répétitions",
                    series: "4-6 séries",
                    repos: "3-5 minutes",
                    formes: ["Charges libres", "Poly-articulaires", "Tempo lent", "Pyramide"]
                },
                {
                    nom: "ÉQUILIBRE / VOLUME",
                    color: "#10b981",
                    objectif: "Développer le volume musculaire (hypertrophie)",
                    charge: "65-80% du 1RM",
                    repetitions: "6-12 répétitions",
                    series: "3-5 séries",
                    repos: "1-2 minutes",
                    formes: ["Charges libres + machines", "Poly + isolation", "Tempo modéré", "Superset/drop sets"]
                },
                {
                    nom: "ENDURANCE MUSCULAIRE",
                    color: "#06b6d4",
                    objectif: "Développer l'endurance et la résistance",
                    charge: "40-60% du 1RM",
                    repetitions: "15-25+ répétitions",
                    series: "2-4 séries",
                    repos: "30s-1 minute",
                    formes: ["Circuits training", "Poids corps", "Tempo rapide", "Exercices fonctionnels"]
                }
            ],

            typesContraction: [
                {type: "Concentrique", definition: "Muscle se raccourcit (phase positive)", exemple: "Monter la barre", mobile: "Force et puissance"},
                {type: "Excentrique", definition: "Muscle s'allonge sous tension (phase négative)", exemple: "Descendre la barre", mobile: "Hypertrophie"},
                {type: "Isométrique", definition: "Contraction statique sans mouvement", exemple: "Gainage planche", mobile: "Endurance et stabilisation"}
            ],

            hygiene: {
                avant: [
                    {titre: "Échauffement (10-15 min)", contenu: "Cardio léger puis mouvements dynamiques spécifiques."},
                    {titre: "Hydratation", contenu: "300-500ml d'eau 2h avant l'entraînement."},
                    {titre: "Alimentation", contenu: "Repas 2-3h avant avec glucides et protéines."}
                ],
                pendant: [
                    {titre: "Technique et Respiration", contenu: "Toujours privilégier la technique. Expirer pendant l'effort."},
                    {titre: "Hydratation Continue", contenu: "Petites gorgées toutes les 15-20 minutes."},
                    {titre: "Écoute du Corps", contenu: "Distinguer douleur musculaire de douleur articulaire."}
                ],
                apres: [
                    {titre: "Retour au Calme", contenu: "5-10 min cardio léger pour récupération."},
                    {titre: "Étirements", contenu: "30 secondes par muscle, étirement confortable."},
                    {titre: "Nutrition Post-Entraînement", contenu: "20-30g protéines + glucides dans les 2h."},
                    {titre: "Sommeil", contenu: "7-9h de qualité pour récupération optimale."}
                ]
            },

            anatomie: {
                "Pectoraux": {role: "Adduction, flexion et rotation interne épaule. Mouvements de poussée.", insertions: ["Clavicule, sternum → Humérus", "3 faisceaux: haut, milieu, bas"]},
                "Grand Dorsal": {role: "Extension, adduction épaule. Forme en V du dos.", insertions: ["Vertèbres, crête iliaque → Humérus", "Travaillé en traction"]},
                "Trapèzes": {role: "Élévation, abaissement, rétraction omoplates. Posture.", insertions: ["3 faisceaux: supérieur, moyen, inférieur", "Crâne, vertèbres → Omoplate"]},
                "Deltoïdes": {role: "Abduction, flexion, extension épaule. Largeur épaules.", insertions: ["3 faisceaux: antérieur, moyen, postérieur", "Clavicule, omoplate → Humérus"]},
                "Biceps": {role: "Flexion coude et supination avant-bras.", insertions: ["2 chefs depuis omoplate → Radius", "Synergiste: brachial"]},
                "Triceps": {role: "Extension coude. 2/3 du volume du bras.", insertions: ["3 chefs: long, latéral, médial", "Omoplate, humérus → Ulna"]},
                "Quadriceps": {role: "Extension genou, flexion hanche. Plus puissant muscle.", insertions: ["4 chefs: droit fémoral + 3 vastes", "Bassin, fémur → Rotule → Tibia"]},
                "Ischio-jambiers": {role: "Flexion genou, extension hanche. Antagonistes quadriceps.", insertions: ["3 muscles", "Ischion → Tibia, fibula"]},
                "Fessiers": {role: "Extension, abduction, rotation hanche. Muscle le plus puissant.", insertions: ["Grand, moyen, petit fessier", "Iliaque, sacrum → Fémur"]}
            },

            exercicesPectoraux: [
                {nom: "Développé Couché", description: "Exercice roi pectoraux. Allongé, descendre/pousser barre.", technique: ["Omoplates plaquées", "Barre niveau tétons", "Coudes 45°", "Pieds ancrés"], variantes: ["Incliné (haut)", "Décliné (bas)", "Haltères"], video: "https://www.youtube.com/watch?v=sRuKSZLcmWM"},
                {nom: "Développé Incliné", description: "Variante sur banc incliné, cible haut des pectoraux.", technique: ["Banc à 30-45°", "Omoplates serrées", "Descente contrôlée", "Pousser explosif"], variantes: ["Haltères", "Barre", "Smith machine"], video: "https://www.youtube.com/watch?v=UogqSjfNQwE"},
                {nom: "Écarté Couché", description: "Allongé, bras écartés, descendre puis ramener.", technique: ["Légère flexion coudes", "Étirement pectoraux", "Pas plus bas que banc", "Arc de cercle"], variantes: ["Incliné", "Poulie", "Pec deck"], video: "https://www.youtube.com/shorts/FbzTlGj2Qbw"},
                {nom: "Poulies Vis-à-vis", description: "Debout entre poulies, ramener mains devant poitrine.", technique: ["Légère inclinaison avant", "Coudes semi-fléchis", "Contraction pic", "Contrôler retour"], variantes: ["Bas vers haut", "Haut vers bas", "Horizontal"], video: "https://www.youtube.com/watch?v=Puu3zs0hATI"},
                {nom: "Dips", description: "Entre barres, descendre puis remonter.", technique: ["Penché=pecs, droit=triceps", "90° minimum", "Coudes près corps", "Contrôler"], variantes: ["Lestés", "Assistés", "Sur banc"], video: "https://www.youtube.com/shorts/ZE1LMMVYgpQ"}
            ],

            exercicesDos: [
                {nom: "Tirage Vertical", description: "Assis machine, tirer barre vers poitrine.", technique: ["Penché 20-30°", "Vers haut pectoraux", "Contracter omoplates", "Pas derrière nuque"], variantes: ["Prise large", "Serrée", "Neutre"], video: "https://www.youtube.com/shorts/XClPH0DfdFI"},
                {nom: "Tirage Horizontal", description: "Assis, tirer poignées vers abdos.", technique: ["Dos droit", "Coudes le long du corps", "Serrer omoplates", "Poitrine sortie"], variantes: ["Prise neutre", "Pronation", "Supination"], video: "https://www.youtube.com/shorts/hnNjcQI9ZMU"},
                {nom: "Traction", description: "Suspendu, se hisser menton au-dessus barre.", technique: ["Prise large", "Coudes vers bas/arrière", "Poitrine vers barre", "Descente contrôlée"], variantes: ["Pronation (dur)", "Supination (facile)", "Assistée"], video: "https://www.youtube.com/watch?v=bxguzp1DCFw"},
                {nom: "Rowing Barre", description: "Penché, tirer barre vers ventre.", technique: ["Dos droit", "Tirer vers nombril", "Coudes le long", "Contracter omoplates"], variantes: ["Yates", "Haltères", "T-barre"], video: "https://www.youtube.com/watch?v=69frLpCDGkc"},
                {nom: "Rowing Haltère", description: "Un genou sur banc, tirer haltère vers hanche.", technique: ["Dos parallèle au sol", "Coude le long du corps", "Tirer vers hanche", "Ne pas rotation tronc"], variantes: ["2 bras simultanés", "Debout penché", "Sur banc incliné"], video: "https://www.youtube.com/watch?v=jyrudAO4Rxc"},
                {nom: "Face Pull Assis", description: "Tirer corde vers visage, coudes hauts.", technique: ["Coudes au-dessus mains", "Tirer vers front", "Écarter corde fin", "Trapèzes+deltoïdes arrière"], variantes: ["Debout", "Un genou au sol", "Poulie haute/basse"], video: "https://www.youtube.com/shorts/PvmQURl5zKY"},
                {nom: "Extension Lombaire", description: "Sur banc à lombaires, descendre et remonter tronc.", technique: ["Mains derrière tête", "Descente contrôlée", "Dos droit", "Contracter fessiers/lombaires"], variantes: ["Lesté", "Sur Swiss ball", "Good morning"], video: "https://www.youtube.com/watch?v=uIsMsi5ui8A"}
            ],

            exercicesEpaules: [
                {nom: "Développé Militaire", description: "Debout/assis, pousser barre au-dessus tête.", technique: ["Gainage fort", "Coudes devant barre", "Tête en avant fin", "Pas cambrer"], variantes: ["Haltères", "Arnold", "Nuque (attention)"], video: "https://www.youtube.com/watch?v=NQ-JJYay1TM"},
                {nom: "Élévations Latérales", description: "Lever haltères côtés jusqu'à épaules.", technique: ["Coudes fléchis", "Hauteur épaules", "Contrôler descente", "Rotation légère"], variantes: ["Poulie", "Assis", "Un bras"], video: "https://www.youtube.com/watch?v=-_XE4qbV7Yw"},
                {nom: "Face Pull Deltoïdes", description: "Tirer corde vers visage pour deltoïdes postérieurs.", technique: ["Coudes hauts", "Séparer corde", "Vers oreilles", "Contraction arrière épaules"], variantes: ["Poulie haute", "Poulie basse", "Élastique"], video: "https://www.youtube.com/watch?v=a9AaQh1dtRs"}
            ],

            exercicesBras: [
                {nom: "Larry Scott (Pupitre)", description: "Assis, bras sur pupitre, curl barre.", technique: ["Coudes sur pupitre", "Amplitude complète", "Pas décoller coudes", "Contraction pic"], variantes: ["Haltères", "Barre EZ", "Un bras"], video: "https://www.youtube.com/watch?v=8MSRc2_b2d4"},
                {nom: "Curl Barre", description: "Debout, fléchir coudes monter barre.", technique: ["Coudes fixes", "Pas balancer", "Contracter biceps", "Descente contrôlée"], variantes: ["Haltères", "Marteau", "Barre EZ"], video: "https://www.youtube.com/watch?v=ndg4oTdo4Xs"},
                {nom: "Curl Haltère", description: "Debout, alterner ou simultané, monter haltères.", technique: ["Rotation avant-bras", "Coudes fixes", "Contraction supination", "Pas d'élan"], variantes: ["Alternés", "Simultanés", "Marteau", "Assis incliné"], video: "https://www.youtube.com/watch?v=5S8x-9SvQ5w"},
                {nom: "Barre au Front", description: "Allongé, descendre barre vers front, étendre.", technique: ["Coudes fixes pointés plafond", "Vers front/cheveux", "Contrôle", "Ne pas bouger épaules"], variantes: ["Haltères", "Poulie haute", "Barre EZ"], video: "https://www.youtube.com/watch?v=e3X7IFQEZrc"},
                {nom: "Extension Corde", description: "Poulie haute, descendre corde en écartant.", technique: ["Coudes fixes le long", "Écarter corde bas", "Extension complète", "Contraction pic"], variantes: ["Barre", "Un bras", "Prise inversée"], video: "https://www.youtube.com/watch?v=TDCmyWi5iyU"},
                {nom: "Extension Haltère", description: "Debout/assis, haltère derrière tête, étendre.", technique: ["Coudes près oreilles", "Descente profonde", "Extension complète", "Gainage"], variantes: ["2 bras", "Un bras", "Allongé"], video: "https://www.youtube.com/watch?v=rFNQv9eae6I"}
            ],

            exercicesBasDuCorps: [
                {nom: "Squat", description: "Roi du bas du corps. Descendre fléchir hanches/genoux.", technique: ["Pieds largeur épaules", "Fesses en arrière", "Genoux axe pieds", "Dos droit"], variantes: ["Front", "Bulgare", "Goblet"], videos: ["https://www.youtube.com/watch?v=Bjfefk24UXM", "https://www.youtube.com/watch?v=-De1zvmtj8c"]},
                {nom: "Soulevé de Terre", description: "Saisir barre sol, se redresser.", technique: ["Dos droit", "Pousser talons", "Hanches/épaules ensemble", "Barre le long jambes"], variantes: ["Roumain", "Sumo", "Trap bar"], video: "https://www.youtube.com/watch?v=fne6CyCgGDw"},
                {nom: "Fente Bulgare", description: "Pied arrière surélevé, descendre en fente.", technique: ["Genou avant axe cheville", "Descente verticale", "Poids sur talon avant", "Équilibre"], variantes: ["Haltères", "Barre", "Sans charge"], video: "https://www.youtube.com/watch?v=nbee7NZjZWU"},
                {nom: "Hip Thrust", description: "Dos sur banc, pousser hanches vers haut avec barre.", technique: ["Épaules sur banc", "Pieds largeur hanches", "Extension complète hanches", "Serrer fessiers haut"], variantes: ["Une jambe", "Bande élastique", "Lesté"], video: "https://www.youtube.com/watch?v=Dj3ZIsic-Ng"},
                {nom: "Presse Inclinée", description: "Allongé sur presse, pousser plateforme avec jambes.", technique: ["Pieds largeur épaules", "Genoux alignés pieds", "Descente 90°", "Pousser talons"], variantes: ["Pieds hauts (ischio)", "Pieds bas (quadri)", "Une jambe"], videos: ["https://www.youtube.com/shorts/HjgE-d4cMU0", "https://www.youtube.com/shorts/05XSMArzND8"]},
                {nom: "Leg Curl", description: "Allongé/assis, fléchir jambes ramener poids.", technique: ["Contracter ischio-jambiers", "Amplitude complète", "Pas cambrer", "Contrôler retour"], variantes: ["Allongé", "Assis", "Debout un pied"], video: "https://www.youtube.com/shorts/D1lq3jegNQI"},
                {nom: "Leg Extension", description: "Assis, étendre jambes pousser poids.", technique: ["Dos contre dossier", "Extension complète", "Contracter quadriceps", "Descente contrôlée"], variantes: ["2 jambes", "Une jambe", "Pieds vers intérieur/extérieur"], video: "https://www.youtube.com/shorts/xSBbJnpZ3Js"},
                {nom: "Mollets Debout", description: "Debout, monter sur pointes de pieds.", technique: ["Amplitude maximale", "Pause en haut", "Descente complète", "Pieds parallèles"], variantes: ["Barre", "Machine", "Presse", "Une jambe"], video: "https://www.youtube.com/watch?v=ovIJTRPxlVQ"}
            ],

            exercicesAbdos: [
                {nom: "Circuit Abdos 1 (45s/15s)", description: "Circuit training 45s travail / 15s repos, 2-3 tours.", technique: ["Maintenir forme", "Respiration contrôlée", "Qualité > quantité", "Pause si besoin"], variantes: ["Ajouter lest", "Augmenter tempo", "Réduire repos"], video: "https://www.youtube.com/watch?v=UA-OWzKAk9Y"},
                {nom: "Circuit Abdos 2 (45s/15s)", description: "Circuit training 45s travail / 15s repos, 2-3 tours.", technique: ["Engagement constant", "Contrôle mouvements", "Gainage permanent", "Concentration"], variantes: ["Modifier exercices", "Temps sous tension", "Plus de tours"], video: "https://www.youtube.com/shorts/YiPXMVfsIBM"}
            ]
        };// PARTIE 3/4 - RENDU
        
        class LivretApp {
            constructor() {
                this.currentUser = null;
                this.currentView = securite.estDejaConnecte() ? 'login' : 'code-access';
                this.currentTab = 'dashboard';
                this.sessions = [];
                this.rmHistory = [];
                this.currentSession = null;
                this.userAvatar = null;
                this.musclesList = ['Pectoraux', 'Grand dorsal', 'Trapèzes', 'Deltoïdes', 'Biceps', 'Triceps', 'Abdominaux', 'Quadriceps', 'Ischio-jambiers', 'Fessiers', 'Mollets'];
                this.currentCoursTab = 'principes';
                this.exercicesTemp = [];
                this.musclesTemp = [];
                this.timerMode = 'repos';
                this.timerSeconds = 60;
                this.timerRunning = false;
                this.timerInterval = null;
                this.chronoSeconds = 0;
                this.chronoRunning = false;
                this.chronoInterval = null;
                this.chronoLaps = [];
                this.sessionHistory = [];
                this.isOnline = navigator.onLine;
                this.searchQuery = '';
                this.activeFilters = [];
                this.calculatedCharges = {};
                this.currentTheme = 'cyan';
                this.badges = [];
                this.objectifs = [];
                this.currentStreak = 0;
                this.longestStreak = 0;
                this.fabMenuOpen = false;
                this.searchOpen = false;
                this.globalSearchQuery = "";
                this.init();
                this.initOfflineMode();
            }

            init() {
                this.loadSessions();
                this.loadRMHistory();
                this.loadUserAvatar();
                this.loadSessionHistory();
                this.loadCalculatedCharges();
                this.loadTheme();
                this.loadBadges();
                this.loadObjectifs();
                this.calculateStreaks();
                this.checkBadges();
                this.render();
            }

            initOfflineMode() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.updateOfflineBanner();
                });
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.updateOfflineBanner();
                });
                this.updateOfflineBanner();
            }

            updateOfflineBanner() {
                const banner = document.getElementById('offline-banner');
                if (!this.isOnline) {
                    banner.innerHTML = '<span class="offline-indicator"></span>Mode hors-ligne - Données sauvegardées localement';
                    banner.classList.remove('hidden');
                } else {
                    banner.classList.add('hidden');
                }
            }

            loadSessions() {
                if (!this.currentUser) return;
                const result = storage.get('sessions');
                if (result.exists) this.sessions = JSON.parse(result.value);
            }

            saveSessions() { storage.save('sessions', this.sessions); }

            loadRMHistory() {
                if (!this.currentUser) return;
                const result = storage.get('rmHistory');
                if (result.exists) this.rmHistory = JSON.parse(result.value);
            }

            saveRMHistory() { storage.save('rmHistory', this.rmHistory); }

            loadUserAvatar() {
                if (!this.currentUser) return;
                const result = storage.get('avatar');
                if (result.exists) this.userAvatar = JSON.parse(result.value);
            }

            saveUserAvatar() { storage.save('avatar', this.userAvatar); }

            loadSessionHistory() {
                if (!this.currentUser) return;
                const result = storage.get('sessionHistory');
                if (result.exists) this.sessionHistory = JSON.parse(result.value);
            }

            saveSessionHistory() { storage.save('sessionHistory', this.sessionHistory); }

            loadCalculatedCharges() {
                if (!this.currentUser) return;
                const result = storage.get('calculatedCharges');
                if (result.exists) this.calculatedCharges = JSON.parse(result.value);
            }

            saveCalculatedCharges() { storage.save('calculatedCharges', this.calculatedCharges); }

            loadTheme() {
                if (!this.currentUser) return;
                const result = storage.get('theme');
                if (result.exists) {
                    this.currentTheme = result.value;
                    this.applyTheme(this.currentTheme);
                }
            }

            saveTheme() { storage.save('theme', this.currentTheme); }

            applyTheme(theme) {
                document.body.className = '';
                if (theme !== 'cyan') document.body.classList.add(`theme-${theme}`);
            }



            loadBadges() {
                if (!this.currentUser) return;
                const result = storage.get('badges');
                if (result.exists) {
                    this.badges = JSON.parse(result.value);
                } else {
                    this.badges = this.initializeBadges();
                    this.saveBadges();
                }
            }

            saveBadges() { storage.save('badges', this.badges); }

            initializeBadges() {
                return [
                    {id: 'first-session', name: 'Première Séance', icon: '🎯', description: 'Créer votre première séance', unlocked: false},
                    {id: 'first-rm', name: 'Premier Test', icon: '💪', description: 'Calculer votre premier 1RM', unlocked: false},
                    {id: 'sessions-5', name: 'Débutant', icon: '🔥', description: 'Effectuer 5 séances', unlocked: false},
                    {id: 'sessions-10', name: 'Régulier', icon: '⚡', description: 'Effectuer 10 séances', unlocked: false},
                    {id: 'sessions-25', name: 'Assidu', icon: '💎', description: 'Effectuer 25 séances', unlocked: false},
                    {id: 'sessions-50', name: 'Expert', icon: '👑', description: 'Effectuer 50 séances', unlocked: false},
                    {id: 'rm-5', name: 'Testeur', icon: '🎪', description: 'Effectuer 5 tests 1RM', unlocked: false},
                    {id: 'weekly-streak', name: 'Hebdomadaire', icon: '📅', description: 'Séances 7 jours consécutifs', unlocked: false},
                    {id: 'all-mobiles', name: 'Polyvalent', icon: '🌟', description: 'Tester les 3 mobiles', unlocked: false}
                ];
            }

            checkBadges() {
                const completedCount = this.sessionHistory.filter(h => h.completed).length;
                const rmCount = this.rmHistory.length;
                const hasAllMobiles = this.sessions.some(s => s.type === 'Force') && 
                                     this.sessions.some(s => s.type === 'Équilibre') && 
                                     this.sessions.some(s => s.type === 'Endurance');

                const badgeChecks = [
                    {id: 'first-session', condition: this.sessions.length >= 1},
                    {id: 'first-rm', condition: rmCount >= 1},
                    {id: 'sessions-5', condition: completedCount >= 5},
                    {id: 'sessions-10', condition: completedCount >= 10},
                    {id: 'sessions-25', condition: completedCount >= 25},
                    {id: 'sessions-50', condition: completedCount >= 50},
                    {id: 'rm-5', condition: rmCount >= 5},
                    {id: 'all-mobiles', condition: hasAllMobiles}
                ];

                let newBadgesUnlocked = false;
                badgeChecks.forEach(check => {
                    const badge = this.badges.find(b => b.id === check.id);
                    if (badge && !badge.unlocked && check.condition) {
                        badge.unlocked = true;
                        badge.unlockedAt = new Date().toISOString();
                        newBadgesUnlocked = true;
                    }
                });

                if (newBadgesUnlocked) this.saveBadges();
            }

            render() {
                const app = document.getElementById('app');
                if (this.currentView === 'code-access') {
                    app.innerHTML = this.renderCodeAccess();
                    this.attachCodeAccessEvents();
                } else if (this.currentView === 'login') {
                    app.innerHTML = this.renderLogin();
                    this.attachLoginEvents();
                } else if (this.currentView === 'signup') {
                    app.innerHTML = this.renderSignup();
                    this.attachSignupEvents();
                } else if (this.currentView === 'dashboard') {
                    app.innerHTML = this.renderDashboard();
                    this.attachDashboardEvents();
                } else if (this.currentView === 'session-form') {
                    app.innerHTML = this.renderSessionForm();
                    this.attachSessionFormEvents();
                } else if (this.currentView === 'session-detail') {
                    app.innerHTML = this.renderSessionDetail();
                    this.attachSessionDetailEvents();
                }
                
                // Ajouter le bouton flottant et la recherche globale
                if (this.currentView === 'dashboard') {
                    app.innerHTML += this.renderFabButton();
                }

            saveObjectifs() {
                storage.save('objectifs', this.objectifs);
            }

            calculateStreaks() {
                if (!this.sessionHistory || this.sessionHistory.length === 0) {
                    this.currentStreak = 0;
                    this.longestStreak = 0;
                    return;
                }

                const completedDates = this.sessionHistory
                    .filter(h => h.completed)
                    .map(h => {
                        const d = new Date(h.completedAt);
                        return new Date(d.getFullYear(), d.getMonth(), d.getDate()).getTime();
                    })
                    .filter((v, i, a) => a.indexOf(v) === i)
                    .sort((a, b) => b - a);

                if (completedDates.length === 0) {
                    this.currentStreak = 0;
                    this.longestStreak = 0;
                    return;
                }

                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const todayTime = today.getTime();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayTime = yesterday.getTime();

                let currentStreak = 0;
                let longestStreak = 0;
                let tempStreak = 1;

                if (completedDates[0] === todayTime || completedDates[0] === yesterdayTime) {
                    currentStreak = 1;
                    let checkDate = completedDates[0];
                    
                    for (let i = 1; i < completedDates.length; i++) {
                        const expectedPrevDay = checkDate - (24 * 60 * 60 * 1000);
                        if (completedDates[i] === expectedPrevDay) {
                            currentStreak++;
                            checkDate = completedDates[i];
                        } else {
                            break;
                        }
                    }
                }

                for (let i = 0; i < completedDates.length - 1; i++) {
                    const diff = completedDates[i] - completedDates[i + 1];
                    if (diff === 24 * 60 * 60 * 1000) {
                        tempStreak++;
                    } else {
                        longestStreak = Math.max(longestStreak, tempStreak);
                        tempStreak = 1;
                    }
                }
                longestStreak = Math.max(longestStreak, tempStreak);

                this.currentStreak = currentStreak;
                this.longestStreak = Math.max(longestStreak, currentStreak);
            }

            addObjectif(titre, type, cible, muscle = null, exercice = null) {
                const newId = this.objectifs.length > 0 ? Math.max(...this.objectifs.map(o => o.id)) + 1 : 1;
                const newObjectif = {
                    id: newId,
                    titre,
                    type,
                    cible,
                    actuel: 0,
                    completed: false,
                    muscle,
                    exercice,
                    createdAt: new Date().toISOString()
                };
                this.objectifs.push(newObjectif);
                this.saveObjectifs();
                this.render();
            }

            deleteObjectif(id) {
                if (confirm('Supprimer cet objectif ?')) {
                    this.objectifs = this.objectifs.filter(o => o.id !== id);
                    this.saveObjectifs();
                    this.render();
                }
            }

            updateObjectifProgress() {
                const thisMonth = new Date().getMonth();
                const thisYear = new Date().getFullYear();
                const sessionsThisMonth = this.sessionHistory.filter(h => {
                    const date = new Date(h.completedAt);
                    return h.completed && date.getMonth() === thisMonth && date.getFullYear() === thisYear;
                }).length;

                this.objectifs.forEach(obj => {
                    if (obj.type === 'seances') {
                        obj.actuel = sessionsThisMonth;
                        obj.completed = obj.actuel >= obj.cible;
                    } else if (obj.type === 'streak') {
                        obj.actuel = this.currentStreak;
                        obj.completed = obj.actuel >= obj.cible;
                    } else if (obj.type === 'rm' && obj.muscle && obj.exercice) {
                        const tests = this.rmHistory.filter(t => t.muscle === obj.muscle && t.exercise === obj.exercice);
                        if (tests.length >= 2) {
                            const sorted = tests.sort((a, b) => new Date(b.date) - new Date(a.date));
                            const latest = sorted[0].rm;
                            const initial = sorted[sorted.length - 1].rm;
                            obj.actuel = latest - initial;
                            obj.completed = obj.actuel >= obj.cible;
                        }
                    }
                });

                this.saveObjectifs();
            }

            renderObjectifsTab() {
                this.updateObjectifProgress();
                
                const objectifsActifs = this.objectifs.filter(o => !o.completed);
                const objectifsCompletes = this.objectifs.filter(o => o.completed);

                return `
                    <div>
                        <h2 class="text-white mb-4" style="font-size: 1.5rem;">🎯 Mes Objectifs</h2>
                        
                        <!-- Streaks -->
                        <div class="mb-4" style="background: linear-gradient(135deg, rgba(251, 146, 60, 0.2) 0%, rgba(249, 115, 22, 0.2) 100%); border: 2px solid rgba(251, 146, 60, 0.4); border-radius: 1.5rem; padding: 2rem;">
                            <h3 class="text-white mb-3" style="font-size: 1.3rem;">🔥 Séries en cours</h3>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="text-center" style="background: rgba(15, 23, 42, 0.6); padding: 1.5rem; border-radius: 1rem;">
                                    <div style="color: #fb923c; font-size: 3rem; font-weight: bold;">${this.currentStreak}</div>
                                    <div class="text-white" style="opacity: 0.9;">Jours consécutifs</div>
                                    ${this.currentStreak > 0 ? '<div class="text-cyan mt-2">🔥 Continue !</div>' : '<div class="text-white mt-2" style="opacity: 0.6;">Commence une série</div>'}
                                </div>
                                <div class="text-center" style="background: rgba(15, 23, 42, 0.6); padding: 1.5rem; border-radius: 1rem;">
                                    <div style="color: #fb923c; font-size: 3rem; font-weight: bold;">${this.longestStreak}</div>
                                    <div class="text-white" style="opacity: 0.9;">Record personnel</div>
                                    ${this.currentStreak === this.longestStreak && this.currentStreak > 0 ? '<div class="text-cyan mt-2">🏆 Nouveau record !</div>' : ''}
                                </div>
                            </div>
                        </div>

                        <!-- Objectifs actifs -->
                        ${objectifsActifs.length > 0 ? `
                            <div class="mb-4">
                                <h3 class="text-white mb-3" style="font-size: 1.2rem;">🎯 En cours (${objectifsActifs.length})</h3>
                                ${objectifsActifs.map(obj => {
                                    const progress = Math.min((obj.actuel / obj.cible) * 100, 100);
                                    return `
                                        <div class="exercise-card" style="position: relative;">
                                            <div class="flex justify-between items-start mb-2">
                                                <h4 class="text-white" style="margin: 0;">${obj.titre}</h4>
                                                <button class="btn btn-danger" style="padding: 0.25rem 0.75rem; font-size: 0.9rem;" onclick="app.deleteObjectif(${obj.id})">🗑️</button>
                                            </div>
                                            <div class="mb-2">
                                                <div class="progress-bar">
                                                    <div class="progress-fill" style="width: ${progress}%;"></div>
                                                </div>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-white" style="opacity: 0.9;">${obj.actuel} / ${obj.cible}</span>
                                                <span class="text-cyan" style="font-weight: 600;">${Math.round(progress)}%</span>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : `
                            <div class="tip-box mb-4">
                                <div class="text-white" style="opacity: 0.7;">Aucun objectif actif. Crée-en un ci-dessous !</div>
                            </div>
                        `}

                        <!-- Objectifs complétés -->
                        ${objectifsCompletes.length > 0 ? `
                            <div class="mb-4">
                                <h3 class="text-white mb-3" style="font-size: 1.2rem;">✅ Complétés (${objectifsCompletes.length})</h3>
                                ${objectifsCompletes.map(obj => `
                                    <div class="exercise-card" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.1) 100%); border: 1px solid rgba(16, 185, 129, 0.3);">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="text-white" style="margin: 0 0 0.5rem 0;">✅ ${obj.titre}</h4>
                                                <div style="color: #10b981; font-weight: 600;">${obj.actuel} / ${obj.cible} - 100%</div>
                                            </div>
                                            <button class="btn btn-danger" style="padding: 0.25rem 0.75rem; font-size: 0.9rem;" onclick="app.deleteObjectif(${obj.id})">🗑️</button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}

                        <!-- Ajouter un objectif -->
                        <div class="exercise-card" style="background: linear-gradient(135deg, rgba(6, 182, 212, 0.2) 0%, rgba(8, 145, 178, 0.1) 100%); border: 2px dashed rgba(6, 182, 212, 0.5);">
                            <h3 class="text-white mb-3" style="font-size: 1.2rem;">➕ Créer un objectif</h3>
                            <form id="objectif-form" onsubmit="app.handleAddObjectif(event)">
                                <div class="mb-3">
                                    <label class="text-white mb-1" style="display: block;">Type d'objectif</label>
                                    <select class="input" id="objectif-type" onchange="app.updateObjectifForm()">
                                        <option value="seances">📅 Nombre de séances ce mois</option>
                                        <option value="streak">🔥 Série de jours consécutifs</option>
                                        <option value="rm">💪 Augmenter un 1RM</option>
                                    </select>
                                </div>
                                <div id="objectif-rm-fields" style="display: none;">
                                    <div class="grid grid-cols-2 gap-2 mb-3">
                                        <div>
                                            <label class="text-white mb-1" style="display: block; font-size: 0.9rem;">Muscle</label>
                                            <select class="input" id="objectif-muscle">
                                                ${this.musclesList.map(m => `<option value="${m}">${m}</option>`).join('')}
                                            </select>
                                        </div>
                                        <div>
                                            <label class="text-white mb-1" style="display: block; font-size: 0.9rem;">Exercice</label>
                                            <input type="text" class="input" id="objectif-exercice" placeholder="Ex: Développé Couché">
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="text-white mb-1" style="display: block;">Objectif cible</label>
                                    <input type="number" class="input" id="objectif-cible" min="1" required>
                                </div>
                                <button type="submit" class="btn btn-success" style="width: 100%;">➕ Créer l'objectif</button>
                            </form>
                        </div>

                        <div class="tip-box mt-4">
                            <div class="text-white" style="font-weight: 600; margin-bottom: 0.5rem;">💡 Conseils</div>
                            <ul style="margin: 0; padding-left: 1.5rem;">
                                <li class="text-white" style="opacity: 0.9; margin-bottom: 0.5rem;">Fixe-toi des objectifs réalistes et progressifs</li>
                                <li class="text-white" style="opacity: 0.9; margin-bottom: 0.5rem;">Les séries motivent énormément - essaie de maintenir une régularité</li>
                                <li class="text-white" style="opacity: 0.9;">Célèbre chaque victoire, même les petites !</li>
                            </ul>
                        </div>
                    </div>
                `;
            }

            updateObjectifForm() {
                const type = document.getElementById('objectif-type').value;
                const rmFields = document.getElementById('objectif-rm-fields');
                const cibleInput = document.getElementById('objectif-cible');
                
                if (type === 'rm') {
                    rmFields.style.display = 'block';
                    cibleInput.placeholder = 'Progression en kg (ex: 5)';
                } else if (type === 'seances') {
                    rmFields.style.display = 'none';
                    cibleInput.placeholder = 'Nombre de séances (ex: 10)';
                } else if (type === 'streak') {
                    rmFields.style.display = 'none';
                    cibleInput.placeholder = 'Nombre de jours (ex: 7)';
                }
            }

            handleAddObjectif(e) {
                e.preventDefault();
                const type = document.getElementById('objectif-type').value;
                const cible = parseInt(document.getElementById('objectif-cible').value);
                
                let titre = '';
                let muscle = null;
                let exercice = null;
                
                if (type === 'seances') {
                    titre = `${cible} séances ce mois`;
                } else if (type === 'streak') {
                    titre = `Série de ${cible} jours`;
                } else if (type === 'rm') {
                    muscle = document.getElementById('objectif-muscle').value;
                    exercice = document.getElementById('objectif-exercice').value;
                    if (!exercice) {
                        alert('Remplis le nom de l\'exercice');
                        return;
                    }
                    titre = `Augmenter ${exercice} de ${cible}kg`;

            toggleFabMenu() {
                this.fabMenuOpen = !this.fabMenuOpen;
                this.render();
            }

            quickStartSession() {
                if (this.sessions.length === 0) {
                    alert('Créez d\'abord une séance dans l\'onglet Séances');
                    this.currentView = 'dashboard';
                    this.currentTab = 'sessions';
                    this.fabMenuOpen = false;
                    this.render();
                    return;
                }
                
                // Proposer les 3 dernières séances
                const recentSessions = [...this.sessions].slice(-3);
                const choice = prompt(`Quelle séance veux-tu faire ?\n${recentSessions.map((s, i) => `${i+1}. ${s.nom} (${s.type})`).join('\n')}\n\nTape le numéro (ou 0 pour voir toutes les séances)`);
                
                if (choice === '0') {
                    this.currentView = 'dashboard';
                    this.currentTab = 'sessions';
                    this.fabMenuOpen = false;
                    this.render();
                } else if (choice && parseInt(choice) > 0 && parseInt(choice) <= recentSessions.length) {
                    const sessionIndex = this.sessions.indexOf(recentSessions[parseInt(choice) - 1]);
                    this.currentSession = sessionIndex;
                    this.currentView = 'session-detail';
                    this.fabMenuOpen = false;
                    this.render();
                }
            }

            quickAddRM() {
                this.currentView = 'dashboard';
                this.currentTab = 'rm';
                this.fabMenuOpen = false;
                this.render();
                setTimeout(() => {
                    document.getElementById('rm-muscle')?.focus();
                }, 100);
            }

            openGlobalSearch() {
                this.searchOpen = true;
                this.fabMenuOpen = false;
                this.render();
                setTimeout(() => {
                    document.getElementById('global-search-input')?.focus();
                }, 100);
            }

            closeGlobalSearch() {
                this.searchOpen = false;
                this.globalSearchQuery = '';
                this.render();
            }


            deleteSessionHistory(index) {
                if (confirm('Supprimer cette entrée de l\'historique ?')) {
                    this.sessionHistory.splice(index, 1);
                    this.saveSessionHistory();
                    this.calculateStreaks();
                    this.updateObjectifProgress();
                    this.render();
                }
            }

            editSessionHistory(index) {
                const entry = this.sessionHistory[index];
                const newNotes = prompt('Modifier les notes :', entry.notes || '');
                if (newNotes !== null) {
                    entry.notes = newNotes;
                    this.saveSessionHistory();
                    this.render();
                }
            }

            renderFabButton() {
                if (this.currentView !== 'dashboard') return '';
                
                return `
                    ${this.fabMenuOpen ? `
                        <div class="fab-menu">
                            <button class="fab-menu-item" onclick="app.quickStartSession()">
                                🏋️ Démarrer une séance
                            </button>
                            <button class="fab-menu-item" onclick="app.quickAddRM()">
                                💪 Ajouter un 1RM
                            </button>
                            <button class="fab-menu-item" onclick="app.openGlobalSearch()">
                                🔍 Rechercher
                            </button>
                            <button class="fab-menu-item" onclick="app.toggleFabMenu()">
                                ❌ Fermer
                            </button>
                        </div>
                    ` : ''}
                    <button class="fab-button" onclick="app.toggleFabMenu()">
                        ${this.fabMenuOpen ? '✕' : '⚡'}
                    </button>
                `;
            }

            renderGlobalSearch() {
                if (!this.searchOpen) return '';

                const results = this.performGlobalSearch();

                return `
                    <div class="search-overlay" onclick="if(event.target === this) app.closeGlobalSearch()">
                        <div class="search-modal" onclick="event.stopPropagation()">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-white" style="font-size: 1.5rem;">🔍 Recherche globale</h2>
                                <button class="btn btn-secondary" onclick="app.closeGlobalSearch()">✕</button>
                            </div>
                            
                            <div class="search-input-wrapper mb-4">
                                <span class="search-icon">🔍</span>
                                <input 
                                    type="text" 
                                    id="global-search-input"
                                    class="search-input" 
                                    placeholder="Rechercher séances, exercices, 1RM..." 
                                    value="${this.globalSearchQuery}"
                                    oninput="app.globalSearchQuery = this.value; app.render();"
                                    onkeydown="if(event.key==='Escape') app.closeGlobalSearch()"
            performGlobalSearch() {
                const query = this.globalSearchQuery.toLowerCase();
                if (!query) return [];

                const results = [];

                // Recherche dans les séances
                this.sessions.forEach((session, idx) => {
                    if (session.nom.toLowerCase().includes(query) || 
                        session.type.toLowerCase().includes(query) ||
                        session.muscles.some(m => m.toLowerCase().includes(query)) ||
                        session.exercices.some(e => e.toLowerCase().includes(query))) {
                        results.push({
                            type: 'séance',
                            titre: session.nom,
                            description: `${session.type} - ${session.muscles.join(', ')}`,
                            actionType: 'session',
                            actionData: idx
                        });
                    }
                });

                // Recherche dans les tests 1RM
                this.rmHistory.forEach((test, idx) => {
                    if (test.muscle.toLowerCase().includes(query) || 
                        test.exercise.toLowerCase().includes(query)) {
                        results.push({
                            type: '1RM',
                            titre: `${test.exercise} - ${test.rm}kg`,
                            description: `${test.muscle} - ${test.date}`,
                            actionType: 'rm',
                            actionData: null
                        });
                    }
                });

                // Recherche dans les exercices (cours)
                const allExercises = [
                    ...coursData.exercicesPectoraux,
                    ...coursData.exercicesDos,
                    ...coursData.exercicesEpaules,
                    ...coursData.exercicesBras,
                    ...coursData.exercicesBasDuCorps,
                    ...coursData.exercicesAbdos
                ];

                allExercises.forEach(ex => {
                    if (ex.nom.toLowerCase().includes(query) || 
                        ex.description.toLowerCase().includes(query)) {
                        results.push({
                            type: 'exercice',
                            titre: ex.nom,
                            description: ex.description,
                            actionType: 'exercice',
                            actionData: query
                        });
                    }
                });

                return results.slice(0, 10);
            }

            executeSearchAction(actionType, actionData) {
                if (actionType === 'session') {
                    this.currentSession = actionData;
                    this.currentView = 'session-detail';
                    this.closeGlobalSearch();
                } else if (actionType === 'rm') {
                    this.currentView = 'dashboard';
                    this.currentTab = 'rm';
                    this.closeGlobalSearch();
                } else if (actionType === 'exercice') {
                    this.currentView = 'dashboard';
                    this.currentTab = 'cours';
                    this.currentCoursTab = 'exercices';
                    this.searchQuery = actionData;
                    this.closeGlobalSearch();
                }
            }

            renderGlobalSearch() {
                if (!this.searchOpen) return '';

                const results = this.performGlobalSearch();

                return `
                    <div class="search-overlay" onclick="if(event.target === this) app.closeGlobalSearch()">
                        <div class="search-modal" onclick="event.stopPropagation()">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-white" style="font-size: 1.5rem;">🔍 Recherche globale</h2>
                                <button class="btn btn-secondary" onclick="app.closeGlobalSearch()">✕</button>
                            </div>
                            
                            <div class="search-input-wrapper mb-4">
                                <span class="search-icon">🔍</span>
                                <input 
                                    type="text" 
                                    id="global-search-input"
                                    class="search-input" 
                                    placeholder="Rechercher séances, exercices, 1RM..." 
                                    value="${this.globalSearchQuery}"
                                    oninput="app.globalSearchQuery = this.value; app.render();"
                                    onkeydown="if(event.key==='Escape') app.closeGlobalSearch()"
                                >
                            </div>

                            ${results.length > 0 ? `
                                <div>
                                    <div class="text-white mb-2" style="opacity: 0.7;">${results.length} résultat${results.length > 1 ? 's' : ''}</div>
                                    ${results.map((result, idx) => `
                                        <div class="search-result" onclick="app.executeSearchAction('${result.actionType}', ${result.actionData !== null ? result.actionData : 'null'})">
                                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                                <div style="flex: 1;">
                                                    <div class="text-white" style="font-weight: 600; margin-bottom: 0.25rem;">${result.titre}</div>
                                                    <div class="text-white" style="opacity: 0.7; font-size: 0.9rem;">${result.description}</div>
                                                </div>
                                                <span class="badge" style="background: var(--primary-color); font-size: 0.8rem;">${result.type}</span>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : this.globalSearchQuery ? `
                                <div class="text-center" style="padding: 3rem; opacity: 0.5;">
                                    <div style="font-size: 3rem;">🔍</div>
                                    <div class="text-white" style="margin-top: 1rem;">Aucun résultat</div>
                                </div>
                            ` : `
                                <div class="text-center" style="padding: 3rem; opacity: 0.5;">
                                    <div style="font-size: 3rem;">💡</div>
                                    <div class="text-white" style="margin-top: 1rem;">Tape pour chercher partout dans l'app</div>
                                </div>
                            `}

                            <div class="tip-box mt-4">
                                <div class="text-white" style="font-size: 0.9rem; opacity: 0.7;">
                                    💡 Astuce : Appuie sur <kbd style="background: rgba(255,255,255,0.1); padding: 0.25rem 0.5rem; border-radius: 0.25rem;">Echap</kbd> pour fermer
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
                                >
                            </div>

                            ${results.length > 0 ? `
                                <div>
                                    <div class="text-white mb-2" style="opacity: 0.7;">${results.length} résultat${results.length > 1 ? 's' : ''}</div>
                                    ${results.map(result => `
                                        <div class="search-result" onclick='${result.action.toString().replace(/^.*{|}$/g, '')}'>
                                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                                <div style="flex: 1;">
                                                    <div class="text-white" style="font-weight: 600; margin-bottom: 0.25rem;">${result.titre}</div>
                                                    <div class="text-white" style="opacity: 0.7; font-size: 0.9rem;">${result.description}</div>
                                                </div>
                                                <span class="badge" style="background: var(--primary-color); font-size: 0.8rem;">${result.type}</span>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : this.globalSearchQuery ? `
                                <div class="text-center" style="padding: 3rem; opacity: 0.5;">
                                    <div style="font-size: 3rem;">🔍</div>
                                    <div class="text-white" style="margin-top: 1rem;">Aucun résultat</div>
                                </div>
                            ` : `
                                <div class="text-center" style="padding: 3rem; opacity: 0.5;">
                                    <div style="font-size: 3rem;">💡</div>
                                    <div class="text-white" style="margin-top: 1rem;">Tape pour chercher partout dans l'app</div>
                                </div>
                            `}

                            <div class="tip-box mt-4">
                                <div class="text-white" style="font-size: 0.9rem; opacity: 0.7;">
                                    💡 Astuce : Appuie sur <kbd style="background: rgba(255,255,255,0.1); padding: 0.25rem 0.5rem; border-radius: 0.25rem;">Echap</kbd> pour fermer
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
                }
                
                this.addObjectif(titre, type, cible, muscle, exercice);
                document.getElementById('objectif-form').reset();
                this.updateObjectifForm();
            }
            renderBadgesTab() {
                const unlockedCount = this.badges.filter(b => b.unlocked).length;
                const totalCount = this.badges.length;
                const progressPercent = Math.round((unlockedCount / totalCount) * 100);

                return `
                    <div>
                        <h2 class="text-white mb-4" style="font-size: 1.5rem;">🏆 Mes Badges (${unlockedCount}/${totalCount})</h2>
                        <div class="mb-4">
                            <div class="text-white mb-2" style="font-weight: 600;">Progression globale : ${progressPercent}%</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercent}%;"></div>
                            </div>
                        </div>
                        <div class="badge-grid">
                            ${this.badges.map(badge => `
                                <div class="badge-item ${badge.unlocked ? 'unlocked' : 'locked'}">
                                    <div class="badge-icon">${badge.icon}</div>
                                    <div class="text-white" style="font-weight: 600; margin-bottom: 0.5rem;">${badge.name}</div>
                                    <div class="text-white" style="opacity: 0.7; font-size: 0.85rem; margin-bottom: 0.5rem;">${badge.description}</div>
                                    ${badge.unlocked ? `<div class="text-cyan" style="font-size: 0.8rem;">✓ Débloqué le ${new Date(badge.unlockedAt).toLocaleDateString('fr-FR')}</div>` : `<div class="text-white" style="opacity: 0.5; font-size: 0.8rem;">🔒 Verrouillé</div>`}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            renderCoursTab() {
                const allExercises = [
                    ...coursData.exercicesPectoraux,
                    ...coursData.exercicesDos,
                    ...coursData.exercicesEpaules,
                    ...coursData.exercicesBras,
                    ...coursData.exercicesBasDuCorps,
                    ...coursData.exercicesAbdos
                ];
                const filteredExercises = this.filterExercises(allExercises);

                return `
                    <div>
                        <h2 class="text-white mb-4" style="font-size: 1.5rem;">📚 Cours & Ressources</h2>
                        <div class="flex gap-2 mb-4" style="overflow-x: auto;">
                            <button class="sub-tab-btn ${this.currentCoursTab === 'principes' ? 'active' : ''}" onclick="app.switchCoursTab('principes')">📖 Principes</button>
                            <button class="sub-tab-btn ${this.currentCoursTab === 'mobiles' ? 'active' : ''}" onclick="app.switchCoursTab('mobiles')">🎯 Mobiles</button>
                            <button class="sub-tab-btn ${this.currentCoursTab === 'contractions' ? 'active' : ''}" onclick="app.switchCoursTab('contractions')">💪 Contractions</button>
                            <button class="sub-tab-btn ${this.currentCoursTab === 'hygiene' ? 'active' : ''}" onclick="app.switchCoursTab('hygiene')">🧘 Hygiène</button>
                            <button class="sub-tab-btn ${this.currentCoursTab === 'anatomie' ? 'active' : ''}" onclick="app.switchCoursTab('anatomie')">🫀 Anatomie</button>
                            <button class="sub-tab-btn ${this.currentCoursTab === 'exercices' ? 'active' : ''}" onclick="app.switchCoursTab('exercices')">🏋️ Exercices</button>
                        </div>
                        ${this.currentCoursTab === 'principes' ? this.renderPrincipesTab() : ''}
                        ${this.currentCoursTab === 'mobiles' ? this.renderMobilesTab() : ''}
                        ${this.currentCoursTab === 'contractions' ? this.renderContractionsTab() : ''}
                        ${this.currentCoursTab === 'hygiene' ? this.renderHygieneTab() : ''}
                        ${this.currentCoursTab === 'anatomie' ? this.renderAnatomieTab() : ''}
                        ${this.currentCoursTab === 'exercices' ? this.renderExercicesTab(filteredExercises) : ''}
                    </div>
                `;
            }

            filterExercises(exercises) {
                let filtered = exercises;
                if (this.searchQuery) {
                    const query = this.searchQuery.toLowerCase();
                    filtered = filtered.filter(ex => 
                        ex.nom.toLowerCase().includes(query) || 
                        ex.description.toLowerCase().includes(query)
                    );
                }
                if (this.activeFilters.length > 0) {
                    const muscleMap = {
                        'Pectoraux': coursData.exercicesPectoraux,
                        'Dos': coursData.exercicesDos,
                        'Épaules': coursData.exercicesEpaules,
                        'Bras': coursData.exercicesBras,
                        'Bas du corps': coursData.exercicesBasDuCorps,
                        'Abdos': coursData.exercicesAbdos
                    };
                    filtered = filtered.filter(ex => 
                        this.activeFilters.some(filter => 
                            muscleMap[filter] && muscleMap[filter].includes(ex)
                        )
                    );
                }
                return filtered;
            }

            renderExercicesTab(filteredExercises) {
                const filters = ['Pectoraux', 'Dos', 'Épaules', 'Bras', 'Bas du corps', 'Abdos'];
                return `
                    <div>
                        <div class="search-container">
                            <div class="search-input-wrapper">
                                <span class="search-icon">🔍</span>
                                <input type="text" class="search-input" placeholder="Rechercher un exercice..." value="${this.searchQuery}" oninput="app.updateSearchQuery(this.value)">
                            </div>
                            <div class="filter-chips">
                                ${filters.map(filter => `<button class="filter-chip ${this.activeFilters.includes(filter) ? 'active' : ''}" onclick="app.toggleFilter('${filter}')">${filter}</button>`).join('')}
                            </div>
                        </div>
                        ${filteredExercises.length > 0 ? `
                            <div class="text-white mb-3" style="opacity: 0.7;">${filteredExercises.length} exercice${filteredExercises.length > 1 ? 's' : ''}</div>
                            ${filteredExercises.map(ex => `
                                <div class="exercise-card">
                                    <h4>${ex.nom}</h4>
                                    <p class="text-white" style="opacity: 0.9; margin-bottom: 1rem;">${ex.description}</p>
                                    ${ex.technique ? `<div class="mb-3"><div class="text-cyan" style="font-weight: 600; margin-bottom: 0.5rem;">📋 Technique :</div><ul>${ex.technique.map(t => `<li>${t}</li>`).join('')}</ul></div>` : ''}
                                    ${ex.variantes ? `<div class="mb-3"><div class="text-cyan" style="font-weight: 600; margin-bottom: 0.5rem;">🔄 Variantes :</div><div class="text-white" style="opacity: 0.9;">${ex.variantes.join(' • ')}</div></div>` : ''}
                                </div>
                                    ${ex.video ? `<a href="${ex.video}" target="_blank" class="btn btn-primary" style="text-decoration: none;">🎥 Voir la vidéo</a>` : ""}
                                    ${ex.videos ? `<div class="flex gap-2">${ex.videos.map((vid, idx) => `<a href="${vid}" target="_blank" class="btn btn-primary" style="text-decoration: none; flex: 1;">🎥 Vidéo ${idx + 1}</a>`).join("")}</div>` : ""}
                            `).join('')}
                        ` : `<div class="no-results"><div class="no-results-icon">🔍</div><div class="text-white" style="font-size: 1.2rem;">Aucun exercice</div></div>`}
                    </div>
                `;
            }

            renderPrincipesTab() {
                return `<div>${coursData.principes.map(p => `<div class="exercise-card"><h4>${p.titre}</h4><p class="text-white" style="opacity: 0.9; margin-bottom: 1rem;">${p.contenu}</p><div class="text-cyan" style="font-weight: 600; margin-bottom: 0.5rem;">💡 Conseils :</div><ul>${p.conseils.map(c => `<li>${c}</li>`).join('')}</ul></div>`).join('')}</div>`;
            }

            renderMobilesTab() {
                return `<div>${coursData.mobiles.map(m => `<div class="exercise-card" style="border-left: 4px solid ${m.color};"><h4 style="color: ${m.color};">${m.nom}</h4><p class="text-white" style="opacity: 0.9; font-weight: 600;">${m.objectif}</p><table class="mobile-table"><tr><th>Charge</th><td>${m.charge}</td></tr><tr><th>Répétitions</th><td>${m.repetitions}</td></tr><tr><th>Séries</th><td>${m.series}</td></tr><tr><th>Repos</th><td>${m.repos}</td></tr></table><div style="margin-top: 1rem;"><div class="text-cyan" style="font-weight: 600; margin-bottom: 0.5rem;">🏋️ Formes :</div><ul>${m.formes.map(f => `<li>${f}</li>`).join('')}</ul></div></div>`).join('')}</div>`;
            }

            renderContractionsTab() {
                return `<div>${coursData.typesContraction.map(t => `<div class="exercise-card"><h4>${t.type}</h4><p class="text-white" style="opacity: 0.9;"><strong>Définition :</strong> ${t.definition}</p><p class="text-cyan"><strong>Exemple :</strong> ${t.exemple}</p><p class="text-white" style="opacity: 0.8;"><strong>Mobile :</strong> ${t.mobile}</p></div>`).join('')}</div>`;
            }

            renderHygieneTab() {
                return `<div><div class="content-section"><h3 class="text-white mb-3" style="font-size: 1.3rem;">✅ Avant</h3>${coursData.hygiene.avant.map(i => `<div class="exercise-card"><h4>${i.titre}</h4><p class="text-white" style="opacity: 0.9;">${i.contenu}</p></div>`).join('')}</div><div class="content-section"><h3 class="text-white mb-3" style="font-size: 1.3rem;">💪 Pendant</h3>${coursData.hygiene.pendant.map(i => `<div class="exercise-card"><h4>${i.titre}</h4><p class="text-white" style="opacity: 0.9;">${i.contenu}</p></div>`).join('')}</div><div class="content-section"><h3 class="text-white mb-3" style="font-size: 1.3rem;">🧘 Après</h3>${coursData.hygiene.apres.map(i => `<div class="exercise-card"><h4>${i.titre}</h4><p class="text-white" style="opacity: 0.9;">${i.contenu}</p></div>`).join('')}</div></div>`;
            }

            renderAnatomieTab() {
                // Liste complète des muscles avec leurs infos
                const allMuscles = {
                    "Pectoraux": {
                        role: "Adduction, flexion et rotation interne épaule. Mouvements de poussée.",
                        insertions: ["Clavicule, sternum → Humérus", "3 faisceaux: haut, milieu, bas"]
                    },
                    "Grand Dorsal": {
                        role: "Extension, adduction épaule. Forme en V du dos.",
                        insertions: ["Vertèbres, crête iliaque → Humérus", "Travaillé en traction"]
                    },
                    "Trapèze": {
                        role: "Élévation, abaissement, rétraction omoplates. Posture.",
                        insertions: ["3 faisceaux: supérieur, moyen, inférieur", "Crâne, vertèbres → Omoplate"]
                    },
                    "Deltoïde": {
                        role: "Abduction, flexion, extension épaule. Largeur épaules.",
                        insertions: ["3 faisceaux: antérieur, moyen, postérieur", "Clavicule, omoplate → Humérus"]
                    },
                    "Biceps": {
                        role: "Flexion coude et supination avant-bras.",
                        insertions: ["2 chefs depuis omoplate → Radius", "Synergiste: brachial"]
                    },
                    "Triceps": {
                        role: "Extension coude. 2/3 du volume du bras.",
                        insertions: ["3 chefs: long, latéral, médial", "Omoplate, humérus → Ulna"]
                    },
                    "Quadriceps": {
                        role: "Extension genou, flexion hanche. Plus puissant muscle.",
                        insertions: ["4 chefs: droit fémoral + 3 vastes", "Bassin, fémur → Rotule → Tibia"]
                    },
                    "Ischio-Jambiers": {
                        role: "Flexion genou, extension hanche. Antagonistes quadriceps.",
                        insertions: ["3 muscles", "Ischion → Tibia, fibula"]
                    },
                    "Fessiers": {
                        role: "Extension, abduction, rotation hanche. Muscle le plus puissant.",
                        insertions: ["Grand, moyen, petit fessier", "Iliaque, sacrum → Fémur"]
                    },
                    "Mollets": {
                        role: "Flexion plantaire cheville. Propulsion marche/course.",
                        insertions: ["Gastrocnémien (2 chefs) + Soléaire", "Fémur, tibia → Calcanéus (tendon d'Achille)"]
                    },
                    "Abdos": {
                        role: "Flexion du tronc. Stabilisation du bassin et de la colonne.",
                        insertions: ["Grand droit (6 pack)", "Côtes → Pubis"]
                    },
                    "Obliques": {
                        role: "Rotation et flexion latérale du tronc. Stabilisation.",
                        insertions: ["Obliques externes et internes", "Côtes → Bassin, aponévrose"]
                    },
                    "Grand Droit": {
                        role: "Flexion du tronc. Rapproche le sternum du pubis.",
                        insertions: ["Muscles des abdominaux (rectus abdominis)", "5ème, 6ème et 7ème côtes → Pubis"]
                    }
                };
                
                return `
                    <div>
                        <h3 class="text-white mb-3" style="font-size: 1.3rem;">📚 Planches Anatomiques</h3>
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <div style="background: rgba(15, 23, 42, 0.6); border-radius: 1rem; padding: 1rem; border: 1px solid rgba(148, 163, 184, 0.2);">
                                <h4 class="text-white mb-2" style="text-align: center; font-size: 1.1rem;">Vue de Face</h4>
                                <img src="images/planche_anatomique_face.PNG" alt="Planche anatomique face" style="width: 100%; border-radius: 0.75rem;">
                            </div>
                            <div style="background: rgba(15, 23, 42, 0.6); border-radius: 1rem; padding: 1rem; border: 1px solid rgba(148, 163, 184, 0.2);">
                                <h4 class="text-white mb-2" style="text-align: center; font-size: 1.1rem;">Vue de Dos</h4>
                                <img src="images/planche_anatomique_dos.PNG" alt="Planche anatomique dos" style="width: 100%; border-radius: 0.75rem;">
                            </div>
                        </div>
                        
                        <h3 class="text-white mb-3 mt-4" style="font-size: 1.3rem;">💪 Groupes Musculaires</h3>
                        ${Object.entries(allMuscles).map(([muscleName, info]) => `
                            <div class="muscle-info-card">
                                <h4>${muscleName}</h4>
                                <div class="muscle-info-section">
                                    <h5>🎯 Rôle</h5>
                                    <p>${info.role}</p>
                                </div>
                                <div class="muscle-info-section">
                                    <h5>📍 Insertions</h5>
                                    <ul>
                                        ${info.insertions.map(ins => `<li>${ins}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            renderSessionForm() {
                const isEditing = this.currentSession !== null;
                const session = isEditing ? this.sessions[this.currentSession] : {
                    nom: '', 
                    type: 'Force', 
                    muscles: [], 
                    exercices: [],
                    series: 5,
                    repetitions: 5,
                    intensite: 90,
                    repos: 180,
                    isPersonnalise: false
                };
                
                const mobileInfo = {
                    'Force': {
                        color: '#ef4444',
                        objectif: 'Développer la force maximale',
                        charges: '85-100% de 1RM',
                        reps: '1-5 répétitions',
                        series: '3-6 séries',
                        repos: '3-5 minutes',
                        exemple: 'Développé couché : 5 séries de 3 reps à 90% (si 1RM = 100kg → 90kg)',
                        conseil: 'Explosivité sur la phase concentrique, contrôle en excentrique'
                    },
                    'Équilibre': {
                        color: '#3b82f6',
                        objectif: 'Hypertrophie musculaire (prise de masse)',
                        charges: '65-80% de 1RM',
                        reps: '6-12 répétitions',
                        series: '3-5 séries',
                        repos: '60-90 secondes',
                        exemple: 'Squat : 4 séries de 10 reps à 75% (si 1RM = 140kg → 105kg)',
                        conseil: 'Tempo contrôlé, temps sous tension optimal pour hypertrophie'
                    },
                    'Endurance': {
                        color: '#10b981',
                        objectif: 'Endurance musculaire et définition',
                        charges: '40-60% de 1RM',
                        reps: '15-25+ répétitions',
                        series: '2-4 séries',
                        repos: '30-60 secondes',
                        exemple: 'Leg extension : 3 séries de 20 reps à 50% (si 1RM = 80kg → 40kg)',
                        conseil: 'Rythme soutenu, brûlure musculaire recherchée'
                    },
                    'Personnalisé': {
                        color: '#a855f7',
                        objectif: 'Programme sur mesure',
                        charges: 'Au choix',
                        reps: 'Au choix',
                        series: 'Au choix',
                        repos: 'Au choix',
                        exemple: 'Vous définissez tous les paramètres',
                        conseil: 'Adaptez selon vos objectifs spécifiques'
                    }
                };
                
                const currentMobileInfo = mobileInfo[session.type] || mobileInfo['Force'];
                
                return `
                    <div class="container">
                        <div class="card">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-white" style="font-size: 1.5rem;">${isEditing ? '✏️ Modifier' : '➕ Créer'} une séance</h2>
                                <button class="btn btn-secondary" onclick="app.cancelSession()">← Retour</button>
                            </div>
                            <form id="session-form">
                                <div class="mb-4">
                                    <label class="text-white mb-1" style="display: block;">Nom de la séance</label>
                                    <input type="text" class="input" id="session-name" placeholder="Ex: Upper Push A" value="${session.nom}" required>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="text-white mb-2" style="display: block; font-size: 1.1rem;">Mobile d'entraînement</label>
                                    <select class="input" id="session-type" onchange="app.updateMobileInfo()" required>
                                        <option value="Force" ${session.type === 'Force' ? 'selected' : ''}>💪 Force</option>
                                        <option value="Équilibre" ${session.type === 'Équilibre' ? 'selected' : ''}>⚖️ Équilibre (Hypertrophie)</option>
                                        <option value="Endurance" ${session.type === 'Endurance' ? 'selected' : ''}>🏃 Endurance</option>
                                        <option value="Personnalisé" ${session.type === 'Personnalisé' ? 'selected' : ''}>⚙️ Personnalisé</option>
                                    </select>
                                </div>
                                
                                <div id="mobile-info" class="mb-4" style="background: linear-gradient(135deg, ${currentMobileInfo.color}20 0%, ${currentMobileInfo.color}10 100%); border: 2px solid ${currentMobileInfo.color}; border-radius: 1rem; padding: 1.5rem;">
                                    <div class="text-white" style="font-weight: 600; font-size: 1.1rem; margin-bottom: 0.5rem;">🎯 ${currentMobileInfo.objectif}</div>
                                    <div class="grid grid-cols-2 gap-2 mb-3">
                                        <div class="text-white" style="opacity: 0.9;"><strong>Charges :</strong> ${currentMobileInfo.charges}</div>
                                        <div class="text-white" style="opacity: 0.9;"><strong>Répétitions :</strong> ${currentMobileInfo.reps}</div>
                                        <div class="text-white" style="opacity: 0.9;"><strong>Séries :</strong> ${currentMobileInfo.series}</div>
                                        <div class="text-white" style="opacity: 0.9;"><strong>Repos :</strong> ${currentMobileInfo.repos}</div>
                                    </div>
                                    <div class="text-white" style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 0.75rem; margin-bottom: 0.75rem;">
                                        <div style="font-weight: 600; margin-bottom: 0.5rem;">📝 Exemple :</div>
                                        ${currentMobileInfo.exemple}
                                    </div>
                                    <div class="text-cyan" style="font-size: 0.9rem;">💡 ${currentMobileInfo.conseil}</div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-white" style="font-size: 1.1rem;">⚙️ Paramètres d'entraînement</label>
                                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input type="checkbox" id="mode-personnalise" ${session.isPersonnalise ? 'checked' : ''} onchange="app.togglePersonnalise()">
                                            <span class="text-white" style="font-size: 0.9rem;">Personnaliser</span>
                                        </label>
                                    </div>
                                    
                                    <div id="parametres-container" style="${session.isPersonnalise || session.type === 'Personnalisé' ? '' : 'opacity: 0.5; pointer-events: none;'}">
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <label class="text-white mb-1" style="display: block; font-size: 0.9rem;">Séries</label>
                                                <input type="number" class="input" id="session-series" value="${session.series || 5}" min="1" max="10" ${session.isPersonnalise || session.type === 'Personnalisé' ? '' : 'disabled'}>
                                            </div>
                                            <div>
                                                <label class="text-white mb-1" style="display: block; font-size: 0.9rem;">Répétitions</label>
                                                <input type="number" class="input" id="session-repetitions" value="${session.repetitions || 5}" min="1" max="50" ${session.isPersonnalise || session.type === 'Personnalisé' ? '' : 'disabled'}>
                                            </div>
                                            <div>
                                                <label class="text-white mb-1" style="display: block; font-size: 0.9rem;">Intensité (% 1RM)</label>
                                                <input type="number" class="input" id="session-intensite" value="${session.intensite || 90}" min="30" max="100" ${session.isPersonnalise || session.type === 'Personnalisé' ? '' : 'disabled'}>
                                            </div>
                                            <div>
                                                <label class="text-white mb-1" style="display: block; font-size: 0.9rem;">Repos (secondes)</label>
                                                <input type="number" class="input" id="session-repos" value="${session.repos || 180}" min="15" max="600" step="15" ${session.isPersonnalise || session.type === 'Personnalisé' ? '' : 'disabled'}>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="text-white mb-2" style="display: block; font-size: 1.1rem;">💪 Muscles ciblés</label>
                                    <div class="grid grid-cols-2 gap-2">
                                        ${this.musclesList.map(m => `<button type="button" class="muscle-btn ${this.musclesTemp.includes(m) ? 'selected' : ''}" onclick="app.toggleMuscle('${m}')">${m}</button>`).join('')}
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="text-white mb-2" style="display: block; font-size: 1.1rem;">🏋️ Exercices</label>
                                    <div class="flex gap-2 mb-2">
                                        <input type="text" class="input" id="exercice-name" placeholder="Nom de l'exercice" style="flex: 1;">
                                        <button type="button" class="btn btn-primary" onclick="app.addExercice()">➕</button>
                                    </div>
                                    ${this.exercicesTemp.length > 0 ? `
                                        <div>
                                            ${this.exercicesTemp.map((ex, i) => `
                                                <div class="exercice-item flex justify-between items-center">
                                                    <span class="text-white">${i + 1}. ${ex}</span>
                                                    <button type="button" class="btn btn-danger" style="padding: 0.5rem 1rem;" onclick="app.removeExercice(${i})">🗑️</button>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : `
                                        <div class="text-center" style="padding: 2rem; opacity: 0.5;">
                                            <div class="text-white">Aucun exercice ajouté</div>
                                        </div>
                                    `}
                                </div>
                                
                                <button type="submit" class="btn btn-success" style="width: 100%;">💾 ${isEditing ? 'Enregistrer les modifications' : 'Créer la séance'}</button>
                            </form>
                        </div>
                    </div>
                `;
            }
            
            updateMobileInfo() {
                const selectedType = document.getElementById('session-type').value;
                const isPersonnalise = document.getElementById('mode-personnalise')?.checked || selectedType === 'Personnalisé';
                
                // Mettre à jour les valeurs par défaut selon le mobile
                const defaults = {
                    'Force': {series: 5, repetitions: 3, intensite: 90, repos: 180},
                    'Équilibre': {series: 4, repetitions: 10, intensite: 75, repos: 75},
                    'Endurance': {series: 3, repetitions: 20, intensite: 50, repos: 45},
                    'Personnalisé': {series: 4, repetitions: 8, intensite: 70, repos: 90}
                };
                
                const params = defaults[selectedType] || defaults['Force'];
                
                if (!isPersonnalise && selectedType !== 'Personnalisé') {
                    document.getElementById('session-series').value = params.series;
                    document.getElementById('session-repetitions').value = params.repetitions;
                    document.getElementById('session-intensite').value = params.intensite;
                    document.getElementById('session-repos').value = params.repos;
                }
                
                this.render();
            }
            
            togglePersonnalise() {
                const isChecked = document.getElementById('mode-personnalise').checked;
                const container = document.getElementById('parametres-container');
                const inputs = container.querySelectorAll('input');
                
                if (isChecked) {
                    container.style.opacity = '1';
                    container.style.pointerEvents = 'auto';
                    inputs.forEach(input => input.disabled = false);
                } else {
                    container.style.opacity = '0.5';
                    container.style.pointerEvents = 'none';
                    inputs.forEach(input => input.disabled = true);
                    this.updateMobileInfo();
                }
            }
            renderSessionDetail() {
                const session = this.sessions[this.currentSession];
                if (!session) return '';
                return `
                    <div class="container">
                        <div class="card">
                            <div class="flex justify-between items-center mb-4"><h2 class="text-white" style="font-size: 1.5rem;">${session.nom}</h2><button class="btn btn-secondary" onclick="app.backToSessions()">← Retour</button></div>
                            <div class="mb-4"><span class="badge badge-${session.type.toLowerCase()}" style="font-size: 1rem; padding: 0.5rem 1rem;">${session.type}</span></div>
                            <div class="mb-4"><h3 class="text-white mb-2" style="font-size: 1.2rem;">💪 Muscles</h3><div class="text-white" style="opacity: 0.9;">${session.muscles.join(', ')}</div></div>
                            <div class="mb-4"><h3 class="text-white mb-2" style="font-size: 1.2rem;">📋 Exercices (${session.exercices.length})</h3>${session.exercices.map((ex, i) => `<div class="exercice-item"><span class="text-white" style="font-weight: 600;">${i + 1}. ${ex}</span></div>`).join('')}</div>
                            <div class="session-completion-modal mb-4"><h3 class="text-white mb-3" style="font-size: 1.1rem;">✅ Marquer comme effectuée</h3><label class="text-white mb-2" style="display: block;">📝 Notes (optionnel)</label><textarea id="session-notes" class="session-notes-area" placeholder="Ressentis, performances..."></textarea><button class="btn btn-success" style="width: 100%; margin-top: 1rem;" onclick="app.markSessionCompleted()">✅ Valider</button></div>
                            <div class="flex gap-2"><button class="btn btn-warning" style="flex: 1;" onclick="app.editSession(${this.currentSession})">✏️</button><button class="btn btn-danger" style="flex: 1;" onclick="app.deleteSession(${this.currentSession})">🗑️</button></div>
                        </div>
                    </div>
                `;
            }

            switchTab(tab) {
                this.currentTab = tab;
                if (tab === 'progression') setTimeout(() => this.initCharts(), 100);
                this.render();
            }

            switchCoursTab(tab) {
                this.currentCoursTab = tab;
                this.searchQuery = '';
                this.activeFilters = [];
                this.render();
            }

            toggleFilter(filter) {
                const index = this.activeFilters.indexOf(filter);
                if (index > -1) this.activeFilters.splice(index, 1);
                else this.activeFilters.push(filter);
                this.render();
            }

            updateSearchQuery(query) {
                this.searchQuery = query;
                this.render();
            }

            changeTheme(theme) {
                this.currentTheme = theme;
                this.applyTheme(theme);
                this.saveTheme();
                this.render();
            }



            calculateCharges() {
                const select = document.getElementById('charges-rm-select');
                const index = parseInt(select.value);
                if (isNaN(index)) {
                    this.calculatedCharges = {};
                } else {
                    const test = this.rmHistory[index];
                    this.calculatedCharges = {exercise: test.exercise, rm: test.rm};
                    this.saveCalculatedCharges();
                }
                this.render();
            }

            initCharts() {
                if (this.rmHistory.length === 0) return;
                const exerciseGroups = {};
                this.rmHistory.forEach(test => {
                    if (!exerciseGroups[test.exercise]) exerciseGroups[test.exercise] = [];
                    exerciseGroups[test.exercise].push(test);
                });
                Object.entries(exerciseGroups).forEach(([exercise, tests]) => {
                    const sortedTests = tests.sort((a, b) => new Date(a.date) - new Date(b.date));
                    const chartId = `chart-${exercise.replace(/\s+/g, '-').toLowerCase()}`;
                    const canvas = document.getElementById(chartId);
                    if (!canvas) return;
                    new Chart(canvas, {
                        type: 'line',
                        data: {
                            labels: sortedTests.map(t => new Date(t.date).toLocaleDateString('fr-FR', {day: 'numeric', month: 'short'})),
                            datasets: [{label: '1RM (kg)', data: sortedTests.map(t => t.rm), borderColor: 'rgb(6, 182, 212)', backgroundColor: 'rgba(6, 182, 212, 0.1)', tension: 0.4, fill: true, pointRadius: 6, pointHoverRadius: 8, pointBackgroundColor: 'rgb(6, 182, 212)', pointBorderColor: '#fff', pointBorderWidth: 2}]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {legend: {display: true, labels: {color: '#e2e8f0', font: {size: 14}}}, tooltip: {backgroundColor: 'rgba(15, 23, 42, 0.9)', titleColor: '#67e8f9', bodyColor: '#e2e8f0', borderColor: 'rgb(6, 182, 212)', borderWidth: 1, padding: 12, displayColors: false, callbacks: {label: (c) => `1RM : ${c.parsed.y}kg`}}},
                            scales: {y: {beginAtZero: false, ticks: {color: '#94a3b8', font: {size: 12}, callback: (v) => v + 'kg'}, grid: {color: 'rgba(148, 163, 184, 0.1)'}}, x: {ticks: {color: '#94a3b8', font: {size: 12}}, grid: {color: 'rgba(148, 163, 184, 0.1)'}}}
                        }
                    });
                });
            }setTimerMode(mode) {
                this.timerMode = mode;
                this.render();
            }

            showSignup() {
                this.currentView = 'signup';
                this.render();
            }

            showLogin() {
                this.currentView = 'login';
                this.render();
            }

            handleSelectUser() {
                const username = document.getElementById('select-user').value;
                if (username) {
                    this.currentUser = username;
                    this.currentView = 'dashboard';
                    this.init();
                } else {
                    alert('Veuillez sélectionner un profil');
                }
            }

            handleSignup(e) {
                e.preventDefault();
                const username = document.getElementById('signup-username').value.trim();
                const age = document.getElementById('signup-age').value;
                const sexe = document.getElementById('signup-sexe').value;
                const taille = document.getElementById('signup-taille').value;
                const poids = document.getElementById('signup-poids').value;

                if (!securite.verifierUtilisateur(username)) {
                    alert('❌ Accès refusé : Ce prénom n\'est pas autorisé.\n\nContactez votre professeur.');
                    return;
                }

                const userKey = `user-${username}`;
                if (localStorage.getItem(userKey)) {
                    alert('Ce profil existe déjà');
                    return;
                }

                const userData = {age, sexe, taille, poids};
                localStorage.setItem(userKey, JSON.stringify(userData));
                this.currentUser = username;
                this.currentView = 'dashboard';
                this.init();
            }

            updateProfile(e) {
                e.preventDefault();
                const age = document.getElementById('profile-age').value;
                const sexe = document.getElementById('profile-sexe').value;
                const taille = document.getElementById('profile-taille').value;
                const poids = document.getElementById('profile-poids').value;
                const userKey = `user-${this.currentUser}`;
                localStorage.setItem(userKey, JSON.stringify({age, sexe, taille, poids}));
                alert('✅ Profil mis à jour !');
                this.render();
            }

            logout() {
                if (confirm('Voulez-vous verrouiller l\'accès (code requis à la prochaine connexion) ?')) {
                    securite.revoquerAcces();
                    this.currentView = 'code-access';
                } else {
                    this.currentView = 'login';
                }
                this.currentUser = null;
                this.sessions = [];
                this.rmHistory = [];
                this.userAvatar = null;
                this.sessionHistory = [];
                this.calculatedCharges = {};
                this.badges = [];
                this.render();
            }

            calculateRM(e) {
                e.preventDefault();
                const muscle = document.getElementById('rm-muscle').value;
                const exercise = document.getElementById('rm-exercise').value;
                const weight = parseFloat(document.getElementById('rm-weight').value);
                const reps = parseInt(document.getElementById('rm-reps').value);
                const date = document.getElementById('rm-date').value;
                const rm = Math.round(weight * (1 + reps / 30));
                this.rmHistory.push({muscle, exercise, weight, reps, date, rm});
                this.saveRMHistory();
                this.checkBadges();
                document.getElementById('rm-result').innerHTML = `
                    <div class="rm-history-card">
                        <div class="text-center">
                            <div style="color: #10b981; font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">${rm} kg</div>
                            <div class="text-white" style="font-size: 1.2rem; margin-bottom: 1rem;">1RM estimé pour ${exercise}</div>
                            <div class="text-white" style="opacity: 0.7;">Basé sur ${weight}kg × ${reps} rép.</div>
                        </div>
                    </div>
                `;
                document.getElementById('rm-result').classList.remove('hidden');
                setTimeout(() => this.render(), 2000);
            }

            editRM(index) {
                const test = this.rmHistory[index];
                document.getElementById('rm-muscle').value = test.muscle;
                document.getElementById('rm-exercise').value = test.exercise;
                document.getElementById('rm-weight').value = test.weight;
                document.getElementById('rm-reps').value = test.reps;
                document.getElementById('rm-date').value = test.date;
                this.rmHistory.splice(index, 1);
                this.saveRMHistory();
                this.render();
            }

            deleteRM(index) {
                if (confirm('Supprimer ce test ?')) {
                    this.rmHistory.splice(index, 1);
                    this.saveRMHistory();
                    this.checkBadges();
                    this.render();
                }
            }

            createNewSession() {
                this.currentSession = null;
                this.exercicesTemp = [];
                this.musclesTemp = [];
                this.currentView = 'session-form';
                this.render();
            }

            editSession(index) {
                this.currentSession = index;
                const session = this.sessions[index];
                this.exercicesTemp = [...session.exercices];
                this.musclesTemp = [...session.muscles];
                this.currentView = 'session-form';
                this.render();
            }

            deleteSession(index) {
                if (confirm('Supprimer cette séance ?')) {
                    this.sessions.splice(index, 1);
                    this.saveSessions();
                    this.render();
                }
            }

            viewSession(index) {
                this.currentSession = index;
                this.currentView = 'session-detail';
                this.render();
            }

            cancelSession() {
                this.currentSession = null;
                this.currentView = 'dashboard';
                this.currentTab = 'sessions';
                this.render();
            }

            backToSessions() {
                this.currentSession = null;
                this.currentView = 'dashboard';
                this.currentTab = 'sessions';
                this.render();
            }

            toggleMuscle(muscle) {
                const index = this.musclesTemp.indexOf(muscle);
                if (index > -1) this.musclesTemp.splice(index, 1);
                else this.musclesTemp.push(muscle);
                this.render();
            }

            addExercice() {
                const exerciceName = document.getElementById('exercice-name').value.trim();
                if (exerciceName) {
                    this.exercicesTemp.push(exerciceName);
                    document.getElementById('exercice-name').value = '';
                    this.render();
                }
            }

            removeExercice(index) {
                this.exercicesTemp.splice(index, 1);
                this.render();
            }

            saveSession(e) {
                e.preventDefault();
                const nom = document.getElementById("session-name").value;
                const type = document.getElementById("session-type").value;
                const series = parseInt(document.getElementById("session-series").value) || 5;
                const repetitions = parseInt(document.getElementById("session-repetitions").value) || 5;
                const intensite = parseInt(document.getElementById("session-intensite").value) || 90;
                const repos = parseInt(document.getElementById("session-repos").value) || 180;
                const isPersonnalise = document.getElementById("mode-personnalise")?.checked || type === "Personnalisé";
                
                if (this.musclesTemp.length === 0) {
                    alert("Sélectionnez au moins un muscle");
                    return;
                }
                if (this.exercicesTemp.length === 0) {
                    alert("Ajoutez au moins un exercice");
                    return;
                }
                
                const sessionData = {
                    nom, 
                    type, 
                    muscles: this.musclesTemp, 
                    exercices: this.exercicesTemp,
                    series,
                    repetitions,
                    intensite,
                    repos,
                    isPersonnalise
                };
                
                if (this.currentSession !== null) {
                    this.sessions[this.currentSession] = sessionData;
                } else {
                    this.sessions.push(sessionData);
                }
                
                this.saveSessions();
                this.checkBadges();
                this.currentSession = null;
                this.currentView = "dashboard";
                this.currentTab = "sessions";
                this.render();
            }

            initSessionForm() {
                const isEditing = this.currentSession !== null;
                const session = isEditing ? this.sessions[this.currentSession] : {muscles: [], exercices: []};
                this.musclesTemp = [...session.muscles];
                this.exercicesTemp = [...session.exercices];
            }

            markSessionCompleted() {
                const notes = document.getElementById('session-notes').value.trim();
                const historyEntry = {
                    sessionIndex: this.currentSession,
                    completed: true,
                    completedAt: new Date().toISOString(),
                    notes: notes
                };
                this.sessionHistory.push(historyEntry);
                this.saveSessionHistory();
                this.checkBadges();
                this.calculateStreaks();
                this.updateObjectifProgress();
                alert('✅ Séance validée !');
                this.backToSessions();
            }

            exportData() {
                const data = {
                    sessions: this.sessions,
                    rmHistory: this.rmHistory,
                    avatar: this.userAvatar,
                    sessionHistory: this.sessionHistory,
                    calculatedCharges: this.calculatedCharges,
                    theme: this.currentTheme,
                    badges: this.badges,
                    userData: JSON.parse(localStorage.getItem(`user-${this.currentUser}`))
                };
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `livret-${this.currentUser}-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            }

            importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            if (data.sessions) this.sessions = data.sessions;
                            if (data.rmHistory) this.rmHistory = data.rmHistory;
                            if (data.avatar) this.userAvatar = data.avatar;
                            if (data.sessionHistory) this.sessionHistory = data.sessionHistory;
                            if (data.calculatedCharges) this.calculatedCharges = data.calculatedCharges;
                            if (data.theme) {
                                this.currentTheme = data.theme;
                                this.applyTheme(data.theme);
                            }
                            if (data.badges) this.badges = data.badges;
                            if (data.userData) {
                                localStorage.setItem(`user-${this.currentUser}`, JSON.stringify(data.userData));
                            }
                            this.saveSessions();
                            this.saveRMHistory();
                            this.saveUserAvatar();
                            this.saveSessionHistory();
                            this.saveCalculatedCharges();
                            this.saveTheme();
                            this.saveBadges();
                            alert('✅ Données importées !');
                            this.render();
                        } catch (error) {
                            alert('❌ Erreur lors de l\'importation');
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            }

            handleCodeAccess(e) {
                e.preventDefault();
                const code = document.getElementById('code-input').value;
                if (securite.verifierCode(code)) {
                    securite.validerCode();
                    this.currentView = 'login';
                    this.render();
                } else {
                    document.getElementById('code-error').classList.remove('hidden');
                    document.getElementById('code-input').value = '';
                    document.getElementById('code-input').focus();
                }
            }

            attachCodeAccessEvents() {
                const form = document.getElementById('code-form');
                if (form) form.addEventListener('submit', (e) => this.handleCodeAccess(e));
            }

            attachLoginEvents() {}

            attachSignupEvents() {
                const form = document.getElementById('signup-form');
                if (form) form.addEventListener('submit', (e) => this.handleSignup(e));
                const avatarInput = document.getElementById('avatar-input');
                if (avatarInput) {
                    avatarInput.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (event) => {
                                document.getElementById('avatar-preview').innerHTML = `<img src="${event.target.result}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                                this.userAvatar = event.target.result;
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }
            }

            attachDashboardEvents() {
                if (this.currentTab === 'profil') {
                    const form = document.getElementById('profile-form');
                    if (form) form.addEventListener('submit', (e) => this.updateProfile(e));
                    const avatarInput = document.getElementById('profile-avatar-input');
                    if (avatarInput) {
                        avatarInput.addEventListener('change', (e) => {
                            const file = e.target.files[0];
                            if (file) {
                                const reader = new FileReader();
                                reader.onload = (event) => {
                                    this.userAvatar = event.target.result;
                                    this.saveUserAvatar();
                                    this.render();
                                };
                                reader.readAsDataURL(file);
                            }
                        });
                    }
                }
                if (this.currentTab === 'rm') {
                    const form = document.getElementById('rm-form');
                    if (form) form.addEventListener('submit', (e) => this.calculateRM(e));
                    const dateInput = document.getElementById('rm-date');
                    if (dateInput && !dateInput.value) dateInput.valueAsDate = new Date();
                }
            }

            attachSessionFormEvents() {
                this.initSessionForm();
                const form = document.getElementById('session-form');
                if (form) form.addEventListener('submit', (e) => this.saveSession(e));
                const exerciceInput = document.getElementById('exercice-name');
                if (exerciceInput) {
                    exerciceInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            this.addExercice();
                        }
                    });
                }
            }

            attachSessionDetailEvents() {}

            setTimerPreset(seconds) {
                this.timerSeconds = seconds;
                this.timerRunning = false;
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
                this.render();
            }

            setCustomTimer() {
                const minutes = parseInt(document.getElementById('custom-minutes').value) || 0;
                const seconds = parseInt(document.getElementById('custom-seconds').value) || 0;
                this.timerSeconds = minutes * 60 + seconds;
                this.timerRunning = false;
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
                this.render();
            }

            toggleTimer() {
                if (this.timerRunning) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                    this.timerRunning = false;
                } else {
                    this.timerRunning = true;
                    this.timerInterval = setInterval(() => {
                        if (this.timerSeconds > 0) {
                            this.timerSeconds--;
                            this.updateTimerDisplay();
                        } else {
                            this.timerFinished();
                        }
                    }, 1000);
                }
                this.render();
            }

            updateTimerDisplay() {
                const display = document.getElementById('timer-display');
                if (display) {
                    const minutes = Math.floor(this.timerSeconds / 60);
                    const seconds = this.timerSeconds % 60;
                    display.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    if (this.timerSeconds === 0) display.classList.add('finished');
                }
            }

            timerFinished() {
                clearInterval(this.timerInterval);
                this.timerInterval = null;
                this.timerRunning = false;
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance('Repos terminé');
                    utterance.lang = 'fr-FR';
                    utterance.rate = 1.2;
                    speechSynthesis.speak(utterance);
                }
                if ('vibrate' in navigator) navigator.vibrate([200, 100, 200]);
                this.render();
            }

            resetTimer() {
                clearInterval(this.timerInterval);
                this.timerInterval = null;
                this.timerRunning = false;
                this.timerSeconds = 60;
                this.render();
            }

            toggleChrono() {
                if (this.chronoRunning) {
                    clearInterval(this.chronoInterval);
                    this.chronoInterval = null;
                    this.chronoRunning = false;
                } else {
                    this.chronoRunning = true;
                    this.chronoInterval = setInterval(() => {
                        this.chronoSeconds++;
                        this.updateChronoDisplay();
                    }, 1000);
                }
                this.render();
            }

            updateChronoDisplay() {
                const display = document.getElementById('chrono-display');
                if (display) {
                    const minutes = Math.floor(this.chronoSeconds / 60);
                    const seconds = this.chronoSeconds % 60;
                    display.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }

            addLap() {
                const minutes = Math.floor(this.chronoSeconds / 60);
                const seconds = this.chronoSeconds % 60;
                const lapTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                this.chronoLaps.push(lapTime);
                this.render();
            }

            resetChrono() {
                clearInterval(this.chronoInterval);
                this.chronoInterval = null;
                this.chronoRunning = false;
                this.chronoSeconds = 0;
                this.chronoLaps = [];
                this.render();
            }
        }

        let app;
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                app = new LivretApp();
            });
        } else {
            app = new LivretApp();
        }
    </script>
</body>
</html>