<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Livret de Musculation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #06b6d4;
            --primary-dark: #0891b2;
            --secondary-color: #10b981;
            --accent-color: #fb923c;
            --bg-dark: #0f172a;
            --bg-medium: #1e293b;
            --text-light: #e2e8f0;
            --text-cyan: #67e8f9;
        }

        body.theme-blue {
            --primary-color: #3b82f6;
            --primary-dark: #2563eb;
            --secondary-color: #06b6d4;
            --accent-color: #8b5cf6;
        }

        body.theme-green {
            --primary-color: #10b981;
            --primary-dark: #059669;
            --secondary-color: #14b8a6;
            --accent-color: #84cc16;
        }

        body.theme-purple {
            --primary-color: #a855f7;
            --primary-dark: #9333ea;
            --secondary-color: #ec4899;
            --accent-color: #f43f5e;
        }

        body.theme-orange {
            --primary-color: #f97316;
            --primary-dark: #ea580c;
            --secondary-color: #fb923c;
            --accent-color: #fbbf24;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 100%);
            min-height: 100vh;
            color: var(--text-light);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .card {
            background: rgba(30, 41, 59, 0.95);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .text-white {
            color: #f1f5f9;
        }

        .text-cyan {
            color: var(--text-cyan);
        }

        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }

        .input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 0.75rem;
            color: #f1f5f9;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(6, 182, 212, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn-warning:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(245, 158, 11, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(100, 116, 139, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(239, 68, 68, 0.4);
        }

        .btn-link {
            background: transparent;
            color: var(--text-cyan);
            padding: 0.5rem 1rem;
        }

        .btn-link:hover {
            background: rgba(6, 182, 212, 0.1);
        }

        .flex {
            display: flex;
        }

        .justify-between {
            justify-content: space-between;
        }

        .items-center {
            align-items: center;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .gap-3 {
            gap: 0.75rem;
        }

        .grid {
            display: grid;
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .text-center {
            text-align: center;
        }

        .user-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: 0 10px 25px -5px rgba(6, 182, 212, 0.4);
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.75rem;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            white-space: nowrap;
        }

        .tab-btn:hover {
            background: rgba(6, 182, 212, 0.1);
            color: var(--text-cyan);
            border-color: rgba(6, 182, 212, 0.3);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .sub-tab-btn {
            padding: 0.6rem 1rem;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.6rem;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .sub-tab-btn:hover {
            background: rgba(6, 182, 212, 0.1);
            color: var(--text-cyan);
            border-color: rgba(6, 182, 212, 0.3);
        }

        .sub-tab-btn.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .hidden {
            display: none;
        }

        .rm-history-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .rm-history-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(6, 182, 212, 0.2);
            border-color: rgba(6, 182, 212, 0.3);
        }

        .session-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .session-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(6, 182, 212, 0.2);
            border-color: rgba(6, 182, 212, 0.3);
        }

        .session-card.completed {
            border-color: rgba(16, 185, 129, 0.5);
            background: rgba(16, 185, 129, 0.05);
        }

        .session-completed-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .session-history-item {
            background: rgba(15, 23, 42, 0.4);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-force {
            background: rgba(249, 115, 22, 0.2);
            color: #fb923c;
            border: 1px solid rgba(249, 115, 22, 0.3);
        }

        .badge-endurance {
            background: rgba(6, 182, 212, 0.2);
            color: #67e8f9;
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .badge-équilibre {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .avatar-upload {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(15, 23, 42, 0.8);
            border: 3px dashed rgba(6, 182, 212, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin: 0 auto;
            transition: all 0.3s ease;
            font-size: 2.5rem;
        }

        .avatar-upload:hover {
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-color);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .default-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }

        .muscle-btn {
            padding: 1rem;
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.75rem;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-align: center;
        }

        .muscle-btn:hover {
            background: rgba(6, 182, 212, 0.1);
            color: var(--text-cyan);
            border-color: rgba(6, 182, 212, 0.3);
            transform: translateY(-2px);
        }

        .muscle-btn.selected {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .exercice-item {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .tip-box {
            background: rgba(6, 182, 212, 0.1);
            border-left: 4px solid var(--primary-color);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .warning-box {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .content-section {
            margin-bottom: 2rem;
        }

        .exercise-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .exercise-card h4 {
            color: var(--text-cyan);
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }

        .exercise-card ul {
            list-style: none;
            padding-left: 0;
        }

        .exercise-card ul li {
            color: var(--text-light);
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .exercise-card ul li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
        }

        .mobile-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .mobile-table th {
            background: rgba(6, 182, 212, 0.2);
            color: var(--text-cyan);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(6, 182, 212, 0.3);
        }

        .mobile-table td {
            padding: 1rem;
            color: var(--text-light);
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .mobile-table tr:hover {
            background: rgba(6, 182, 212, 0.05);
        }

        .anatomy-image-container {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1rem;
            text-align: center;
        }

        .anatomy-image-container img {
            width: 100%;
            height: auto;
            border-radius: 0.75rem;
        }

        .muscle-info-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .muscle-info-card h4 {
            color: var(--text-cyan);
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }

        .muscle-info-section {
            margin-bottom: 1rem;
        }

        .muscle-info-section h5 {
            color: #10b981;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .muscle-info-section p {
            color: var(--text-light);
            line-height: 1.7;
            margin-bottom: 0.5rem;
        }

        .muscle-info-section ul {
            list-style: none;
            padding-left: 0;
        }

        .muscle-info-section ul li {
            color: var(--text-light);
            padding: 0.4rem 0;
            padding-left: 1.5rem;
            position: relative;
            line-height: 1.6;
        }

        .muscle-info-section ul li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
        }

        /* TIMER STYLES */
        .timer-container {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 2px solid rgba(6, 182, 212, 0.4);
            border-radius: 1.5rem;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .timer-display {
            font-size: 5rem;
            font-weight: bold;
            color: var(--text-cyan);
            margin: 2rem 0;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 20px rgba(6, 182, 212, 0.5);
        }

        .timer-display.running {
            color: #10b981;
            animation: pulse 1s infinite;
        }

        .timer-display.paused {
            color: #f59e0b;
        }

        .timer-display.finished {
            color: #ef4444;
            animation: blink 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .timer-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin: 1.5rem 0;
        }

        .timer-preset {
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            color: var(--text-cyan);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .timer-preset:hover {
            background: rgba(6, 182, 212, 0.2);
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .timer-preset.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: transparent;
        }

        .timer-input-group {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            align-items: center;
            margin: 1rem 0;
        }

        .timer-input {
            width: 80px;
            padding: 0.5rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 0.5rem;
            color: #f1f5f9;
            font-size: 1rem;
            text-align: center;
        }

        .chrono-laps {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 1rem;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 0.75rem;
            padding: 1rem;
        }

        .lap-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
            color: var(--text-light);
        }

        .lap-item:last-child {
            border-bottom: none;
        }

        /* JOURNAL STYLES */
        .session-notes-area {
            width: 100%;
            min-height: 100px;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 0.75rem;
            color: #f1f5f9;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
        }

        .session-notes-area:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        .session-completion-modal {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        /* CALCULATEUR DE CHARGES */
        .charges-calculator {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.2) 0%, rgba(251, 146, 60, 0.2) 100%);
            border: 2px solid rgba(249, 115, 22, 0.4);
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .charges-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 0.75rem;
            overflow: hidden;
        }

        .charges-table th {
            background: rgba(249, 115, 22, 0.3);
            color: #fb923c;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(249, 115, 22, 0.3);
        }

        .charges-table td {
            padding: 1rem;
            color: var(--text-light);
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .charges-table tr:hover {
            background: rgba(249, 115, 22, 0.1);
        }

        .charge-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #fb923c;
        }

        /* RECHERCHE D'EXERCICES */
        .search-container {
            position: sticky;
            top: 0;
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem;
            border-radius: 1rem;
            margin-bottom: 1.5rem;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .search-input-wrapper {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            padding-left: 3rem;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 0.75rem;
            color: #f1f5f9;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        .filter-chips {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.75rem;
        }

        .filter-chip {
            padding: 0.5rem 1rem;
            background: rgba(6, 182, 212, 0.2);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 2rem;
            color: var(--text-cyan);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .filter-chip:hover {
            background: rgba(6, 182, 212, 0.3);
            transform: translateY(-2px);
        }

        .filter-chip.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: transparent;
        }

        .no-results {
            text-align: center;
            padding: 3rem 1rem;
            color: #94a3b8;
        }

        .no-results-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        /* MODE HORS-LIGNE */
        .offline-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
            }
            to {
                transform: translateY(0);
            }
        }

        .online-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10b981;
            margin-right: 0.5rem;
            animation: pulse-indicator 2s infinite;
        }

        .offline-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ef4444;
            margin-right: 0.5rem;
        }

        @keyframes pulse-indicator {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        /* GRAPHIQUES */
        .chart-container {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .chart-container canvas {
            max-height: 400px;
        }

        /* THÈMES */
        .theme-selector {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .theme-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .theme-btn:hover {
            transform: scale(1.1);
        }

        .theme-btn.active {
            border-color: white;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .theme-btn.theme-cyan {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
        }

        .theme-btn.theme-blue {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .theme-btn.theme-green {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .theme-btn.theme-purple {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
        }

        .theme-btn.theme-orange {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        }

        /* PHOTOS AVANT/APRÈS */
        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .photo-item {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1rem;
            text-align: center;
        }

        .photo-item img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .photo-placeholder {
            width: 100%;
            height: 300px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px dashed rgba(6, 182, 212, 0.5);
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-placeholder:hover {
            border-color: var(--primary-color);
            transform: scale(1.02);
        }

        /* BADGES */
        .badge-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .badge-item {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .badge-item.unlocked {
            border-color: var(--primary-color);
            background: rgba(6, 182, 212, 0.1);
        }

        .badge-item.locked {
            opacity: 0.4;
        }

        .badge-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .badge-item.unlocked .badge-icon {
            animation: bounce 1s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            .grid-cols-2 {
                grid-template-columns: 1fr;
            }

            .grid-cols-3 {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 0.5rem;
            }

            .card {
                padding: 1rem;
                border-radius: 1rem;
            }

            .flex {
                flex-direction: column;
            }

            .tab-btn, .sub-tab-btn {
                width: 100%;
                text-align: center;
            }

            .mobile-table {
                font-size: 0.85rem;
            }

            .mobile-table th,
            .mobile-table td {
                padding: 0.5rem;
            }

            .timer-display {
                font-size: 3rem;
            }

            .charges-table {
                font-size: 0.85rem;
            }

            .charges-table th,
            .charges-table td {
                padding: 0.5rem;
            }

            .charge-value {
                font-size: 1.1rem;
            }

            .photo-gallery {
                grid-template-columns: 1fr;
            }

            .badge-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div id="offline-banner" class="hidden"></div>
    <div id="app"></div>

    <script>// PARTIE 2/4 - DONNÉES ET SÉCURITÉ
        
        // SYSTÈME DE STOCKAGE LOCAL
        const storage = {
            save: (key, value) => {
                try {
                    const fullKey = `user-${app.currentUser}-${key}`;
                    const jsonValue = typeof value === 'string' ? value : JSON.stringify(value);
                    localStorage.setItem(fullKey, jsonValue);
                    return true;
                } catch (e) {
                    console.error('Erreur de sauvegarde:', e);
                    return false;
                }
            },
            
            get: (key, isGlobal = false) => {
                try {
                    const fullKey = isGlobal ? key : `user-${app.currentUser}-${key}`;
                    const value = localStorage.getItem(fullKey);
                    return {
                        exists: value !== null,
                        value: value
                    };
                } catch (e) {
                    console.error('Erreur de lecture:', e);
                    return { exists: false, value: null };
                }
            }
        };

        // SYSTÈME DE SÉCURITÉ PAR CODE D'ACCÈS
        const securite = {
            classes: {
                "2_CAP_ECP_25_26": {
                    code: "2CAPECP25",
                    nom: "2 CAP ECP 25-26",
                    eleves: [
                        "AZOULAI EDEN",
                        "BORRALHO EMMA",
                        "CARRILHO RITO LEANA",
                        "DE MATOS AMBRE",
                        "FAUCHER CAMILLE",
                        "FAUSTIN NINA",
                        "HOUËT LORELINE",
                        "LANDON LOUANE",
                        "MARCHIONE LAURA",
                        "PAPUCHON MELODIE",
                        "SIMON DAPHNE",
                        "STANKOVIC NINA",
                        "TASSILLY LENA",
                        "TRAN ALICE",
                        "VU--NGUYEN LEA"
                    ]
                },
                "1_CAP_ECP_25_26": {
                    code: "1CAPECP25",
                    nom: "1 CAP ECP 25-26",
                    eleves: [
                        "ALVAREZ ELUNA",
                        "AOUSSAT SONIA",
                        "ARAPOVIC NINA",
                        "AZZOUZ NOORE",
                        "CEBOTARI IURIANA",
                        "DA SILVA LEVIEUX JOY",
                        "DENIS DUPART MAELYS",
                        "FERNANDES-LEITAO KESSY",
                        "GUILLAUME SANOU ALANA",
                        "OLIVEIRA THERY",
                        "OSI LINA",
                        "ROUSSEL KLARA",
                        "STANKOVIC ALEXANDRA",
                        "WESPISER IZAGONOLA ANIA"
                    ]
                },
                "PROFESSEUR_25_26": {
                    code: "PROFCAB25",
                    nom: "PROFESSEUR 25-26",
                    eleves: [
                        "MAS",
                        "PEREIRA",
                        "AMAND",
                        "THENEZAY",
                        "HASSLER",
                        "RORTAIS",
                        "RAULT"
                    ]
                },
                "GROUPE_PRO_GOLF_25_26": {
                    code: "GOLFPRO25",
                    nom: "GROUPE PRO GOLF 25-26",
                    eleves: [
                        "BOULET",
                        "RECROSIO",
                        "FRANQUET",
                        "GRIFFAUT"
                    ]
                },
                "GROUPE_GOLF_AMATEUR_25_26": {
                    code: "GOLFAM25",
                    nom: "GROUPE GOLF AMATEUR 25-26",
                    eleves: [
                        "LOPEZ",
                        "LOPEZ",
                        "DOSSOU KOKO",
                        "GODIN"
                    ]
                }
            },

            codeActuel: null,
            
            verifierCode: function(code) {
                for (let classe in this.classes) {
                    if (this.classes[classe].code === code) {
                        this.codeActuel = classe;
                        return true;
                    }
                }
                return false;
            },
            
            verifierUtilisateur: function(nom) {
                if (!this.codeActuel) return false;
                const classe = this.classes[this.codeActuel];
                if (!classe) return false;
                
                // Normaliser le nom pour la comparaison (ignorer casse et espaces)
                const nomNormalise = nom.toLowerCase().trim();
                return classe.eleves.some(eleve => 
                    eleve.toLowerCase().trim().includes(nomNormalise) || 
                    nomNormalise.includes(eleve.toLowerCase().trim())
                );
            },
            
            getNomClasse: function() {
                if (!this.codeActuel) return "Classe";
                return this.classes[this.codeActuel].nom;
            },
            
            validerCode: function() {
                if (this.codeActuel) {
                    localStorage.setItem('code-valide', 'true');
                    localStorage.setItem('classe-active', this.codeActuel);
                }
            },
            
            estDejaConnecte: function() {
                const codeValide = localStorage.getItem('code-valide');
                const classeActive = localStorage.getItem('classe-active');
                if (codeValide === 'true' && classeActive) {
                    this.codeActuel = classeActive;
                    return true;
                }
                return false;
            },
            
            revoquerAcces: function() {
                localStorage.removeItem('code-valide');
                localStorage.removeItem('classe-active');
                this.codeActuel = null;
            }
        };

        // DONNÉES DES COURS - ANATOMIE ET EXERCICES
        const coursData = {
            principes: [
                {
                    titre: "Principe de Surcharge Progressive",
                    contenu: "Pour progresser, il faut augmenter progressivement la charge, le volume ou l'intensité de l'entraînement. Le corps s'adapte aux contraintes qu'on lui impose.",
                    conseils: [
                        "Augmenter la charge de 2-5% quand vous réussissez vos séries",
                        "Ajouter des répétitions ou des séries progressivement",
                        "Varier les exercices pour stimuler différemment les muscles",
                        "Noter vos performances pour suivre votre progression"
                    ]
                },
                {
                    titre: "Principe de Spécificité",
                    contenu: "Les adaptations du corps sont spécifiques au type d'entraînement. Pour développer la force, il faut s'entraîner en force. Pour l'endurance, en endurance.",
                    conseils: [
                        "Adapter le mobile à votre objectif principal",
                        "Rester cohérent avec votre programme sur 8-12 semaines",
                        "Varier les mobiles sur l'année pour un développement complet",
                        "Privilégier les exercices poly-articulaires pour plus d'efficacité"
                    ]
                },
                {
                    titre: "Principe de Récupération",
                    contenu: "La progression se fait pendant la récupération, pas pendant l'entraînement. Un muscle a besoin de 48-72h pour récupérer complètement.",
                    conseils: [
                        "Laisser au moins 48h entre deux séances du même groupe musculaire",
                        "Dormir 7-9h par nuit pour optimiser la récupération",
                        "S'hydrater régulièrement (1.5-2L d'eau par jour)",
                        "Écouter son corps : fatigue excessive = besoin de repos"
                    ]
                }
            ],

            mobiles: [
                {
                    nom: "FORCE MAXIMALE",
                    color: "#fb923c",
                    objectif: "Développer la force maximale et la puissance musculaire",
                    charge: "85-100% du 1RM",
                    repetitions: "1-5 répétitions",
                    series: "4-6 séries",
                    repos: "3-5 minutes",
                    formes: [
                        "Charges libres (barres, haltères)",
                        "Exercices poly-articulaires (squat, développé couché, soulevé de terre)",
                        "Tempo lent et contrôlé",
                        "Travail en pyramide (montante ou descendante)"
                    ]
                },
                {
                    nom: "ÉQUILIBRE / VOLUME",
                    color: "#10b981",
                    objectif: "Développer le volume musculaire (hypertrophie) et la masse",
                    charge: "65-80% du 1RM",
                    repetitions: "6-12 répétitions",
                    series: "3-5 séries",
                    repos: "1-2 minutes",
                    formes: [
                        "Mélange charges libres et machines",
                        "Exercices poly-articulaires ET d'isolation",
                        "Tempo modéré avec temps sous tension",
                        "Superset, drop sets pour intensifier"
                    ]
                },
                {
                    nom: "ENDURANCE MUSCULAIRE",
                    color: "#06b6d4",
                    objectif: "Développer l'endurance et la résistance musculaire",
                    charge: "40-60% du 1RM",
                    repetitions: "15-25+ répétitions",
                    series: "2-4 séries",
                    repos: "30s-1 minute",
                    formes: [
                        "Circuits training",
                        "Poids du corps ou charges légères",
                        "Tempo rapide avec peu de repos",
                        "Exercices fonctionnels et dynamiques"
                    ]
                }
            ],

            typesContraction: [
                {
                    type: "Contraction Concentrique",
                    definition: "Le muscle se raccourcit pendant l'effort (phase positive). C'est la phase de levée de la charge.",
                    exemple: "Monter la barre au développé couché, plier le bras au curl biceps",
                    mobile: "Toutes les formes de travail, accent sur la force et la puissance"
                },
                {
                    type: "Contraction Excentrique",
                    definition: "Le muscle s'allonge sous tension (phase négative). C'est la phase de descente contrôlée de la charge.",
                    exemple: "Descendre la barre au développé couché, descendre en squat",
                    mobile: "Très efficace pour l'hypertrophie, contrôle important pour éviter les blessures"
                },
                {
                    type: "Contraction Isométrique",
                    definition: "Le muscle se contracte sans changement de longueur (maintien statique d'une position).",
                    exemple: "Gainage planche, maintien en position basse du squat, wall sit",
                    mobile: "Endurance musculaire, stabilisation, renforcement des tendons"
                }
            ],

            hygiene: {
                avant: [
                    {
                        titre: "Échauffement (10-15 min)",
                        contenu: "Commencer par un échauffement cardio léger (5 min) puis des mouvements dynamiques spécifiques aux exercices du jour. L'échauffement prépare les muscles, les articulations et le système nerveux à l'effort."
                    },
                    {
                        titre: "Hydratation",
                        contenu: "Boire 300-500ml d'eau 2h avant l'entraînement. Une bonne hydratation améliore les performances et réduit les risques de crampes et de blessures."
                    },
                    {
                        titre: "Alimentation",
                        contenu: "Prendre un repas ou une collation 2-3h avant l'entraînement avec des glucides et des protéines. Éviter les repas trop lourds juste avant l'effort."
                    }
                ],
                pendant: [
                    {
                        titre: "Technique et Respiration",
                        contenu: "Privilégier toujours la bonne technique d'exécution plutôt que la charge. Respirer correctement : expirer pendant l'effort (phase concentrique), inspirer pendant la descente (phase excentrique)."
                    },
                    {
                        titre: "Hydratation Continue",
                        contenu: "Boire régulièrement pendant l'entraînement, surtout si la séance dépasse 45 minutes. Petites gorgées toutes les 15-20 minutes."
                    },
                    {
                        titre: "Écoute du Corps",
                        contenu: "Distinguer la douleur musculaire normale (brûlure) de la douleur articulaire ou tendineuse (signal d'alarme). En cas de douleur anormale, arrêter l'exercice immédiatement."
                    }
                ],
                apres: [
                    {
                        titre: "Retour au Calme",
                        contenu: "Terminer par 5-10 minutes de cardio léger pour faire baisser progressivement le rythme cardiaque et favoriser l'élimination des déchets métaboliques."
                    },
                    {
                        titre: "Étirements",
                        contenu: "Effectuer des étirements doux et maintenus (30 secondes par muscle) pour améliorer la flexibilité et réduire les courbatures. Ne jamais forcer, l'étirement doit être confortable."
                    },
                    {
                        titre: "Nutrition Post-Entraînement",
                        contenu: "Dans les 2h suivant l'entraînement, consommer protéines (20-30g) et glucides pour optimiser la récupération musculaire et reconstituer les réserves d'énergie."
                    },
                    {
                        titre: "Sommeil",
                        contenu: "Le sommeil est crucial pour la récupération. Viser 7-9h de sommeil de qualité. C'est pendant le sommeil profond que le corps répare et construit du muscle."
                    }
                ]
            },

            anatomie: {
                "Pectoraux (Grand Pectoral)": {
                    role: "Muscles de la poitrine responsables de l'adduction (ramener le bras vers le corps), de la flexion (lever le bras devant soi) et de la rotation interne de l'épaule. Essentiels pour les mouvements de poussée.",
                    insertions: [
                        "Origine : Clavicule, sternum et cartilages costaux",
                        "Insertion : Humérus (os du bras)",
                        "Comprend 3 faisceaux : claviculaire (haut), sternal (milieu), abdominal (bas)"
                    ]
                },
                "Grand Dorsal": {
                    role: "Plus grand muscle du dos, responsable de l'extension (tirer le bras vers l'arrière), de l'adduction et de la rotation interne de l'épaule. Donne la forme en 'V' du dos.",
                    insertions: [
                        "Origine : Vertèbres thoraciques basses, vertèbres lombaires, crête iliaque, côtes basses",
                        "Insertion : Humérus (sillon inter-tuberculaire)",
                        "Travaillé lors de tous les mouvements de traction"
                    ]
                },
                "Trapèzes": {
                    role: "Muscle du haut du dos en forme de trapèze. Élève, abaisse et rétracte les omoplates. Crucial pour la posture et la stabilité des épaules.",
                    insertions: [
                        "3 faisceaux : supérieur (élévation), moyen (rétraction), inférieur (abaissement)",
                        "Origine : Base du crâne, vertèbres cervicales et thoraciques",
                        "Insertion : Clavicule, acromion et épine de l'omoplate"
                    ]
                },
                "Deltoïdes": {
                    role: "Muscles de l'épaule qui permettent l'abduction (lever le bras sur le côté), la flexion (avant) et l'extension (arrière) de l'épaule. Donnent la largeur aux épaules.",
                    insertions: [
                        "3 faisceaux : antérieur (devant), moyen/latéral (côté), postérieur (arrière)",
                        "Origine : Clavicule, acromion et épine de l'omoplate",
                        "Insertion : Humérus (tubérosité deltoïdienne)"
                    ]
                },
                "Biceps Brachial": {
                    role: "Muscle à deux chefs de la face antérieure du bras. Flexion de l'avant-bras sur le bras et supination (rotation externe) de l'avant-bras.",
                    insertions: [
                        "2 chefs : long (omoplate) et court (omoplate)",
                        "Insertion : Radius (tubérosité bicipitale)",
                        "Synergiste du brachial antérieur dans la flexion du coude"
                    ]
                },
                "Triceps Brachial": {
                    role: "Muscle à trois chefs de la face postérieure du bras. Extension du coude et (chef long uniquement) adduction et extension de l'épaule.",
                    insertions: [
                        "3 chefs : long (omoplate), latéral et médial (humérus)",
                        "Insertion commune : Olécrane (ulna/cubitus)",
                        "Représente 2/3 du volume du bras"
                    ]
                },
                "Quadriceps": {
                    role: "Groupe de 4 muscles de la face antérieure de la cuisse. Extension du genou et flexion de la hanche (droit fémoral uniquement). Plus puissant muscle du corps.",
                    insertions: [
                        "4 chefs : droit fémoral, vaste latéral, vaste médial, vaste intermédiaire",
                        "Origine : Fémur et bassin (iliaque)",
                        "Insertion commune : Patella (rotule) puis tibia via le tendon patellaire"
                    ]
                },
                "Ischio-jambiers": {
                    role: "Groupe de 3 muscles de la face postérieure de la cuisse. Flexion du genou et extension de la hanche. Antagonistes des quadriceps.",
                    insertions: [
                        "3 muscles : biceps fémoral, semi-tendineux, semi-membraneux",
                        "Origine : Ischion (os du bassin)",
                        "Insertion : Tibia et fibula (péroné)"
                    ]
                },
                "Fessiers": {
                    role: "Groupe de 3 muscles qui forment les fesses. Extension, abduction et rotation de la hanche. Le grand fessier est le muscle le plus puissant du corps.",
                    insertions: [
                        "Grand fessier (volume), moyen fessier (stabilité), petit fessier (rotation)",
                        "Origine : Iliaque, sacrum, coccyx",
                        "Insertion : Fémur et tractus ilio-tibial"
                    ]
                }
            },

            exercicesPectoraux: [
                {
                    nom: "Développé Couché",
                    description: "Exercice roi pour les pectoraux. Allongé sur un banc, descendre la barre jusqu'à la poitrine puis la pousser vers le haut.",
                    technique: [
                        "Plaquer les omoplates et cambrer légèrement le dos",
                        "Descendre la barre au niveau des tétons",
                        "Coudes à 45° du corps (ni trop écartés ni collés)",
                        "Pieds bien ancrés au sol"
                    ],
                    variantes: ["Développé incliné (haut des pectoraux)", "Développé décliné (bas des pectoraux)", "Développé avec haltères"]
                },
                {
                    nom: "Pompes",
                    description: "Exercice au poids du corps. En position de planche, descendre le corps vers le sol en fléchissant les bras puis remonter.",
                    technique: [
                        "Corps aligné (gainage)",
                        "Mains largeur épaules ou légèrement plus large",
                        "Descendre jusqu'à ce que la poitrine touche presque le sol",
                        "Coudes près du corps ou à 45°"
                    ],
                    variantes: ["Pompes inclinées (plus facile)", "Pompes déclinées (plus difficile)", "Pompes diamant (triceps)"]
                },
                {
                    nom: "Écarté avec Haltères",
                    description: "Allongé sur un banc, bras écartés, descendre les haltères sur les côtés en contrôlant puis ramener devant soi.",
                    technique: [
                        "Légère flexion des coudes maintenue",
                        "Descendre jusqu'à sentir l'étirement des pectoraux",
                        "Ne pas descendre plus bas que le niveau du banc",
                        "Mouvement d'arc de cercle"
                    ],
                    variantes: ["Écarté incliné", "Écarté à la poulie", "Pec deck machine"]
                }
            ],

            exercicesDos: [
                {
                    nom: "Traction (Pull-up)",
                    description: "Suspendu à une barre, se hisser jusqu'à ce que le menton dépasse la barre en tirant avec le dos.",
                    technique: [
                        "Prise large pour cibler le grand dorsal",
                        "Tirer les coudes vers le bas et l'arrière",
                        "Rentrer la poitrine vers la barre",
                        "Contrôler la descente"
                    ],
                    variantes: ["Traction pronation (difficile)", "Traction supination (plus facile)", "Traction assistée (élastique ou machine)"]
                },
                {
                    nom: "Rowing Barre",
                    description: "Penché en avant, buste parallèle au sol, tirer la barre vers le bas du ventre en contractant les dorsaux.",
                    technique: [
                        "Dos droit, regard devant",
                        "Tirer vers le nombril/bas des abdos",
                        "Coudes le long du corps",
                        "Contracter les omoplates en fin de mouvement"
                    ],
                    variantes: ["Rowing Yates (plus droit)", "Rowing haltères", "Rowing T-barre"]
                },
                {
                    nom: "Tirage Vertical",
                    description: "Assis à la machine, tirer la barre vers le haut de la poitrine en contractant le dos.",
                    technique: [
                        "Se pencher légèrement en arrière (20-30°)",
                        "Tirer vers le haut des pectoraux",
                        "Contracter les omoplates",
                        "Ne pas tirer derrière la nuque (risque épaules)"
                    ],
                    variantes: ["Prise large", "Prise serrée", "Prise neutre"]
                }
            ],

            exercicesEpaules: [
                {
                    nom: "Développé Militaire",
                    description: "Debout ou assis, pousser la barre du haut de la poitrine vers le haut au-dessus de la tête.",
                    technique: [
                        "Gainage abdominal fort",
                        "Coudes légèrement devant la barre",
                        "Pousser la tête légèrement en avant en fin de mouvement",
                        "Ne pas cambrer excessivement le dos"
                    ],
                    variantes: ["Développé haltères", "Développé Arnold", "Développé nuque (attention épaules)"]
                },
                {
                    nom: "Élévations Latérales",
                    description: "Bras le long du corps, lever les haltères sur les côtés jusqu'à hauteur des épaules.",
                    technique: [
                        "Coudes légèrement fléchis",
                        "Lever jusqu'à hauteur des épaules (pas plus)",
                        "Contrôler la descente",
                        "Imaginer verser un verre d'eau (rotation légère)"
                    ],
                    variantes: ["Élévations à la poulie", "Élévations assis", "Élévations un bras"]
                }
            ],

            exercicesBras: [
                {
                    nom: "Curl Barre",
                    description: "Debout, barre en main, fléchir les coudes pour monter la barre vers les épaules.",
                    technique: [
                        "Coudes fixes le long du corps",
                        "Ne pas balancer le dos",
                        "Contracter le biceps en haut",
                        "Descente contrôlée"
                    ],
                    variantes: ["Curl haltères", "Curl marteau", "Curl pupitre"]
                },
                {
                    nom: "Dips",
                    description: "Entre deux barres parallèles, descendre en fléchissant les coudes puis remonter.",
                    technique: [
                        "Penché en avant = pectoraux, droit = triceps",
                        "Descendre jusqu'à 90° minimum",
                        "Coudes près du corps pour les triceps",
                        "Contrôler la descente"
                    ],
                    variantes: ["Dips lestés", "Dips assistés", "Dips sur banc"]
                }
            ],

            exercicesJambes: [
                {
                    nom: "Squat",
                    description: "Exercice roi du bas du corps. Descendre en fléchissant hanches et genoux comme pour s'asseoir.",
                    technique: [
                        "Pieds largeur épaules, pointes légèrement ouvertes",
                        "Descendre en poussant les fesses en arrière",
                        "Genoux dans l'axe des pieds",
                        "Dos droit, regard devant"
                    ],
                    variantes: ["Front squat", "Squat bulgare", "Goblet squat"]
                },
                {
                    nom: "Soulevé de Terre",
                    description: "Debout, saisir la barre au sol et se redresser en poussant sur les jambes et en tendant le dos.",
                    technique: [
                        "Dos droit tout le long du mouvement",
                        "Pousser sur les talons",
                        "Hanches et épaules montent en même temps",
                        "Barre le long des jambes"
                    ],
                    variantes: ["Soulevé de terre roumain (ischio)", "Soulevé de terre sumo", "Trap bar deadlift"]
                }
            ],

            exercicesAbdos: [
                {
                    nom: "Planche (Gainage)",
                    description: "En appui sur les avant-bras et les pieds, maintenir le corps aligné et rigide.",
                    technique: [
                        "Corps parfaitement aligné (pas de fesses en l'air)",
                        "Contracter abdos et fessiers",
                        "Respirer normalement",
                        "Regard vers le sol"
                    ],
                    variantes: ["Planche latérale", "Planche dynamique", "Planche avec levée de bras/jambe"]
                },
                {
                    nom: "Crunch",
                    description: "Allongé sur le dos, genoux fléchis, décoller les épaules du sol en contractant les abdominaux.",
                    technique: [
                        "Mains derrière la tête (ne pas tirer)",
                        "Décoller seulement le haut du dos",
                        "Expirer en montant",
                        "Contracter les abdos, pas tirer sur le cou"
                    ],
                    variantes: ["Crunch obliques", "Crunch à la poulie", "Bicycle crunch"]
                }
            ]
        };

        class LivretApp {
            constructor() {
                this.currentUser = null;
                this.currentView = securite.estDejaConnecte() ? 'login' : 'code-access';
                this.currentTab = 'dashboard';
                this.sessions = [];
                this.rmHistory = [];
                this.currentSession = null;
                this.userAvatar = null;
                this.musclesList = ['Pectoraux', 'Grand dorsal', 'Trapèzes', 'Deltoïdes', 'Biceps', 'Triceps', 'Abdominaux', 'Quadriceps', 'Ischio-jambiers', 'Fessiers', 'Mollets'];
                this.currentCoursTab = 'principes';
                this.exercicesTemp = [];
                this.musclesTemp = [];
                this.timerMode = 'repos';
                this.timerSeconds = 60;
                this.timerRunning = false;
                this.timerInterval = null;
                this.chronoSeconds = 0;
                this.chronoRunning = false;
                this.chronoInterval = null;
                this.chronoLaps = [];
                this.sessionHistory = [];
                this.isOnline = navigator.onLine;
                this.searchQuery = '';
                this.activeFilters = [];
                this.calculatedCharges = {};
                this.currentTheme = 'cyan';
                this.progressPhotos = { before: null, after: null };
                this.badges = [];
                this.goals = [];
                this.init();
                this.initOfflineMode();
            }

            init() {
                this.loadSessions();
                this.loadRMHistory();
                this.loadUserAvatar();
                this.loadSessionHistory();
                this.loadCalculatedCharges();
                this.loadTheme();
                this.loadProgressPhotos();
                this.loadBadges();
                this.loadGoals();
                this.checkBadges();
                this.render();
            }

            initOfflineMode() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.updateOfflineBanner();
                });

                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.updateOfflineBanner();
                });

                this.updateOfflineBanner();
            }

            updateOfflineBanner() {
                const banner = document.getElementById('offline-banner');
                if (!this.isOnline) {
                    banner.innerHTML = '<span class="offline-indicator"></span>Mode hors-ligne - Les données sont sauvegardées localement';
                    banner.classList.remove('hidden');
                } else {
                    banner.classList.add('hidden');
                }
            }

            loadSessions() {
                if (!this.currentUser) return;
                const result = storage.get('sessions');
                if (result.exists) {
                    this.sessions = JSON.parse(result.value);
                }
            }

            saveSessions() {
                storage.save('sessions', this.sessions);
            }

            loadRMHistory() {
                if (!this.currentUser) return;
                const result = storage.get('rmHistory');
                if (result.exists) {
                    this.rmHistory = JSON.parse(result.value);
                }
            }

            saveRMHistory() {
                storage.save('rmHistory', this.rmHistory);
            }

            loadUserAvatar() {
                if (!this.currentUser) return;
                const result = storage.get('avatar');
                if (result.exists) {
                    this.userAvatar = JSON.parse(result.value);
                }
            }

            saveUserAvatar() {
                storage.save('avatar', this.userAvatar);
            }

            loadSessionHistory() {
                if (!this.currentUser) return;
                const result = storage.get('sessionHistory');
                if (result.exists) {
                    this.sessionHistory = JSON.parse(result.value);
                }
            }

            saveSessionHistory() {
                storage.save('sessionHistory', this.sessionHistory);
            }

            loadCalculatedCharges() {
                if (!this.currentUser) return;
                const result = storage.get('calculatedCharges');
                if (result.exists) {
                    this.calculatedCharges = JSON.parse(result.value);
                }
            }

            saveCalculatedCharges() {
                storage.save('calculatedCharges', this.calculatedCharges);
            }

            loadTheme() {
                if (!this.currentUser) return;
                const result = storage.get('theme');
                if (result.exists) {
                    this.currentTheme = result.value;
                    this.applyTheme(this.currentTheme);
                }
            }

            saveTheme() {
                storage.save('theme', this.currentTheme);
            }

            applyTheme(theme) {
                document.body.className = '';
                if (theme !== 'cyan') {
                    document.body.classList.add(`theme-${theme}`);
                }
            }

            loadProgressPhotos() {
                if (!this.currentUser) return;
                const result = storage.get('progressPhotos');
                if (result.exists) {
                    this.progressPhotos = JSON.parse(result.value);
                }
            }

            saveProgressPhotos() {
                storage.save('progressPhotos', this.progressPhotos);
            }

            loadBadges() {
                if (!this.currentUser) return;
                const result = storage.get('badges');
                if (result.exists) {
                    this.badges = JSON.parse(result.value);
                } else {
                    this.badges = this.initializeBadges();
                    this.saveBadges();
                }
            }

            saveBadges() {
                storage.save('badges', this.badges);
            }

            loadGoals() {
                if (!this.currentUser) return;
                const result = storage.get('goals');
                if (result.exists) {
                    this.goals = JSON.parse(result.value);
                }
            }

            saveGoals() {
                storage.save('goals', this.goals);
            }

            initializeBadges() {
                return [
                    { id: 'first-session', name: 'Première Séance', icon: '🎯', description: 'Créer votre première séance', unlocked: false },
                    { id: 'first-rm', name: 'Premier Test', icon: '💪', description: 'Calculer votre premier 1RM', unlocked: false },
                    { id: 'sessions-5', name: 'Débutant', icon: '🔥', description: 'Effectuer 5 séances', unlocked: false },
                    { id: 'sessions-10', name: 'Régulier', icon: '⚡', description: 'Effectuer 10 séances', unlocked: false },
                    { id: 'sessions-25', name: 'Assidu', icon: '💎', description: 'Effectuer 25 séances', unlocked: false },
                    { id: 'sessions-50', name: 'Expert', icon: '👑', description: 'Effectuer 50 séances', unlocked: false },
                    { id: 'progress-photo', name: 'Transformation', icon: '📸', description: 'Ajouter des photos avant/après', unlocked: false },
                    { id: 'rm-5', name: 'Testeur', icon: '🎪', description: 'Effectuer 5 tests 1RM', unlocked: false },
                    { id: 'weekly-streak', name: 'Hebdomadaire', icon: '📅', description: 'Séances 7 jours consécutifs', unlocked: false },
                    { id: 'all-mobiles', name: 'Polyvalent', icon: '🌟', description: 'Tester les 3 mobiles', unlocked: false }
                ];
            }

            checkBadges() {
                const completedCount = this.sessionHistory.filter(h => h.completed).length;
                const rmCount = this.rmHistory.length;
                const hasPhotos = this.progressPhotos.before && this.progressPhotos.after;
                const hasAllMobiles = this.sessions.some(s => s.type === 'Force') && 
                                     this.sessions.some(s => s.type === 'Équilibre') && 
                                     this.sessions.some(s => s.type === 'Endurance');

                const badgeChecks = [
                    { id: 'first-session', condition: this.sessions.length >= 1 },
                    { id: 'first-rm', condition: rmCount >= 1 },
                    { id: 'sessions-5', condition: completedCount >= 5 },
                    { id: 'sessions-10', condition: completedCount >= 10 },
                    { id: 'sessions-25', condition: completedCount >= 25 },
                    { id: 'sessions-50', condition: completedCount >= 50 },
                    { id: 'progress-photo', condition: hasPhotos },
                    { id: 'rm-5', condition: rmCount >= 5 },
                    { id: 'all-mobiles', condition: hasAllMobiles }
                ];

                let newBadgesUnlocked = false;
                badgeChecks.forEach(check => {
                    const badge = this.badges.find(b => b.id === check.id);
                    if (badge && !badge.unlocked && check.condition) {
                        badge.unlocked = true;
                        badge.unlockedAt = new Date().toISOString();
                        newBadgesUnlocked = true;
                    }
                });

                if (newBadgesUnlocked) {
                    this.saveBadges();
                }
            }

            render() {
                const app = document.getElementById('app');
                
                if (this.currentView === 'code-access') {
                    app.innerHTML = this.renderCodeAccess();
                    this.attachCodeAccessEvents();
                } else if (this.currentView === 'login') {
                    app.innerHTML = this.renderLogin();
                    this.attachLoginEvents();
                } else if (this.currentView === 'signup') {
                    app.innerHTML = this.renderSignup();
                    this.attachSignupEvents();
                } else if (this.currentView === 'dashboard') {
                    app.innerHTML = this.renderDashboard();
                    this.attachDashboardEvents();
                } else if (this.currentView === 'session-form') {
                    app.innerHTML = this.renderSessionForm();
                    this.attachSessionFormEvents();
                } else if (this.currentView === 'session-detail') {
                    app.innerHTML = this.renderSessionDetail();
                    this.attachSessionDetailEvents();
                }
            }

            renderCodeAccess() {
                return `
                    <div class="container">
                        <div class="card" style="max-width: 500px; margin: 4rem auto;">
                            <div class="text-center mb-4">
                                <div class="user-icon" style="margin: 0 auto 1.5rem;">🔒</div>
                                <h1 class="text-white" style="font-size: 2rem; margin-bottom: 0.5rem;">Accès Protégé</h1>
                                <p class="text-cyan">Entrez le code d'accès de votre classe</p>
                            </div>
                            
                            <form id="code-form">
                                <div class="mb-4">
                                    <label class="text-white mb-1" style="display: block;">Code de classe</label>
                                    <input type="password" class="input" id="code-input" placeholder="Ex: 1CAP-2025" required autofocus>
                                </div>
                                
                                <button type="submit" class="btn btn-primary" style="width: 100%;">Valider</button>
                            </form>

                            <div id="code-error" class="hidden" style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 0.75rem;">
                                <p class="text-white" style="text-align: center;">❌ Code incorrect</p>
                            </div>
                            
                            <div class="tip-box" style="margin-top: 2rem;">
                                <div class="text-white" style="font-weight: 600; margin-bottom: 0.5rem;">💡 Code oublié ?</div>
                                <p class="text-white" style="opacity: 0.8; font-size: 0.9rem;">Demandez le code de votre classe à votre professeur.</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderLogin() {
                const users = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('user-') && !key.includes('-sessions') && !key.includes('-rmHistory') && !key.includes('-avatar') && !key.includes('-sessionHistory') && !key.includes('-calculatedCharges') && !key.includes('-theme') && !key.includes('-progressPhotos') && !key.includes('-badges') && !key.includes('-goals')) {
                        const username = key.replace('user-', '');
                        users.push(username);
                    }
                }

                return `
                    <div class="container">
                        <div class="card" style="max-width: 450px; margin: 4rem auto;">
                            <div class="text-center mb-4">
                                <div class="user-icon" style="margin: 0 auto 1.5rem;">💪</div>
                                <h1 class="text-white" style="font-size: 2rem; margin-bottom: 0.5rem;">Livret de Musculation</h1>
                                <p class="text-cyan">Suivi personnalisé - ${securite.getNomClasse()}</p>
                            </div>
                            
                            ${users.length > 0 ? `
                                <div class="mb-4">
                                    <label class="text-white mb-1" style="display: block;">Sélectionner un profil</label>
                                    <select class="input" id="select-user">
                                        <option value="">-- Choisir un profil --</option>
                                        ${users.map(u => `<option value="${u}">${u}</option>`).join('')}
                                    </select>
                                </div>
                                <button class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;" onclick="app.handleSelectUser()">Se connecter</button>
                                <div class="text-center">
                                    <button class="btn btn-link" onclick="app.showSignup()">Créer un nouveau profil</button>
                                </div>
                            ` : `
                                <div class="text-center">
                                    <p class="text-white mb-4" style="opacity: 0.8;">Aucun profil existant</p>
                                    <button class="btn btn-success" style="width: 100%;" onclick="app.showSignup()">Créer mon profil</button>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            }

            renderSignup() {
                return `
                    <div class="container">
                        <div class="card" style="max-width: 500px; margin: 2rem auto;">
                            <div class="text-center mb-4">
                                <h1 class="text-white" style="font-size: 2rem; margin-bottom: 0.5rem;">Créer mon profil</h1>
                                <p class="text-cyan">Renseignez vos informations - ${securite.getNomClasse()}</p>
                            </div>
                            
                            <form id="signup-form">
                                <div class="text-center mb-4">
                                    <input type="file" id="avatar-input" accept="image/*" style="display: none;">
                                    <div class="avatar-upload" onclick="document.getElementById('avatar-input').click()">
                                        <span id="avatar-preview">📷</span>
                                    </div>
                                    <p class="text-white" style="opacity: 0.7; font-size: 0.9rem;">Cliquez pour ajouter une photo</p>
                                </div>

                                <div class="mb-2">
                                    <label class="text-white mb-1" style="display: block;">Prénom</label>
                                    <input type="text" class="input" id="signup-username" placeholder="Votre prénom" required>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3 mb-2">
                                    <div>
                                        <label class="text-white mb-1" style="display: block;">Âge</label>
                                        <input type="number" class="input" id="signup-age" placeholder="Ex: 25" min="10" max="100" required>
                                    </div>
                                    <div>
                                        <label class="text-white mb-1" style="display: block;">Sexe</label>
                                        <select class="input" id="signup-sexe" required>
                                            <option value="">Choisir...</option>
                                            <option value="Homme">Homme</option>
                                            <option value="Femme">Femme</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-3 mb-4">
                                    <div>
                                        <label class="text-white mb-1" style="display: block;">Taille (cm)</label>
                                        <input type="number" class="input" id="signup-taille" placeholder="Ex: 175" min="100" max="250" required>
                                    </div>
                                    <div>
                                        <label class="text-white mb-1" style="display: block;">Poids (kg)</label>
                                        <input type="number" class="input" id="signup-poids" placeholder="Ex: 70" min="30" max="200" step="0.1" required>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-success" style="width: 100%; margin-bottom: 1rem;">Créer mon profil</button>
                                
                                <div class="text-center">
                                    <button type="button" class="btn btn-link" onclick="app.showLogin()">Retour</button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
            }

            renderDashboard() {
                const userKey = `user-${this.currentUser}`;
                const userResult = storage.get(userKey, true);
                const userData = userResult.exists ? JSON.parse(userResult.value) : {};

                const completedSessions = this.sessionHistory.filter(h => h.completed).length;
                const thisMonth = new Date().getMonth();
                const thisYear = new Date().getFullYear();
                const sessionsThisMonth = this.sessionHistory.filter(h => {
                    const date = new Date(h.completedAt);
                    return h.completed && date.getMonth() === thisMonth && date.getFullYear() === thisYear;
                }).length;

                const unlockedBadges = this.badges.filter(b => b.unlocked).length;

                return `
                    <div class="container">
                        <div class="card">
                            <div class="flex justify-between items-center mb-4">
                                <div class="flex items-center gap-3">
                                    ${this.userAvatar ? 
                                        `<img src="${this.userAvatar}" class="profile-avatar" alt="Avatar">` : 
                                        `<div class="default-avatar">👤</div>`
                                    }
                                    <div>
                                        <h1 class="text-white" style="font-size: 2rem;">${this.currentUser}</h1>
                                        <p class="text-cyan" style="font-size: 0.9rem;">${userData.age} ans • ${userData.sexe} • ${userData.taille}cm • ${userData.poids}kg</p>
                                        <p class="text-white" style="opacity: 0.7; font-size: 0.85rem; margin-top: 0.25rem;">📚 Classe : ${securite.getNomClasse()} • 🏆 ${unlockedBadges}/${this.badges.length} badges</p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button class="btn btn-warning" onclick="app.exportData()">💾 Exporter</button>
                                    <button class="btn btn-warning" onclick="app.importData()">📥 Importer</button>
                                    <button class="btn btn-secondary" onclick="app.logout()">Déconnexion</button>
                                </div>
                            </div>

                            <div class="flex gap-2 mb-4" style="overflow-x: auto;">
                                <button class="tab-btn ${this.currentTab === 'dashboard' ? 'active' : ''}" onclick="app.switchTab('dashboard')">📊 Dashboard</button>
                                <button class="tab-btn ${this.currentTab === 'profil' ? 'active' : ''}" onclick="app.switchTab('profil')">👤 Mon Profil</button>
                                <button class="tab-btn ${this.currentTab === 'rm' ? 'active' : ''}" onclick="app.switchTab('rm')">🎯 Calculateur 1RM</button>
                                <button class="tab-btn ${this.currentTab === 'charges' ? 'active' : ''}" onclick="app.switchTab('charges')">⚖️ Charges</button>
                                <button class="tab-btn ${this.currentTab === 'progression' ? 'active' : ''}" onclick="app.switchTab('progression')">📊 Progression</button>
                                <button class="tab-btn ${this.currentTab === 'sessions' ? 'active' : ''}" onclick="app.switchTab('sessions')">📝 Mes Séances</button>
                                <button class="tab-btn ${this.currentTab === 'timer' ? 'active' : ''}" onclick="app.switchTab('timer')">⏱️ Timer</button>
                                <button class="tab-btn ${this.currentTab === 'historique' ? 'active' : ''}" onclick="app.switchTab('historique')">📅 Historique</button>
                                <button class="tab-btn ${this.currentTab === 'photos' ? 'active' : ''}" onclick="app.switchTab('photos')">📸 Photos</button>
                                <button class="tab-btn ${this.currentTab === 'badges' ? 'active' : ''}" onclick="app.switchTab('badges')">🏆 Badges</button>
                                <button class="tab-btn ${this.currentTab === 'cours' ? 'active' : ''}" onclick="app.switchTab('cours')">📚 Cours</button>
                            </div>

                            ${this.currentTab === 'dashboard' ? this.renderDashboardTab(completedSessions, sessionsThisMonth) : ''}
                            ${this.currentTab === 'profil' ? this.renderProfilTab() : ''}
                            ${this.currentTab === 'rm' ? this.renderRMTab() : ''}
                            ${this.currentTab === 'charges' ? this.renderChargesTab() : ''}
                            ${this.currentTab === 'progression' ? this.renderProgressionTab() : ''}
                            ${this.currentTab === 'sessions' ? this.renderSessionsTab() : ''}
                            ${this.currentTab === 'timer' ? this.renderTimerTab() : ''}
                            ${this.currentTab === 'historique' ? this.renderHistoriqueTab() : ''}
                            ${this.currentTab === 'photos' ? this.renderPhotosTab() : ''}
                            ${this.currentTab === 'badges' ? this.renderBadgesTab() : ''}
                            ${this.currentTab === 'cours' ? this.renderCoursTab() : ''}
                        </div>
                    </div>
                `;
            }

            renderDashboardTab(completedSessions, sessionsThisMonth) {
                const stats = {
                    total: this.sessions.length,
                    force: this.sessions.filter(s => s.type === 'Force').length,
                    endurance: this.sessions.filter(s => s.type === 'Endurance').length,
                    equilibre: this.sessions.filter(s => s.type === 'Équilibre').length
                };

                const unlockedBadges = this.badges.filter(b => b.unlocked).length;
                const recentBadges = this.badges
                    .filter(b => b.unlocked)
                    .sort((a, b) => new Date(b.unlockedAt) - new Date(a.unlockedAt))
                    .slice(0, 3);

                return `
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div style="background: linear-gradient(135deg, rgba(6, 182, 212, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%); border-radius: 1rem; padding: 1.5rem; border: 1px solid rgba(6, 182, 212, 0.3);">
                            <div class="text-cyan" style="font-size: 2.5rem; font-weight: bold;">${stats.total}</div>
                            <div class="text-white" style="opacity: 0.9;">Séances créées</div>
                        </div>
                        <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(20, 184, 166, 0.2) 100%); border-radius: 1rem; padding: 1.5rem; border: 1px solid rgba(16, 185, 129, 0.3);">
                            <div style="color: #10b981; font-size: 2.5rem; font-weight: bold;">${completedSessions}</div>
                            <div class="text-white" style="opacity: 0.9;">Séances effectuées</div>
                        </div>
                        <div style="background: linear-gradient(135deg, rgba(249, 115, 22, 0.2) 0%, rgba(251, 146, 60, 0.2) 100%); border-radius: 1rem; padding: 1.5rem; border: 1px solid rgba(249, 115, 22, 0.3);">
                            <div style="color: #fb923c; font-size: 2.5rem; font-weight: bold;">${sessionsThisMonth}</div>
                            <div class="text-white" style="opacity: 0.9;">Ce mois-ci</div>
                        </div>
                        <div style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(147, 51, 234, 0.2) 100%); border-radius: 1rem; padding: 1.5rem; border: 1px solid rgba(168, 85, 247, 0.3);">
                            <div style="color: #a855f7; font-size: 2.5rem; font-weight: bold;">${unlockedBadges}</div>
                            <div class="text-white" style="opacity: 0.9;">Badges débloqués</div>
                        </div>
                    </div>

                    ${recentBadges.length > 0 ? `
                        <div class="tip-box" style="border-color: #a855f7; background: rgba(168, 85, 247, 0.1);">
                            <div class="text-white" style="font-weight: 600; margin-bottom: 0.75rem;">🏆 Derniers badges débloqués</div>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                ${recentBadges.map(badge => `
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="font-size: 2rem;">${badge.icon}</span>
                                        <div>
                                            <div class="text-white" style="font-weight: 600;">${badge.name}</div>
                                            <div class="text-white" style="opacity: 0.7; font-size: 0.85rem;">${badge.description}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <div class="tip-box">
                        <div class="text-white" style="font-weight: 600; margin-bottom: 0.5rem;">💡 Conseil du jour</div>
                        <div class="text-white" style="opacity: 0.9;">N'oubliez pas de bien vous échauffer avant chaque séance et de vous étirer après. La récupération est aussi importante que l'entraînement !</div>
                    </div>
                `;
            }

            renderProfilTab() {
                const userKey = `user-${this.currentUser}`;
                const userResult = storage.get(userKey, true);
                const userData = userResult.exists ? JSON.parse(userResult.value) : {};

                return `
                    <div>
                        <h2 class="text-white mb-4" style="font-size: 1.5rem;">👤 Mon Profil</h2>
                        
                        <div class="mb-4">
                            <h3 class="text-white mb-3" style="font-size: 1.2rem;">🎨 Thème de couleur</h3>
                            <div class="theme-selector">
                                <button class="theme-btn theme-cyan ${this.currentTheme === 'cyan' ? 'active' : ''}" onclick="app.changeTheme('cyan')" title="Cyan (défaut)"></button>
                                <button class="theme-btn theme-blue ${this.currentTheme === 'blue' ? 'active' : ''}" onclick="app.changeTheme('blue')" title="Bleu"></button>
                                <button class="theme-btn theme-green ${this.currentTheme === 'green' ? 'active' : ''}" onclick="app.changeTheme('green')" title="Vert"></button>
                                <button class="theme-btn theme-purple ${this.currentTheme === 'purple' ? 'active' : ''}" onclick="app.changeTheme('purple')" title="Violet"></button>
                                <button class="theme-btn theme-orange ${this.currentTheme === 'orange' ? 'active' : ''}" onclick="app.changeTheme('orange')" title="Orange"></button>
                            </div>
                        </div>

                        <form id="profile-form">
                            <div class="text-center mb-4">
                                <input type="file" id="profile-avatar-input" accept="image/*" style="display: none;">
                                <div class="avatar-upload" onclick="document.getElementById('profile-avatar-input').click()">
                                    ${this.userAvatar ? 
                                        `<img src="${this.userAvatar}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">` : 
                                        `<span>📷</span>`
                                    }
                                </div>
                                <p class="text-white" style="opacity: 0.7; font-size: 0.9rem;">Cliquez pour changer la photo</p>
                            </div>

                            <div class="mb-2">
                                <label class="text-white mb-1" style="display: block;">Prénom</label>
                                <input type="text" class="input" id="profile-username" value="${this.currentUser}" readonly style="opacity: 0.6; cursor: not-allowed;">
                                <p class="text-white" style="opacity: 0.5; font-size: 0.8rem; margin-top: 0.25rem;">Le prénom ne peut pas être modifié</p>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3 mb-2">
                                <div>
                                    <label class="text-white mb-1" style="display: block;">Âge</label>
                                    <input type="number" class="input" id="profile-age" value="${userData.age}" min="10" max="100" required>
                                </div>
                                <div>
                                    <label class="text-white mb-1" style="display: block;">Sexe</label>
                                    <select class="input" id="profile-sexe" required>
                                        <option value="Homme" ${userData.sexe === 'Homme' ? 'selected' : ''}>Homme</option>
                                        <option value="Femme" ${userData.sexe === 'Femme' ? 'selected' : ''}>Femme</option>
                                    </select>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div>
                                    <label class="text-white mb-1" style="display: block;">Taille (cm)</label>
                                    <input type="number" class="input" id="profile-taille" value="${userData.taille}" min="100" max="250" required>
                                </div>
                                <div>
                                    <label class="text-white mb-1" style="display: block;">Poids (kg)</label>
                                    <input type="number" class="input" id="profile-poids" value="${userData.poids}" min="30" max="200" step="0.1" required>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-success" style="width: 100%;">💾 Enregistrer les modifications</button>
                        </form>
                    </div>
                `;
            }

            changeTheme(theme) {
                this.currentTheme = theme;
                this.applyTheme(theme);
                this.saveTheme();
                this.render();
            }renderRMTab() {
                return `
                    <div>
                        <h2 class="text-white mb-4" style="font-size: 1.5rem;">🎯 Calculateur de 1RM (Charge Maximale)</h2>
                        
                        <div class="tip-box mb-4">
                            <div class="text-white" style="font-weight: 600; margin-bottom: 0.5rem;">💡 Qu'est-ce que le 1RM ?</div>
                            <div class="text-white" style="opacity: 0.9; font-size: 0.95rem;">Le 1RM (Répétition Maximale) représente la charge maximale que vous pouvez soulever pour 1 seule répétition. Ce test permet de déterminer vos charges de travail selon votre objectif (Force, Équilibre, Endurance).</div>
                        </div>

                        <form id="rm-form" class="mb-4">
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <div>
                                    <label class="text-white mb-1" style="display: block;">Groupe musculaire</label>
                                    <select class="input" id="rm-muscle" required>
                                        <option value="">Choisir...</option>
                                        ${this.musclesList.map(m => `<option value="${m}">${m}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="text-white mb-1" style="display: block;">Exercice</label>
                                    <input type="text" class="input" id="rm-exercise" placeholder="Ex: Développé couché" required>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <div>
                                    <label class="text-white mb-1" style="display: block;">Charge soulevée (kg)</label>
                                    <input type="number" class="input" id="rm-weight" placeholder="Ex: 60" min="1" step="0.5" required>
                                </div>
                                <div>
                                    <label class="text-white mb-1" style="display: block;">Nombre de répétitions</label>
                                    <input type="number" class="input" id="rm-reps" placeholder="Ex: 8" min="1" max="15" required>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="text-white mb-1" style="display: block;">Date du test</label>
                                <input type="date" class="input" id="rm-date" required>
                            </div>

                            <button type="submit" class="btn btn-primary" style="width: 100%;">🧮 Calculer mon 1RM</button>
                        </form>

                        <div id="rm-result" class="hidden mb-4"></div>

                        ${this.rmHistory.length > 0 ? `
                            <h3 class="text-white mb-3" style="font-size: 1.2rem;">📊 Historique de mes tests (${this.rmHistory.length})</h3>
                            ${this.rmHistory.slice().reverse().map((test, index) => {
                                const actualIndex = this.rmHistory.length - 1 - index;
                                return `
                                    <div class="rm-history-card">
                                        <div class="flex justify-between items-center mb-2">
                                            <div>
                                                <div class="text-white" style="font-weight: 600; font-size: 1.1rem;">${test.exercise}</div>
                                                <div class="text-cyan" style="font-size: 0.9rem;">${test.muscle}</div>
                                            </div>
                                            <div class="text-right">
                                                <div style="color: #10b981; font-size: 1.5rem; font-weight: bold;">${test.rm} kg</div>
                                                <div class="text-white" style="opacity: 0.7; font-size: 0.85rem;">1RM estimé</div>
                                            </div>
                                        </div>
                                        <div class="text-white" style="opacity: 0.7; font-size: 0.9rem; margin-bottom: 0.75rem;">
                                            📅 ${new Date(test.date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' })} • 
                                            💪 ${test.weight}kg × ${test.reps} rép.
                                        </div>
                                        <div class="flex gap-2">
                                            <button class="btn btn-secondary" style="flex: 1;" onclick="app.editRM(${actualIndex})">✏️ Modifier</button>
                                            <button class="btn btn-danger" style="flex: 1;" onclick="app.deleteRM(${actualIndex})">🗑️ Supprimer</button>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        ` : `
                            <div class="text-center" style="padding: 3rem 1rem; opacity: 0.7;">
                                <div style="font-size: 4rem; margin-bottom: 1rem;">🎯</div>
                                <div class="text-white">Aucun test 1RM enregistré pour le moment</div>
                            </div>
                        `}
                    </div>
                `;
            }

            renderChargesTab() {
                return `
                    <div>
                        <h2 class="text-white mb-4" style="font-size: 1.5rem;">⚖️ Calculateur de Charges par Mobile</h2>
                        
                        <div class="tip-box mb-4">
                            <div class="text-white" style="font-weight: 600; margin-bottom: 0.5rem;">💡 Comment ça marche ?</div>
                            <div class="text-white" style="opacity: 0.9; font-size: 0.95rem;">
                                Entrez votre 1RM pour un exercice et l'application calculera automatiquement les charges à utiliser selon votre objectif :
                                <br>• <strong>Force</strong> : 85-100% du 1RM (1-5 répétitions)
                                <br>• <strong>Équilibre/Volume</strong> : 65-80% du 1RM (6-12 répétitions)
                                <br>• <strong>Endurance</strong> : 40-60% du 1RM (15-25+ répétitions)
                            </div>
                        </div>

                        <div class="charges-calculator">
                            <h3 class="text-white mb-3" style="font-size: 1.2rem;">📊 Calculer mes charges de travail</h3>
                            
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <div>
                                    <label class="text-white mb-1" style="display: block;">Exercice</label>
                                    <input type="text" class="input" id="charges-exercise" placeholder="Ex: Développé couché">
                                </div>
                                <div>
                                    <label class="text-white mb-1" style="display: block;">Mon 1RM (kg)</label>
                                    <input type="number" class="input" id="charges-1rm" placeholder="Ex: 80" min="1" step="0.5">
                                </div>
                            </div>

                            <button class="btn btn-primary" style="width: 100%;" onclick="app.calculateCharges()">🧮 Calculer mes charges</button>

                            <div id="charges-result" class="hidden" style="margin-top: 1.5rem;">
                                <h4 class="text-white mb-3" style="font-size: 1.1rem;">📋 Vos charges de travail</h4>
                                <table class="charges-table">
                                    <thead>
                                        <tr>
                                            <th>Mobile</th>
                                            <th>% du 1RM</th>
                                            <th>Charge (kg)</th>
                                            <th>Répétitions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="charges-table-body">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        ${Object.keys(this.calculatedCharges).length > 0 ? `
                            <h3 class="text-white mb-3 mt-4" style="font-size: 1.2rem;">💾 Mes charges sauvegardées</h3>
                            ${Object.entries(this.calculatedCharges).map(([exercise, data]) => `
                                <div class="rm-history-card">
                                    <div class="flex justify-between items-center mb-3">
                                        <div>
                                            <div class="text-white" style="font-weight: 600; font-size: 1.1rem;">${exercise}</div>
                                            <div class="text-cyan" style="font-size: 0.9rem;">1RM : ${data.rm}kg</div>
                                        </div>
                                        <button class="btn btn-danger" onclick="app.deleteCalculatedCharge('${exercise}')">🗑️</button>
                                    </div>
                                    <table class="charges-table">
                                        <thead>
                                            <tr>
                                                <th>Mobile</th>
                                                <th>Charge</th>
                                                <th>Rép.</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><span class="badge badge-force">Force</span></td>
                                                <td class="charge-value">${data.charges.force}kg</td>
                                                <td>1-5</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge badge-équilibre">Équilibre</span></td>
                                                <td class="charge-value">${data.charges.equilibre}kg</td>
                                                <td>6-12</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge badge-endurance">Endurance</span></td>
                                                <td class="charge-value">${data.charges.endurance}kg</td>
                                                <td>15-25+</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            `).join('')}
                        ` : ''}
                    </div>
                `;
            }

            calculateCharges() {
                const exercise = document.getElementById('charges-exercise').value.trim();
                const rm = parseFloat(document.getElementById('charges-1rm').value);

                if (!exercise || !rm) {
                    alert('⚠️ Veuillez remplir tous les champs');
                    return;
                }

                const charges = {
                    force: Math.round(rm * 0.925 * 2) / 2,
                    equilibre: Math.round(rm * 0.725 * 2) / 2,
                    endurance: Math.round(rm * 0.5 * 2) / 2
                };

                this.calculatedCharges[exercise] = {
                    rm: rm,
                    charges: charges,
                    date: new Date().toISOString()
                };

                this.saveCalculatedCharges();

                const resultDiv = document.getElementById('charges-result');
                const tableBody = document.getElementById('charges-table-body');
                
                tableBody.innerHTML = `
                    <tr>
                        <td><span class="badge badge-force">Force</span></td>
                        <td>85-100%</td>
                        <td class="charge-value">${charges.force}kg</td>
                        <td>1-5 rép.</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-équilibre">Équilibre / Volume</span></td>
                        <td>65-80%</td>
                        <td class="charge-value">${charges.equilibre}kg</td>
                        <td>6-12 rép.</td>
                    </tr>
                    <tr>
                        <td><span class="badge badge-endurance">Endurance</span></td>
                        <td>40-60%</td>
                        <td class="charge-value">${charges.endurance}kg</td>
                        <td>15-25+ rép.</td>
                    </tr>
                `;

                resultDiv.classList.remove('hidden');
                
                setTimeout(() => {
                    this.render();
                }, 2000);
            }

            deleteCalculatedCharge(exercise) {
                if (confirm(`Supprimer les charges calculées pour "${exercise}" ?`)) {
                    delete this.calculatedCharges[exercise];
                    this.saveCalculatedCharges();
                    this.render();
                }
            }

            renderProgressionTab() {
                if (this.rmHistory.length === 0) {
                    return `
                        <div>
                            <h2 class="text-white mb-4" style="font-size: 1.5rem;">📊 Graphiques de Progression</h2>
                            <div class="text-center" style="padding: 3rem 1rem; opacity: 0.7;">
                                <div style="font-size: 4rem; margin-bottom: 1rem;">📈</div>
                                <div class="text-white">Aucune donnée de progression disponible</div>
                                <div class="text-white" style="opacity: 0.7; font-size: 0.9rem; margin-top: 0.5rem;">Effectuez des tests 1RM pour voir vos graphiques !</div>
                            </div>
                        </div>
                    `;
                }

                // Regrouper les tests par exercice
                const exerciseGroups = {};
                this.rmHistory.forEach(test => {
                    if (!exerciseGroups[test.exercise]) {
                        exerciseGroups[test.exercise] = [];
                    }
                    exerciseGroups[test.exercise].push(test);
                });

                return `
                    <div>
                        <h2 class="text-white mb-4" style="font-size: 1.5rem;">📊 Graphiques de Progression</h2>
                        
                        <div class="tip-box mb-4">
                            <div class="text-white" style="font-weight: 600; margin-bottom: 0.5rem;">📈 Suivez votre évolution</div>
                            <div class="text-white" style="opacity: 0.9; font-size: 0.95rem;">Les graphiques ci-dessous montrent l'évolution de vos 1RM au fil du temps pour chaque exercice. Une progression constante est le signe d'un entraînement efficace !</div>
                        </div>

                        ${Object.entries(exerciseGroups).map(([exercise, tests]) => {
                            const sortedTests = tests.sort((a, b) => new Date(a.date) - new Date(b.date));
                            const chartId = `chart-${exercise.replace(/\s+/g, '-').toLowerCase()}`;
                            
                            return `
                                <div class="chart-container">
                                    <h3 class="text-white mb-3" style="font-size: 1.1rem;">📊 ${exercise}</h3>
                                    <canvas id="${chartId}"></canvas>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }

            renderSessionsTab() {
                return `
                    <div>
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-white" style="font-size: 1.5rem;">📝 Mes Séances (${this.sessions.length})</h2>
                            <button class="btn btn-success" onclick="app.createNewSession()">➕ Créer une séance</button>
                        </div>

                        ${this.sessions.length > 0 ? `
                            <div class="grid grid-cols-2 gap-3">
                                ${this.sessions.map((session, index) => {
                                    const completions = this.sessionHistory.filter(h => h.sessionIndex === index && h.completed);
                                    const lastCompletion = completions.length > 0 ? completions[completions.length - 1] : null;
                                    const completionCount = completions.length;
                                    
                                    return `
                                        <div class="session-card ${completionCount > 0 ? 'completed' : ''}" onclick="app.viewSession(${index})">
                                            ${lastCompletion ? `
                                                <div class="session-completed-badge">
                                                    ✅ Dernière : ${new Date(lastCompletion.completedAt).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' })}
                                                </div>
                                            ` : ''}
                                            <div class="text-white" style="font-weight: 600; font-size: 1.2rem; margin-bottom: 0.5rem;">${session.nom}</div>
                                            <span class="badge badge-${session.type.toLowerCase()}">${session.type}</span>
                                            <div class="text-white" style="opacity: 0.7; margin-top: 0.75rem; font-size: 0.9rem;">
                                                💪 ${session.muscles.join(', ')}
                                            </div>
                                            <div class="text-white" style="opacity: 0.7; margin-top: 0.5rem; font-size: 0.9rem;">
                                                📋 ${session.exercices.length} exercice${session.exercices.length > 1 ? 's' : ''}
                                            </div>
                                            ${completionCount > 0 ? `
                                                <div class="text-white" style="opacity: 0.9; margin-top: 0.5rem; font-size: 0.9rem; color: #10b981;">
                                                    🔥 ${completionCount} fois effectuée${completionCount > 1 ? 's' : ''}
                                                </div>
                                            ` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : `
                            <div class="text-center" style="padding: 3rem 1rem; opacity: 0.7;">
                                <div style="font-size: 4rem; margin-bottom: 1rem;">📝</div>
                                <div class="text-white" style="margin-bottom: 1rem;">Aucune séance créée pour le moment</div>
                                <button class="btn btn-success" onclick="app.createNewSession()">➕ Créer ma première séance</button>
                            </div>
                        `}
                    </div>
                `;
            }

            renderTimerTab() {
                return `
                    <div>
                        <h2 class="text-white mb-4" style="font-size: 1.5rem;">⏱️ Timer & Chronomètre</h2>
                        
                        <div class="flex gap-2 mb-4">
                            <button class="sub-tab-btn ${this.timerMode === 'repos' ? 'active' : ''}" onclick="app.setTimerMode('repos')" style="flex: 1;">⏱️ Timer de Repos</button>
                            <button class="sub-tab-btn ${this.timerMode === 'chrono' ? 'active' : ''}" onclick="app.setTimerMode('chrono')" style="flex: 1;">⏱️ Chronomètre</button>
                        </div>

                        ${this.timerMode === 'repos' ? this.renderTimerRepos() : this.renderChronometre()}
                    </div>
                `;
            }

            renderTimerRepos() {
                const minutes = Math.floor(this.timerSeconds / 60);
                const seconds = this.timerSeconds % 60;
                const displayClass = this.timerRunning ? 'running' : (this.timerSeconds === 0 ? 'finished' : '');

                return `
                    <div class="timer-container">
                        <h3 class="text-white mb-3" style="font-size: 1.3rem;">⏱️ Timer de Repos</h3>
                        
                        <div id="timer-display" class="timer-display ${displayClass}">
                            ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}
                        </div>

                        <div class="timer-controls">
                            <button class="btn btn-${this.timerRunning ? 'warning' : 'success'}" onclick="app.toggleTimer()">
                                ${this.timerRunning ? '⏸️ Pause' : '▶️ Démarrer'}
                            </button>
                            <button class="btn btn-secondary" onclick="app.resetTimer()">🔄 Reset</button>
                        </div>

                        <div class="mb-3">
                            <h4 class="text-white mb-2" style="font-size: 1rem;">⚡ Presets rapides</h4>
                            <div class="flex gap-2" style="flex-wrap: wrap;">
                                <button class="timer-preset ${this.timerSeconds === 30 && !this.timerRunning ? 'active' : ''}" onclick="app.setTimerPreset(30)">30s</button>
                                <button class="timer-preset ${this.timerSeconds === 60 && !this.timerRunning ? 'active' : ''}" onclick="app.setTimerPreset(60)">1min</button>
                                <button class="timer-preset ${this.timerSeconds === 90 && !this.timerRunning ? 'active' : ''}" onclick="app.setTimerPreset(90)">1min30</button>
                                <button class="timer-preset ${this.timerSeconds === 120 && !this.timerRunning ? 'active' : ''}" onclick="app.setTimerPreset(120)">2min</button>
                                <button class="timer-preset ${this.timerSeconds === 180 && !this.timerRunning ? 'active' : ''}" onclick="app.setTimerPreset(180)">3min</button>
                                <button class="timer-preset ${this.timerSeconds === 300 && !this.timerRunning ? 'active' : ''}" onclick="app.setTimerPreset(300)">5min</button>
                            </div>
                        </div>

                        <div>
                            <h4 class="text-white mb-2" style="font-size: 1rem;">🎯 Timer personnalisé</h4>
                            <div class="timer-input-group">
                                <input type="number" class="timer-input" id="custom-minutes" placeholder="Min" min="0" max="59" value="0">
                                <span class="text-white">:</span>
                                <input type="number" class="timer-input" id="custom-seconds" placeholder="Sec" min="0" max="59" value="0">
                                <button class="btn btn-primary" onclick="app.setCustomTimer()">✓ OK</button>
                            </div>
                        </div>

                        <div class="tip-box mt-4">
                            <div class="text-white" style="font-weight: 600; margin-bottom: 0.5rem;">💡 Temps de repos selon le mobile</div>
                            <div class="text-white" style="opacity: 0.9; font-size: 0.9rem;">
                                • <strong>Force</strong> : 3-5 minutes (récupération complète)
                                <br>• <strong>Équilibre</strong> : 1-2 minutes (récupération modérée)
                                <br>• <strong>Endurance</strong> : 30s-1min (récupération courte)
                            </div>
                        </div>
                    </div>
                `;
            }

            renderChronometre() {
                const minutes = Math.floor(this.chronoSeconds / 60);
                const seconds = this.chronoSeconds % 60;

                return `
                    <div class="timer-container">
                        <h3 class="text-white mb-3" style="font-size: 1.3rem;">⏱️ Chronomètre</h3>
                        
                        <div id="chrono-display" class="timer-display ${this.chronoRunning ? 'running' : ''}">
                            ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}
                        </div>

                        <div class="timer-controls">
                            <button class="btn btn-${this.chronoRunning ? 'warning' : 'success'}" onclick="app.toggleChrono()">
                                ${this.chronoRunning ? '⏸️ Pause' : '▶️ Démarrer'}
                            </button>
                            ${this.chronoRunning ? `
                                <button class="btn btn-primary" onclick="app.addLap()">📍 Tour</button>
                            ` : ''}
                            <button class="btn btn-secondary" onclick="app.resetChrono()">🔄 Reset</button>
                        </div>

                        ${this.chronoLaps.length > 0 ? `
                            <div class="chrono-laps">
                                <h4 class="text-white mb-2" style="font-size: 1rem;">📊 Tours enregistrés (${this.chronoLaps.length})</h4>
                                ${this.chronoLaps.map((lap, index) => `
                                    <div class="lap-item">
                                        <span>Tour ${index + 1}</span>
                                        <span style="font-weight: bold; color: #67e8f9;">${lap}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}

                        <div class="tip-box mt-4">
                            <div class="text-white" style="font-weight: 600; margin-bottom: 0.5rem;">💡 Utilisation du chronomètre</div>
                            <div class="text-white" style="opacity: 0.9; font-size: 0.9rem;">
                                Parfait pour les exercices en temps :
                                <br>• Gainage / Planche
                                <br>• Maintien isométrique
                                <br>• Circuits training
                                <br>• Tests d'endurance
                            </div>
                        </div>
                    </div>
                `;
            }

            renderHistoriqueTab() {
                const sortedHistory = this.sessionHistory
                    .filter(h => h.completed)
                    .sort((a, b) => new Date(b.completedAt) - new Date(a.completedAt));

                return `
                    <div>
                        <h2 class="text-white mb-4" style="font-size: 1.5rem;">📅 Historique des Séances (${sortedHistory.length})</h2>

                        ${sortedHistory.length > 0 ? `
                            ${sortedHistory.map(entry => {
                                const session = this.sessions[entry.sessionIndex];
                                if (!session) return '';
                                
                                const date = new Date(entry.completedAt);
                                const dateStr = date.toLocaleDateString('fr-FR', { 
                                    weekday: 'long', 
                                    day: 'numeric', 
                                    month: 'long', 
                                    year: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                });

                                return `
                                    <div class="session-history-item">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="text-white" style="font-weight: 600; font-size: 1.1rem;">${session.nom}</div>
                                                <div class="text-cyan" style="font-size: 0.85rem;">${dateStr}</div>
                                            </div>
                                            <span class="badge badge-${session.type.toLowerCase()}">${session.type}</span>
                                        </div>
                                        ${entry.notes ? `
                                            <div class="text-white" style="background: rgba(15, 23, 42, 0.6); padding: 0.75rem; border-radius: 0.5rem; margin-top: 0.75rem; font-size: 0.9rem;">
                                                📝 <em>${entry.notes}</em>
                                            </div>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('')}
                        ` : `
                            <div class="text-center" style="padding: 3rem 1rem; opacity: 0.7;">
                                <div style="font-size: 4rem; margin-bottom: 1rem;">📅</div>
                                <div class="text-white">Aucune séance effectuée pour le moment</div>
                                <div class="text-white" style="opacity: 0.7; font-size: 0.9rem; margin-top: 0.5rem;">Validez vos séances pour construire votre historique !</div>
                            </div>
                        `}
                    </div>
                `;
            }

            renderPhotosTab() {
                return `
                    <div>
                        <h2 class="text-white mb-4" style="font-size: 1.5rem;">📸 Photos Avant / Après</h2>
                        
                        <div class="tip-box mb-4">
                            <div class="text-white" style="font-weight: 600; margin-bottom: 0.5rem;">💡 Suivez votre transformation</div>
                            <div class="text-white" style="opacity: 0.9; font-size: 0.95rem;">
                                Les photos sont un excellent moyen de visualiser votre progression ! Prenez une photo "avant" au début de votre programme, 
                                puis ajoutez régulièrement des photos "après" pour voir l'évolution. Pour de meilleurs résultats :
                                <br>• Même éclairage et même heure de la journée
                                <br>• Même position et même tenue
                                <br>• Photo tous les mois ou tous les 2 mois
                            </div>
                        </div>

                        <div class="photo-gallery">
                            <div class="photo-item">
                                <h3 class="text-white mb-2" style="font-size: 1.1rem;">📷 Photo AVANT</h3>
                                ${this.progressPhotos.before ? `
                                    <img src="${this.progressPhotos.before}" alt="Photo avant">
                                    <button class="btn btn-danger" style="width: 100%;" onclick="app.deletePhoto('before')">🗑️ Supprimer</button>
                                ` : `
                                    <input type="file" id="photo-before-input" accept="image/*" style="display: none;">
                                    <div class="photo-placeholder" onclick="document.getElementById('photo-before-input').click()">
                                        📷
                                    </div>
                                    <button class="btn btn-primary" style="width: 100%; margin-top: 0.75rem;" onclick="document.getElementById('photo-before-input').click()">
                                        ➕ Ajouter une photo
                                    </button>
                                `}
                            </div>

                            <div class="photo-item">
                                <h3 class="text-white mb-2" style="font-size: 1.1rem;">📷 Photo APRÈS</h3>
                                ${this.progressPhotos.after ? `
                                    <img src="${this.progressPhotos.after}" alt="Photo après">
                                    <button class="btn btn-danger" style="width: 100%;" onclick="app.deletePhoto('after')">🗑️ Supprimer</button>
                                ` : `
                                    <input type="file" id="photo-after-input" accept="image/*" style="display: none;">
                                    <div class="photo-placeholder" onclick="document.getElementById('photo-after-input').click()">
                                        📷
                                    </div>
                                    <button class="btn btn-primary" style="width: 100%; margin-top: 0.75rem;" onclick="document.getElementById('photo-after-input').click()">
                                        ➕ Ajouter une photo
                                    </button>
                                `}
                            </div>
                        </div>

                        ${this.progressPhotos.before && this.progressPhotos.after ? `
                            <div class="tip-box" style="border-color: #10b981; background: rgba(16, 185, 129, 0.1);">
                                <div class="text-white" style="font-weight: 600; margin-bottom: 0.5rem;">🎉 Bravo pour votre transformation !</div>
                                <div class="text-white" style="opacity: 0.9; font-size: 0.95rem;">
                                    Vous avez ajouté vos photos avant/après ! C'est un excellent moyen de rester motivé et de voir votre progression. 
                                    N'hésitez pas à mettre à jour régulièrement votre photo "après" pour suivre votre évolution.
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            uploadPhoto(type) {
                const input = document.getElementById(`photo-${type}-input`);
                const file = input.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        this.progressPhotos[type] = event.target.result;
                        this.saveProgressPhotos();
                        this.checkBadges();
                        this.render();
                    };
                    reader.readAsDataURL(file);
                }
            }

            deletePhoto(type) {
                if (confirm(`Supprimer la photo ${type === 'before' ? 'AVANT' : 'APRÈS'} ?`)) {
                    this.progressPhotos[type] = null;
                    this.saveProgressPhotos();
                    this.render();
                }
            }

            renderBadgesTab() {
                const unlockedCount = this.badges.filter(b => b.unlocked).length;
                const totalCount = this.badges.length;
                const progress = (unlockedCount / totalCount) * 100;

                return `
                    <div>
                        <h2 class="text-white mb-4" style="font-size: 1.5rem;">🏆 Badges & Récompenses</h2>
                        
                        <div class="tip-box mb-4" style="border-color: #a855f7; background: rgba(168, 85, 247, 0.1);">
                            <div class="text-white" style="font-weight: 600; margin-bottom: 0.75rem;">
                                🏆 Progression globale : ${unlockedCount} / ${totalCount} badges
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%;"></div>
                            </div>
                            <div class="text-white" style="opacity: 0.9; font-size: 0.9rem; margin-top: 0.75rem;">
                                Continuez à vous entraîner pour débloquer tous les badges !
                            </div>
                        </div>

                        <div class="badge-grid">
                            ${this.badges.map(badge => `
                                <div class="badge-item ${badge.unlocked ? 'unlocked' : 'locked'}">
                                    <div class="badge-icon">${badge.icon}</div>
                                    <div class="text-white" style="font-weight: 600; margin-bottom: 0.25rem;">${badge.name}</div>
                                    <div class="text-white" style="opacity: 0.7; font-size: 0.85rem;">${badge.description}</div>
                                    ${badge.unlocked ? `
                                        <div class="text-white" style="color: #10b981; font-size: 0.75rem; margin-top: 0.5rem;">
                                            ✓ Débloqué le ${new Date(badge.unlockedAt).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short', year: 'numeric' })}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }renderCoursTab() {
                const allExercises = [
                    ...coursData.exercicesPectoraux,
                    ...coursData.exercicesDos,
                    ...coursData.exercicesEpaules,
                    ...coursData.exercicesBras,
                    ...coursData.exercicesJambes,
                    ...coursData.exercicesAbdos
                ];

                const filteredExercises = this.filterExercises(allExercises);

                return `
                    <div>
                        <h2 class="text-white mb-4" style="font-size: 1.5rem;">📚 Cours & Ressources</h2>

                        <div class="flex gap-2 mb-4" style="overflow-x: auto;">
                            <button class="sub-tab-btn ${this.currentCoursTab === 'princshowSignup() {
                this.currentView = 'signup';
                this.render();
            }

            showLogin() {
                this.currentView = 'login';
                this.render();
            }

            handleSelectUser() {
                const username = document.getElementById('select-user').value;
                if (username) {
                    this.currentUser = username;
                    this.currentView = 'dashboard';
                    this.init();
                } else {
                    alert('Veuillez sélectionner un profil');
                }
            }

            handleSignup(e) {
                e.preventDefault();
                const username = document.getElementById('signup-username').value.trim();
                const age = document.getElementById('signup-age').value;
                const sexe = document.getElementById('signup-sexe').value;
                const taille = document.getElementById('signup-taille').value;
                const poids = document.getElementById('signup-poids').value;

                if (!securite.verifierUtilisateur(username)) {
                    alert('❌ Accès refusé : Ce prénom n\'est pas autorisé à créer un compte.\n\nContactez votre professeur si vous pensez qu\'il s\'agit d\'une erreur.');
                    return;
                }

                const userKey = `user-${username}`;
                if (localStorage.getItem(userKey)) {
                    alert('Ce profil existe déjà');
                    return;
                }

                const userData = { age, sexe, taille, poids };
                localStorage.setItem(userKey, JSON.stringify(userData));

                this.currentUser = username;
                this.currentView = 'dashboard';
                this.init();
            }

            updateProfile(e) {
                e.preventDefault();
                const age = document.getElementById('profile-age').value;
                const sexe = document.getElementById('profile-sexe').value;
                const taille = document.getElementById('profile-taille').value;
                const poids = document.getElementById('profile-poids').value;

                const userKey = `user-${this.currentUser}`;
                const userData = { age, sexe, taille, poids };
                localStorage.setItem(userKey, JSON.stringify(userData));

                alert('✅ Profil mis à jour avec succès !');
                this.render();
            }

            logout() {
                if (confirm('Voulez-vous également verrouiller l\'accès (nécessitera le code à la prochaine connexion) ?')) {
                    securite.revoquerAcces();
                    this.currentView = 'code-access';
                } else {
                    this.currentView = 'login';
                }
                this.currentUser = null;
                this.sessions = [];
                this.rmHistory = [];
                this.userAvatar = null;
                this.sessionHistory = [];
                this.calculatedCharges = {};
                this.progressPhotos = { before: null, after: null };
                this.badges = [];
                this.goals = [];
                this.render();
            }

            calculateRM(e) {
                e.preventDefault();
                const muscle = document.getElementById('rm-muscle').value;
                const exercise = document.getElementById('rm-exercise').value;
                const weight = parseFloat(document.getElementById('rm-weight').value);
                const reps = parseInt(document.getElementById('rm-reps').value);
                const date = document.getElementById('rm-date').value;

                const rm = Math.round(weight * (1 + reps / 30));

                this.rmHistory.push({ muscle, exercise, weight, reps, date, rm });
                this.saveRMHistory();
                this.checkBadges();

                document.getElementById('rm-result').innerHTML = `
                    <div class="rm-history-card">
                        <div class="text-center">
                            <div style="color: #10b981; font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">${rm} kg</div>
                            <div class="text-white" style="font-size: 1.2rem; margin-bottom: 1rem;">1RM estimé pour ${exercise}</div>
                            <div class="text-white" style="opacity: 0.7;">Basé sur ${weight}kg × ${reps} répétition${reps > 1 ? 's' : ''}</div>
                        </div>
                    </div>
                `;
                document.getElementById('rm-result').classList.remove('hidden');

                setTimeout(() => {
                    this.render();
                }, 2000);
            }

            editRM(index) {
                const test = this.rmHistory[index];
                document.getElementById('rm-muscle').value = test.muscle;
                document.getElementById('rm-exercise').value = test.exercise;
                document.getElementById('rm-weight').value = test.weight;
                document.getElementById('rm-reps').value = test.reps;
                document.getElementById('rm-date').value = test.date;

                this.rmHistory.splice(index, 1);
                this.saveRMHistory();
                this.render();
            }

            deleteRM(index) {
                if (confirm('Êtes-vous sûr de vouloir supprimer ce test ?')) {
                    this.rmHistory.splice(index, 1);
                    this.saveRMHistory();
                    this.checkBadges();
                    this.render();
                }
            }

            createNewSession() {
                this.currentSession = null;
                this.exercicesTemp = [];
                this.musclesTemp = [];
                this.currentView = 'session-form';
                this.render();
            }

            editSession(index) {
                this.currentSession = index;
                const session = this.sessions[index];
                this.exercicesTemp = [...session.exercices];
                this.musclesTemp = [...session.muscles];
                this.currentView = 'session-form';
                this.render();
            }

            deleteSession(index) {
                if (confirm('Êtes-vous sûr de vouloir supprimer cette séance ?')) {
                    this.sessions.splice(index, 1);
                    this.saveSessions();
                    this.render();
                }
            }

            viewSession(index) {
                this.currentSession = index;
                this.currentView = 'session-detail';
                this.render();
            }

            cancelSession() {
                this.currentSession = null;
                this.currentView = 'dashboard';
                this.currentTab = 'sessions';
                this.render();
            }

            backToSessions() {
                this.currentSession = null;
                this.currentView = 'dashboard';
                this.currentTab = 'sessions';
                this.render();
            }

            toggleMuscle(muscle) {
                const index = this.musclesTemp.indexOf(muscle);
                if (index > -1) {
                    this.musclesTemp.splice(index, 1);
                } else {
                    this.musclesTemp.push(muscle);
                }
                this.render();
            }

            addExercice() {
                const exerciceName = document.getElementById('exercice-name').value.trim();
                if (exerciceName) {
                    this.exercicesTemp.push(exerciceName);
                    document.getElementById('exercice-name').value = '';
                    this.render();
                }
            }

            removeExercice(index) {
                this.exercicesTemp.splice(index, 1);
                this.render();
            }

            saveSession(e) {
                e.preventDefault();
                const nom = document.getElementById('session-name').value;
                const type = document.getElementById('session-type').value;

                if (this.musclesTemp.length === 0) {
                    alert('Veuillez sélectionner au moins un groupe musculaire');
                    return;
                }

                if (this.exercicesTemp.length === 0) {
                    alert('Veuillez ajouter au moins un exercice');
                    return;
                }

                const sessionData = {
                    nom,
                    type,
                    muscles: this.musclesTemp,
                    exercices: this.exercicesTemp
                };

                if (this.currentSession !== null) {
                    this.sessions[this.currentSession] = sessionData;
                } else {
                    this.sessions.push(sessionData);
                }

                this.saveSessions();
                this.checkBadges();
                this.currentSession = null;
                this.currentView = 'dashboard';
                this.currentTab = 'sessions';
                this.render();
            }

            initSessionForm() {
                const isEditing = this.currentSession !== null;
                const session = isEditing ? this.sessions[this.currentSession] : { muscles: [], exercices: [] };
                this.musclesTemp = [...session.muscles];
                this.exercicesTemp = [...session.exercices];
            }

            markSessionCompleted() {
                const notes = document.getElementById('session-notes').value.trim();
                
                const historyEntry = {
                    sessionIndex: this.currentSession,
                    completed: true,
                    completedAt: new Date().toISOString(),
                    notes: notes
                };

                this.sessionHistory.push(historyEntry);
                this.saveSessionHistory();
                this.checkBadges();

                alert('✅ Séance validée avec succès !');
                this.backToSessions();
            }

            exportData() {
                const data = {
                    sessions: this.sessions,
                    rmHistory: this.rmHistory,
                    avatar: this.userAvatar,
                    sessionHistory: this.sessionHistory,
                    calculatedCharges: this.calculatedCharges,
                    theme: this.currentTheme,
                    progressPhotos: this.progressPhotos,
                    badges: this.badges,
                    goals: this.goals,
                    userData: JSON.parse(localStorage.getItem(`user-${this.currentUser}`))
                };

                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `livret-musculation-${this.currentUser}-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            }

            importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            
                            if (data.sessions) this.sessions = data.sessions;
                            if (data.rmHistory) this.rmHistory = data.rmHistory;
                            if (data.avatar) this.userAvatar = data.avatar;
                            if (data.sessionHistory) this.sessionHistory = data.sessionHistory;
                            if (data.calculatedCharges) this.calculatedCharges = data.calculatedCharges;
                            if (data.theme) {
                                this.currentTheme = data.theme;
                                this.applyTheme(data.theme);
                            }
                            if (data.progressPhotos) this.progressPhotos = data.progressPhotos;
                            if (data.badges) this.badges = data.badges;
                            if (data.goals) this.goals = data.goals;
                            if (data.userData) {
                                localStorage.setItem(`user-${this.currentUser}`, JSON.stringify(data.userData));
                            }

                            this.saveSessions();
                            this.saveRMHistory();
                            this.saveUserAvatar();
                            this.saveSessionHistory();
                            this.saveCalculatedCharges();
                            this.saveTheme();
                            this.saveProgressPhotos();
                            this.saveBadges();
                            this.saveGoals();

                            alert('✅ Données importées avec succès !');
                            this.render();
                        } catch (error) {
                            alert('❌ Erreur lors de l\'importation des données');
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            }

            handleCodeAccess(e) {
                e.preventDefault();
                const code = document.getElementById('code-input').value;
                
                if (securite.verifierCode(code)) {
                    securite.validerCode();
                    this.currentView = 'login';
                    this.render();
                } else {
                    document.getElementById('code-error').classList.remove('hidden');
                    document.getElementById('code-input').value = '';
                    document.getElementById('code-input').focus();
                }
            }

            attachCodeAccessEvents() {
                const form = document.getElementById('code-form');
                if (form) {
                    form.addEventListener('submit', (e) => this.handleCodeAccess(e));
                }
            }

            attachLoginEvents() {
                // Events already handled by onclick in HTML
            }

            attachSignupEvents() {
                const form = document.getElementById('signup-form');
                if (form) {
                    form.addEventListener('submit', (e) => this.handleSignup(e));
                }

                const avatarInput = document.getElementById('avatar-input');
                if (avatarInput) {
                    avatarInput.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (event) => {
                                document.getElementById('avatar-preview').innerHTML = `<img src="${event.target.result}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                                this.userAvatar = event.target.result;
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }
            }

            attachDashboardEvents() {
                if (this.currentTab === 'profil') {
                    const form = document.getElementById('profile-form');
                    if (form) {
                        form.addEventListener('submit', (e) => this.updateProfile(e));
                    }

                    const avatarInput = document.getElementById('profile-avatar-input');
                    if (avatarInput) {
                        avatarInput.addEventListener('change', (e) => {
                            const file = e.target.files[0];
                            if (file) {
                                const reader = new FileReader();
                                reader.onload = (event) => {
                                    this.userAvatar = event.target.result;
                                    this.saveUserAvatar();
                                    this.render();
                                };
                                reader.readAsDataURL(file);
                            }
                        });
                    }
                }

                if (this.currentTab === 'rm') {
                    const form = document.getElementById('rm-form');
                    if (form) {
                        form.addEventListener('submit', (e) => this.calculateRM(e));
                    }

                    const dateInput = document.getElementById('rm-date');
                    if (dateInput && !dateInput.value) {
                        dateInput.valueAsDate = new Date();
                    }
                }

                if (this.currentTab === 'photos') {
                    const beforeInput = document.getElementById('photo-before-input');
                    if (beforeInput) {
                        beforeInput.addEventListener('change', (e) => this.uploadPhoto('before'));
                    }

                    const afterInput = document.getElementById('photo-after-input');
                    if (afterInput) {
                        afterInput.addEventListener('change', (e) => this.uploadPhoto('after'));
                    }
                }
            }

            attachSessionFormEvents() {
                this.initSessionForm();

                const form = document.getElementById('session-form');
                if (form) {
                    form.addEventListener('submit', (e) => this.saveSession(e));
                }

                const exerciceInput = document.getElementById('exercice-name');
                if (exerciceInput) {
                    exerciceInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            this.addExercice();
                        }
                    });
                }
            }

            attachSessionDetailEvents() {
                // Event handlers are inline in the HTML
            }

            setTimerPreset(seconds) {
                this.timerSeconds = seconds;
                this.timerRunning = false;
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
                this.render();
            }

            setCustomTimer() {
                const minutes = parseInt(document.getElementById('custom-minutes').value) || 0;
                const seconds = parseInt(document.getElementById('custom-seconds').value) || 0;
                this.timerSeconds = minutes * 60 + seconds;
                this.timerRunning = false;
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
                this.render();
            }

            toggleTimer() {
                if (this.timerRunning) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                    this.timerRunning = false;
                } else {
                    this.timerRunning = true;
                    this.timerInterval = setInterval(() => {
                        if (this.timerSeconds > 0) {
                            this.timerSeconds--;
                            this.updateTimerDisplay();
                        } else {
                            this.timerFinished();
                        }
                    }, 1000);
                }
                this.render();
            }

            updateTimerDisplay() {
                const display = document.getElementById('timer-display');
                if (display) {
                    const minutes = Math.floor(this.timerSeconds / 60);
                    const seconds = this.timerSeconds % 60;
                    display.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (this.timerSeconds === 0) {
                        display.classList.add('finished');
                    }
                }
            }

            timerFinished() {
                clearInterval(this.timerInterval);
                this.timerInterval = null;
                this.timerRunning = false;
                
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance('Repos terminé');
                    utterance.lang = 'fr-FR';
                    utterance.rate = 1.2;
                    speechSynthesis.speak(utterance);
                }
                
                if ('vibrate' in navigator) {
                    navigator.vibrate([200, 100, 200]);
                }
                
                this.render();
            }

            resetTimer() {
                clearInterval(this.timerInterval);
                this.timerInterval = null;
                this.timerRunning = false;
                this.timerSeconds = 60;
                this.render();
            }

            toggleChrono() {
                if (this.chronoRunning) {
                    clearInterval(this.chronoInterval);
                    this.chronoInterval = null;
                    this.chronoRunning = false;
                } else {
                    this.chronoRunning = true;
                    this.chronoInterval = setInterval(() => {
                        this.chronoSeconds++;
                        this.updateChronoDisplay();
                    }, 1000);
                }
                this.render();
            }

            updateChronoDisplay() {
                const display = document.getElementById('chrono-display');
                if (display) {
                    const minutes = Math.floor(this.chronoSeconds / 60);
                    const seconds = this.chronoSeconds % 60;
                    display.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }

            addLap() {
                const minutes = Math.floor(this.chronoSeconds / 60);
                const seconds = this.chronoSeconds % 60;
                const lapTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                this.chronoLaps.push(lapTime);
                this.render();
            }

            resetChrono() {
                clearInterval(this.chronoInterval);
                this.chronoInterval = null;
                this.chronoRunning = false;
                this.chronoSeconds = 0;
                this.chronoLaps = [];
                this.render();
            }
        }

        let app;
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                app = new LivretApp();
            });
        } else {
            app = new LivretApp();
        }
        }
</script>
</body>
</html>